(function(le,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue"),require("pinia")):typeof define=="function"&&define.amd?define(["exports","vue","pinia"],t):(le=typeof globalThis<"u"?globalThis:le||self,t(le.RpaWebUI={},le.Vue,le.Pinia))})(this,function(le,t,yt){"use strict";function Ao(){var o=window.navigator.userAgent,e=o.indexOf("MSIE ");if(e>0)return parseInt(o.substring(e+5,o.indexOf(".",e)),10);var n=o.indexOf("Trident/");if(n>0){var s=o.indexOf("rv:");return parseInt(o.substring(s+3,o.indexOf(".",s)),10)}var l=o.indexOf("Edge/");return l>0?parseInt(o.substring(l+5,o.indexOf(".",l)),10):-1}let ht;function vt(){vt.init||(vt.init=!0,ht=Ao()!==-1)}var ft={name:"ResizeObserver",props:{emitOnMount:{type:Boolean,default:!1},ignoreWidth:{type:Boolean,default:!1},ignoreHeight:{type:Boolean,default:!1}},emits:["notify"],mounted(){vt(),t.nextTick(()=>{this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitOnMount&&this.emitSize()});const o=document.createElement("object");this._resizeObject=o,o.setAttribute("aria-hidden","true"),o.setAttribute("tabindex",-1),o.onload=this.addResizeHandlers,o.type="text/html",ht&&this.$el.appendChild(o),o.data="about:blank",ht||this.$el.appendChild(o)},beforeUnmount(){this.removeResizeHandlers()},methods:{compareAndNotify(){(!this.ignoreWidth&&this._w!==this.$el.offsetWidth||!this.ignoreHeight&&this._h!==this.$el.offsetHeight)&&(this._w=this.$el.offsetWidth,this._h=this.$el.offsetHeight,this.emitSize())},emitSize(){this.$emit("notify",{width:this._w,height:this._h})},addResizeHandlers(){this._resizeObject.contentDocument.defaultView.addEventListener("resize",this.compareAndNotify),this.compareAndNotify()},removeResizeHandlers(){this._resizeObject&&this._resizeObject.onload&&(!ht&&this._resizeObject.contentDocument&&this._resizeObject.contentDocument.defaultView.removeEventListener("resize",this.compareAndNotify),this.$el.removeChild(this._resizeObject),this._resizeObject.onload=null,this._resizeObject=null)}}};const Bo=t.withScopeId("data-v-b329ee4c");t.pushScopeId("data-v-b329ee4c");const Vo={class:"resize-observer",tabindex:"-1"};t.popScopeId();const Mo=Bo((o,e,n,s,l,r)=>(t.openBlock(),t.createBlock("div",Vo)));ft.render=Mo,ft.__scopeId="data-v-b329ee4c",ft.__file="src/components/ResizeObserver.vue";function gt(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gt=function(e){return typeof e}:gt=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gt(o)}function Do(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function Ho(o,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(o,s.key,s)}}function Po(o,e,n){return e&&Ho(o.prototype,e),o}function Lt(o){return No(o)||zo(o)||Fo(o)||Oo()}function No(o){if(Array.isArray(o))return _t(o)}function zo(o){if(typeof Symbol<"u"&&Symbol.iterator in Object(o))return Array.from(o)}function Fo(o,e){if(o){if(typeof o=="string")return _t(o,e);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor&&(n=o.constructor.name),n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _t(o,e)}}function _t(o,e){(e==null||e>o.length)&&(e=o.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=o[n];return s}function Oo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wo(o){var e;return typeof o=="function"?e={callback:o}:e=o,e}function Lo(o,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s,l,r,a=function(h){for(var m=arguments.length,d=new Array(m>1?m-1:0),v=1;v<m;v++)d[v-1]=arguments[v];if(r=d,!(s&&h===l)){var u=n.leading;typeof u=="function"&&(u=u(h,l)),(!s||h!==l)&&u&&o.apply(void 0,[h].concat(Lt(r))),l=h,clearTimeout(s),s=setTimeout(function(){o.apply(void 0,[h].concat(Lt(r))),s=0},e)}};return a._clear=function(){clearTimeout(s),s=null},a}function Ut(o,e){if(o===e)return!0;if(gt(o)==="object"){for(var n in o)if(!Ut(o[n],e[n]))return!1;return!0}return!1}var Uo=function(){function o(e,n,s){Do(this,o),this.el=e,this.observer=null,this.frozen=!1,this.createObserver(n,s)}return Po(o,[{key:"createObserver",value:function(n,s){var l=this;if(this.observer&&this.destroyObserver(),!this.frozen){if(this.options=Wo(n),this.callback=function(c,h){l.options.callback(c,h),c&&l.options.once&&(l.frozen=!0,l.destroyObserver())},this.callback&&this.options.throttle){var r=this.options.throttleOptions||{},a=r.leading;this.callback=Lo(this.callback,this.options.throttle,{leading:function(h){return a==="both"||a==="visible"&&h||a==="hidden"&&!h}})}this.oldResult=void 0,this.observer=new IntersectionObserver(function(c){var h=c[0];if(c.length>1){var m=c.find(function(v){return v.isIntersecting});m&&(h=m)}if(l.callback){var d=h.isIntersecting&&h.intersectionRatio>=l.threshold;if(d===l.oldResult)return;l.oldResult=d,l.callback(d,h)}},this.options.intersection),t.nextTick(function(){l.observer&&l.observer.observe(l.el)})}}},{key:"destroyObserver",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null),this.callback&&this.callback._clear&&(this.callback._clear(),this.callback=null)}},{key:"threshold",get:function(){return this.options.intersection&&typeof this.options.intersection.threshold=="number"?this.options.intersection.threshold:0}}]),o}();function jt(o,e,n){var s=e.value;if(s)if(typeof IntersectionObserver>"u")console.warn("[vue-observe-visibility] IntersectionObserver API is not available in your browser. Please install this polyfill: https://github.com/w3c/IntersectionObserver/tree/master/polyfill");else{var l=new Uo(o,s,n);o._vue_visibilityState=l}}function jo(o,e,n){var s=e.value,l=e.oldValue;if(!Ut(s,l)){var r=o._vue_visibilityState;if(!s){Gt(o);return}r?r.createObserver(s,n):jt(o,{value:s},n)}}function Gt(o){var e=o._vue_visibilityState;e&&(e.destroyObserver(),delete o._vue_visibilityState)}var Go={beforeMount:jt,updated:jo,unmounted:Gt};function qo(o){return{all:o=o||new Map,on:function(e,n){var s=o.get(e);s&&s.push(n)||o.set(e,[n])},off:function(e,n){var s=o.get(e);s&&s.splice(s.indexOf(n)>>>0,1)},emit:function(e,n){(o.get(e)||[]).slice().map(function(s){s(n)}),(o.get("*")||[]).slice().map(function(s){s(e,n)})}}}var Ko={itemsLimit:1e3},Jo=/(auto|scroll)/;function qt(o,e){return o.parentNode===null?e:qt(o.parentNode,e.concat([o]))}var St=function(e,n){return getComputedStyle(e,null).getPropertyValue(n)},Xo=function(e){return St(e,"overflow")+St(e,"overflow-y")+St(e,"overflow-x")},Yo=function(e){return Jo.test(Xo(e))};function Kt(o){if(o instanceof HTMLElement||o instanceof SVGElement){for(var e=qt(o.parentNode,[]),n=0;n<e.length;n+=1)if(Yo(e[n]))return e[n];return document.scrollingElement||document.documentElement}}function kt(o){"@babel/helpers - typeof";return kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kt(o)}var Jt={items:{type:Array,required:!0},keyField:{type:String,default:"id"},direction:{type:String,default:"vertical",validator:function(e){return["vertical","horizontal"].includes(e)}},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"}};function Xt(){return this.items.length&&kt(this.items[0])!=="object"}var xt=!1;if(typeof window<"u"){xt=!1;try{var Zo=Object.defineProperty({},"passive",{get:function(){xt=!0}});window.addEventListener("test",null,Zo)}catch{}}let Qo=0;var Rt={name:"RecycleScroller",components:{ResizeObserver:ft},directives:{ObserveVisibility:Go},props:{...Jt,itemSize:{type:Number,default:null},gridItems:{type:Number,default:void 0},itemSecondarySize:{type:Number,default:void 0},minItemSize:{type:[Number,String],default:null},sizeField:{type:String,default:"size"},typeField:{type:String,default:"type"},buffer:{type:Number,default:200},pageMode:{type:Boolean,default:!1},prerender:{type:Number,default:0},emitUpdate:{type:Boolean,default:!1},updateInterval:{type:Number,default:0},skipHover:{type:Boolean,default:!1},listTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},listClass:{type:[String,Object,Array],default:""},itemClass:{type:[String,Object,Array],default:""}},emits:["resize","visible","hidden","update","scroll-start","scroll-end"],data(){return{pool:[],totalSize:0,ready:!1,hoverKey:null}},computed:{sizes(){if(this.itemSize===null){const o={"-1":{accumulator:0}},e=this.items,n=this.sizeField,s=this.minItemSize;let l=1e4,r=0,a;for(let c=0,h=e.length;c<h;c++)a=e[c][n]||s,a<l&&(l=a),r+=a,o[c]={accumulator:r,size:a};return this.$_computedMinItemSize=l,o}return[]},simpleArray:Xt,itemIndexByKey(){const{keyField:o,items:e}=this,n={};for(let s=0,l=e.length;s<l;s++)n[e[s][o]]=s;return n}},watch:{items(){this.updateVisibleItems(!0)},pageMode(){this.applyPageMode(),this.updateVisibleItems(!1)},sizes:{handler(){this.updateVisibleItems(!1)},deep:!0},gridItems(){this.updateVisibleItems(!0)},itemSecondarySize(){this.updateVisibleItems(!0)}},created(){this.$_startIndex=0,this.$_endIndex=0,this.$_views=new Map,this.$_unusedViews=new Map,this.$_scrollDirty=!1,this.$_lastUpdateScrollPosition=0,this.prerender&&(this.$_prerender=!0,this.updateVisibleItems(!1)),this.gridItems&&!this.itemSize&&console.error("[vue-recycle-scroller] You must provide an itemSize when using gridItems")},mounted(){this.applyPageMode(),this.$nextTick(()=>{this.$_prerender=!1,this.updateVisibleItems(!0),this.ready=!0})},activated(){const o=this.$_lastUpdateScrollPosition;typeof o=="number"&&this.$nextTick(()=>{this.scrollToPosition(o)})},beforeUnmount(){this.removeListeners()},methods:{addView(o,e,n,s,l){const r=t.markRaw({id:Qo++,index:e,used:!0,key:s,type:l}),a=t.shallowReactive({item:n,position:0,nr:r});return o.push(a),a},unuseView(o,e=!1){const n=this.$_unusedViews,s=o.nr.type;let l=n.get(s);l||(l=[],n.set(s,l)),l.push(o),e||(o.nr.used=!1,o.position=-9999)},handleResize(){this.$emit("resize"),this.ready&&this.updateVisibleItems(!1)},handleScroll(o){if(!this.$_scrollDirty){if(this.$_scrollDirty=!0,this.$_updateTimeout)return;const e=()=>requestAnimationFrame(()=>{this.$_scrollDirty=!1;const{continuous:n}=this.updateVisibleItems(!1,!0);n||(clearTimeout(this.$_refreshTimout),this.$_refreshTimout=setTimeout(this.handleScroll,this.updateInterval+100))});e(),this.updateInterval&&(this.$_updateTimeout=setTimeout(()=>{this.$_updateTimeout=0,this.$_scrollDirty&&e()},this.updateInterval))}},handleVisibilityChange(o,e){this.ready&&(o||e.boundingClientRect.width!==0||e.boundingClientRect.height!==0?(this.$emit("visible"),requestAnimationFrame(()=>{this.updateVisibleItems(!1)})):this.$emit("hidden"))},updateVisibleItems(o,e=!1){const n=this.itemSize,s=this.gridItems||1,l=this.itemSecondarySize||n,r=this.$_computedMinItemSize,a=this.typeField,c=this.simpleArray?null:this.keyField,h=this.items,m=h.length,d=this.sizes,v=this.$_views,u=this.$_unusedViews,g=this.pool,w=this.itemIndexByKey;let f,p,b,y,S;if(!m)f=p=y=S=b=0;else if(this.$_prerender)f=y=0,p=S=Math.min(this.prerender,h.length),b=null;else{const O=this.getScroll();if(e){let L=O.start-this.$_lastUpdateScrollPosition;if(L<0&&(L=-L),n===null&&L<r||L<n)return{continuous:!0}}this.$_lastUpdateScrollPosition=O.start;const J=this.buffer;O.start-=J,O.end+=J;let Y=0;if(this.$refs.before&&(Y=this.$refs.before.scrollHeight,O.start-=Y),this.$refs.after){const L=this.$refs.after.scrollHeight;O.end+=L}if(n===null){let L,q=0,re=m-1,oe=~~(m/2),he;do he=oe,L=d[oe].accumulator,L<O.start?q=oe:oe<m-1&&d[oe+1].accumulator>O.start&&(re=oe),oe=~~((q+re)/2);while(oe!==he);for(oe<0&&(oe=0),f=oe,b=d[m-1].accumulator,p=oe;p<m&&d[p].accumulator<O.end;p++);for(p===-1?p=h.length-1:(p++,p>m&&(p=m)),y=f;y<m&&Y+d[y].accumulator<O.start;y++);for(S=y;S<m&&Y+d[S].accumulator<O.end;S++);}else{f=~~(O.start/n*s);const L=f%s;f-=L,p=Math.ceil(O.end/n*s),y=Math.max(0,Math.floor((O.start-Y)/n*s)),S=Math.floor((O.end-Y)/n*s),f<0&&(f=0),p>m&&(p=m),y<0&&(y=0),S>m&&(S=m),b=Math.ceil(m/s)*n}}p-f>Ko.itemsLimit&&this.itemsLimitError(),this.totalSize=b;let $;const E=f<=this.$_endIndex&&p>=this.$_startIndex;if(E)for(let O=0,J=g.length;O<J;O++)$=g[O],$.nr.used&&(o&&($.nr.index=w[$.item[c]]),($.nr.index==null||$.nr.index<f||$.nr.index>=p)&&this.unuseView($));const T=E?null:new Map;let D,j,F;for(let O=f;O<p;O++){D=h[O];const J=c?D[c]:D;if(J==null)throw new Error(`Key is ${J} on item (keyField is '${c}')`);if($=v.get(J),!n&&!d[O].size){$&&this.unuseView($);continue}j=D[a];let Y=u.get(j),L=!1;if(!$)E?Y&&Y.length?$=Y.pop():$=this.addView(g,O,D,J,j):(F=T.get(j)||0,(!Y||F>=Y.length)&&($=this.addView(g,O,D,J,j),this.unuseView($,!0),Y=u.get(j)),$=Y[F],T.set(j,F+1)),v.delete($.nr.key),$.nr.used=!0,$.nr.index=O,$.nr.key=J,$.nr.type=j,v.set(J,$),L=!0;else if(!$.nr.used&&($.nr.used=!0,L=!0,Y)){const q=Y.indexOf($);q!==-1&&Y.splice(q,1)}$.item=D,L&&(O===h.length-1&&this.$emit("scroll-end"),O===0&&this.$emit("scroll-start")),n===null?($.position=d[O-1].accumulator,$.offset=0):($.position=Math.floor(O/s)*n,$.offset=O%s*l)}return this.$_startIndex=f,this.$_endIndex=p,this.emitUpdate&&this.$emit("update",f,p,y,S),clearTimeout(this.$_sortTimer),this.$_sortTimer=setTimeout(this.sortViews,this.updateInterval+300),{continuous:E}},getListenerTarget(){let o=Kt(this.$el);return window.document&&(o===window.document.documentElement||o===window.document.body)&&(o=window),o},getScroll(){const{$el:o,direction:e}=this,n=e==="vertical";let s;if(this.pageMode){const l=o.getBoundingClientRect(),r=n?l.height:l.width;let a=-(n?l.top:l.left),c=n?window.innerHeight:window.innerWidth;a<0&&(c+=a,a=0),a+c>r&&(c=r-a),s={start:a,end:a+c}}else n?s={start:o.scrollTop,end:o.scrollTop+o.clientHeight}:s={start:o.scrollLeft,end:o.scrollLeft+o.clientWidth};return s},applyPageMode(){this.pageMode?this.addListeners():this.removeListeners()},addListeners(){this.listenerTarget=this.getListenerTarget(),this.listenerTarget.addEventListener("scroll",this.handleScroll,xt?{passive:!0}:!1),this.listenerTarget.addEventListener("resize",this.handleResize)},removeListeners(){this.listenerTarget&&(this.listenerTarget.removeEventListener("scroll",this.handleScroll),this.listenerTarget.removeEventListener("resize",this.handleResize),this.listenerTarget=null)},scrollToItem(o){let e;const n=this.gridItems||1;this.itemSize===null?e=o>0?this.sizes[o-1].accumulator:0:e=Math.floor(o/n)*this.itemSize,this.scrollToPosition(e)},scrollToPosition(o){const e=this.direction==="vertical"?{scroll:"scrollTop",start:"top"}:{scroll:"scrollLeft",start:"left"};let n,s,l;if(this.pageMode){const r=Kt(this.$el),a=r.tagName==="HTML"?0:r[e.scroll],c=r.getBoundingClientRect(),m=this.$el.getBoundingClientRect()[e.start]-c[e.start];n=r,s=e.scroll,l=o+a+m}else n=this.$el,s=e.scroll,l=o;n[s]=l},itemsLimitError(){throw setTimeout(()=>{console.log("It seems the scroller element isn't scrolling, so it tries to render all the items at once.","Scroller:",this.$el),console.log("Make sure the scroller has a fixed height (or width) and 'overflow-y' (or 'overflow-x') set to 'auto' so it can scroll correctly and only render the items visible in the scroll viewport.")}),new Error("Rendered items limit reached")},sortViews(){this.pool.sort((o,e)=>o.nr.index-e.nr.index)}}};const en={key:0,ref:"before",class:"vue-recycle-scroller__slot"},tn={key:1,ref:"after",class:"vue-recycle-scroller__slot"};function on(o,e,n,s,l,r){const a=t.resolveComponent("ResizeObserver"),c=t.resolveDirective("observe-visibility");return t.withDirectives((t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["vue-recycle-scroller",{ready:l.ready,"page-mode":n.pageMode,[`direction-${o.direction}`]:!0}]),onScrollPassive:e[0]||(e[0]=(...h)=>r.handleScroll&&r.handleScroll(...h))},[o.$slots.before?(t.openBlock(),t.createElementBlock("div",en,[t.renderSlot(o.$slots,"before")],512)):t.createCommentVNode("v-if",!0),(t.openBlock(),t.createBlock(t.resolveDynamicComponent(n.listTag),{ref:"wrapper",style:t.normalizeStyle({[o.direction==="vertical"?"minHeight":"minWidth"]:l.totalSize+"px"}),class:t.normalizeClass(["vue-recycle-scroller__item-wrapper",n.listClass])},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.pool,h=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(n.itemTag),t.mergeProps({key:h.nr.id,style:l.ready?{transform:`translate${o.direction==="vertical"?"Y":"X"}(${h.position}px) translate${o.direction==="vertical"?"X":"Y"}(${h.offset}px)`,width:n.gridItems?`${o.direction==="vertical"&&n.itemSecondarySize||n.itemSize}px`:void 0,height:n.gridItems?`${o.direction==="horizontal"&&n.itemSecondarySize||n.itemSize}px`:void 0}:null,class:["vue-recycle-scroller__item-view",[n.itemClass,{hover:!n.skipHover&&l.hoverKey===h.nr.key}]]},t.toHandlers(n.skipHover?{}:{mouseenter:()=>{l.hoverKey=h.nr.key},mouseleave:()=>{l.hoverKey=null}})),{default:t.withCtx(()=>[t.renderSlot(o.$slots,"default",{item:h.item,index:h.nr.index,active:h.nr.used})]),_:2},1040,["style","class"]))),128)),t.renderSlot(o.$slots,"empty")]),_:3},8,["style","class"])),o.$slots.after?(t.openBlock(),t.createElementBlock("div",tn,[t.renderSlot(o.$slots,"after")],512)):t.createCommentVNode("v-if",!0),t.createVNode(a,{onNotify:r.handleResize},null,8,["onNotify"])],34)),[[c,r.handleVisibilityChange]])}Rt.render=on,Rt.__file="src/components/RecycleScroller.vue";var Et={name:"DynamicScroller",components:{RecycleScroller:Rt},provide(){return typeof ResizeObserver<"u"&&(this.$_resizeObserver=new ResizeObserver(o=>{requestAnimationFrame(()=>{if(Array.isArray(o)){for(const e of o)if(e.target&&e.target.$_vs_onResize){let n,s;if(e.borderBoxSize){const l=e.borderBoxSize[0];n=l.inlineSize,s=l.blockSize}else n=e.contentRect.width,s=e.contentRect.height;e.target.$_vs_onResize(e.target.$_vs_id,n,s)}}})})),{vscrollData:this.vscrollData,vscrollParent:this,vscrollResizeObserver:this.$_resizeObserver}},inheritAttrs:!1,props:{...Jt,minItemSize:{type:[Number,String],required:!0}},emits:["resize","visible"],data(){return{vscrollData:{active:!0,sizes:{},keyField:this.keyField,simpleArray:!1}}},computed:{simpleArray:Xt,itemsWithSize(){const o=[],{items:e,keyField:n,simpleArray:s}=this,l=this.vscrollData.sizes,r=e.length;for(let a=0;a<r;a++){const c=e[a],h=s?a:c[n];let m=l[h];typeof m>"u"&&!this.$_undefinedMap[h]&&(m=0),o.push({item:c,id:h,size:m})}return o}},watch:{items(){this.forceUpdate()},simpleArray:{handler(o){this.vscrollData.simpleArray=o},immediate:!0},direction(o){this.forceUpdate(!0)},itemsWithSize(o,e){const n=this.$el.scrollTop;let s=0,l=0;const r=Math.min(o.length,e.length);for(let c=0;c<r&&!(s>=n);c++)s+=e[c].size||this.minItemSize,l+=o[c].size||this.minItemSize;const a=l-s;a!==0&&(this.$el.scrollTop+=a)}},beforeCreate(){this.$_updates=[],this.$_undefinedSizes=0,this.$_undefinedMap={},this.$_events=qo()},activated(){this.vscrollData.active=!0},deactivated(){this.vscrollData.active=!1},unmounted(){this.$_events.all.clear()},methods:{onScrollerResize(){this.$refs.scroller&&this.forceUpdate(),this.$emit("resize")},onScrollerVisible(){this.$_events.emit("vscroll:update",{force:!1}),this.$emit("visible")},forceUpdate(o=!1){(o||this.simpleArray)&&(this.vscrollData.sizes={}),this.$_events.emit("vscroll:update",{force:!0})},scrollToItem(o){const e=this.$refs.scroller;e&&e.scrollToItem(o)},getItemSize(o,e=void 0){const n=this.simpleArray?e??this.items.indexOf(o):o[this.keyField];return this.vscrollData.sizes[n]||0},scrollToBottom(){if(this.$_scrollingToBottom)return;this.$_scrollingToBottom=!0;const o=this.$el;this.$nextTick(()=>{o.scrollTop=o.scrollHeight+5e3;const e=()=>{o.scrollTop=o.scrollHeight+5e3,requestAnimationFrame(()=>{o.scrollTop=o.scrollHeight+5e3,this.$_undefinedSizes===0?this.$_scrollingToBottom=!1:requestAnimationFrame(e)})};requestAnimationFrame(e)})}}};function nn(o,e,n,s,l,r){const a=t.resolveComponent("RecycleScroller");return t.openBlock(),t.createBlock(a,t.mergeProps({ref:"scroller",items:r.itemsWithSize,"min-item-size":n.minItemSize,direction:o.direction,"key-field":"id","list-tag":o.listTag,"item-tag":o.itemTag},o.$attrs,{onResize:r.onScrollerResize,onVisible:r.onScrollerVisible}),{default:t.withCtx(({item:c,index:h,active:m})=>[t.renderSlot(o.$slots,"default",t.normalizeProps(t.guardReactiveProps({item:c.item,index:h,active:m,itemWithSize:c})))]),before:t.withCtx(()=>[t.renderSlot(o.$slots,"before")]),after:t.withCtx(()=>[t.renderSlot(o.$slots,"after")]),empty:t.withCtx(()=>[t.renderSlot(o.$slots,"empty")]),_:3},16,["items","min-item-size","direction","list-tag","item-tag","onResize","onVisible"])}Et.render=nn,Et.__file="src/components/DynamicScroller.vue";var Yt={name:"DynamicScrollerItem",inject:["vscrollData","vscrollParent","vscrollResizeObserver"],props:{item:{required:!0},watchData:{type:Boolean,default:!1},active:{type:Boolean,required:!0},index:{type:Number,default:void 0},sizeDependencies:{type:[Array,Object],default:null},emitResize:{type:Boolean,default:!1},tag:{type:String,default:"div"}},emits:["resize"],computed:{id(){if(this.vscrollData.simpleArray)return this.index;if(this.vscrollData.keyField in this.item)return this.item[this.vscrollData.keyField];throw new Error(`keyField '${this.vscrollData.keyField}' not found in your item. You should set a valid keyField prop on your Scroller`)},size(){return this.vscrollData.sizes[this.id]||0},finalActive(){return this.active&&this.vscrollData.active}},watch:{watchData:"updateWatchData",id(o,e){if(this.$el.$_vs_id=this.id,this.size||this.onDataUpdate(),this.$_sizeObserved){const n=this.vscrollData.sizes[e],s=this.vscrollData.sizes[o];n!=null&&n!==s&&this.applySize(n)}},finalActive(o){this.size||(o?this.vscrollParent.$_undefinedMap[this.id]||(this.vscrollParent.$_undefinedSizes++,this.vscrollParent.$_undefinedMap[this.id]=!0):this.vscrollParent.$_undefinedMap[this.id]&&(this.vscrollParent.$_undefinedSizes--,this.vscrollParent.$_undefinedMap[this.id]=!1)),this.vscrollResizeObserver?o?this.observeSize():this.unobserveSize():o&&this.$_pendingVScrollUpdate===this.id&&this.updateSize()}},created(){if(!this.$isServer&&(this.$_forceNextVScrollUpdate=null,this.updateWatchData(),!this.vscrollResizeObserver)){for(const o in this.sizeDependencies)this.$watch(()=>this.sizeDependencies[o],this.onDataUpdate);this.vscrollParent.$_events.on("vscroll:update",this.onVscrollUpdate)}},mounted(){this.finalActive&&(this.updateSize(),this.observeSize())},beforeUnmount(){this.vscrollParent.$_events.off("vscroll:update",this.onVscrollUpdate),this.unobserveSize()},methods:{updateSize(){this.finalActive?this.$_pendingSizeUpdate!==this.id&&(this.$_pendingSizeUpdate=this.id,this.$_forceNextVScrollUpdate=null,this.$_pendingVScrollUpdate=null,this.computeSize(this.id)):this.$_forceNextVScrollUpdate=this.id},updateWatchData(){this.watchData&&!this.vscrollResizeObserver?this.$_watchData=this.$watch("item",()=>{this.onDataUpdate()},{deep:!0}):this.$_watchData&&(this.$_watchData(),this.$_watchData=null)},onVscrollUpdate({force:o}){!this.finalActive&&o&&(this.$_pendingVScrollUpdate=this.id),(this.$_forceNextVScrollUpdate===this.id||o||!this.size)&&this.updateSize()},onDataUpdate(){this.updateSize()},computeSize(o){this.$nextTick(()=>{if(this.id===o){const e=this.$el.offsetWidth,n=this.$el.offsetHeight;this.applyWidthHeight(e,n)}this.$_pendingSizeUpdate=null})},applyWidthHeight(o,e){const n=~~(this.vscrollParent.direction==="vertical"?e:o);n&&this.size!==n&&this.applySize(n)},applySize(o){this.vscrollParent.$_undefinedMap[this.id]&&(this.vscrollParent.$_undefinedSizes--,this.vscrollParent.$_undefinedMap[this.id]=void 0),this.vscrollData.sizes[this.id]=o,this.emitResize&&this.$emit("resize",this.id)},observeSize(){this.vscrollResizeObserver&&(this.$_sizeObserved||(this.vscrollResizeObserver.observe(this.$el),this.$el.$_vs_id=this.id,this.$el.$_vs_onResize=this.onResize,this.$_sizeObserved=!0))},unobserveSize(){this.vscrollResizeObserver&&this.$_sizeObserved&&(this.vscrollResizeObserver.unobserve(this.$el),this.$el.$_vs_onResize=void 0,this.$_sizeObserved=!1)},onResize(o,e,n){this.id===o&&this.applyWidthHeight(e,n)}},render(){return t.h(this.tag,this.$slots.default())}};Yt.__file="src/components/DynamicScrollerItem.vue";function It(){const o=t.ref(null);function e(c,h,m){return h.type==="simple"?n(c,h,m):s(c,h,m)}function n(c,h,m){let d;if(h.columnName==="__checkbox"&&m)d=m.isRowChecked(c.rowId);else{const u=c.cells.find(g=>g.columnName===h.columnName);d=u==null?void 0:u.value}const v=h.value;switch(h.operator){case"Equals":return d===v;case"NotEquals":return d!==v;case"GreaterThan":return Number(d)>Number(v);case"LessThan":return Number(d)<Number(v);case"GreaterThanOrEquals":return Number(d)>=Number(v);case"LessThanOrEquals":return Number(d)<=Number(v);case"Contains":return String(d).toLowerCase().includes(String(v).toLowerCase());case"StartsWith":return String(d).toLowerCase().startsWith(String(v).toLowerCase());case"EndsWith":return String(d).toLowerCase().endsWith(String(v).toLowerCase());case"IsEmpty":return d==null||String(d).trim()==="";case"IsNotEmpty":return d!=null&&String(d).trim()!=="";default:return!0}}function s(c,h,m){if(!h.left||!h.right)return console.error("[evaluateCompositeFilter] Invalid filter structure - missing children:",h),!0;const d=e(c,h.left,m);if(h.operator==="AND"&&!d)return!1;if(h.operator==="OR"&&d)return!0;const v=e(c,h.right,m);return h.operator==="AND"?d&&v:d||v}function l(c,h,m){return h?c.filter(d=>e(d,h,m)):c}function r(c){o.value=c}function a(){o.value=null}return{currentFilter:o,filterRows:l,setFilter:r,clearFilter:a,evaluateFilter:e}}function Zt(o){const e=t.ref(""),n=t.ref("Contains"),s=t.ref([]),l=t.ref(-1);function r(u,g,w={}){if(!u){s.value=[],l.value=-1;return}const f=[],p=w.caseSensitive??!1,b=w.fuzzyThreshold??3;for(const y of o.value)for(const S of y.cells){const $=String(S.value||"");let E=!1;const T=p?$:$.toLowerCase(),D=p?u:u.toLowerCase();switch(g){case"Exact":E=p?$===u:$.toLowerCase()===u.toLowerCase();break;case"Contains":E=T.includes(D);break;case"StartsWith":E=T.startsWith(D);break;case"EndsWith":E=T.endsWith(D);break;case"Regex":try{const j=p?"":"i";E=new RegExp(u,j).test($)}catch{E=!1}break;case"Fuzzy":E=a($,u,b);break}E&&f.push({rowId:y.rowId,columnName:S.columnName,value:$})}s.value=f,l.value=f.length>0?0:-1}function a(u,g,w){return c(u.toLowerCase(),g.toLowerCase())<=w}function c(u,g){const w=[];for(let f=0;f<=g.length;f++)w[f]=[f];for(let f=0;f<=u.length;f++)w[0][f]=f;for(let f=1;f<=g.length;f++)for(let p=1;p<=u.length;p++)g.charAt(f-1)===u.charAt(p-1)?w[f][p]=w[f-1][p-1]:w[f][p]=Math.min(w[f-1][p-1]+1,w[f][p-1]+1,w[f-1][p]+1);return w[g.length][u.length]}function h(){l.value<s.value.length-1&&l.value++}function m(){l.value>0&&l.value--}function d(){e.value="",s.value=[],l.value=-1}function v(u,g){return s.value.some(w=>w.rowId===u&&w.columnName===g)}return{searchTerm:e,searchMode:n,searchResults:s,currentResultIndex:l,searchInRows:r,goToNextResult:h,goToPreviousResult:m,clearSearch:d,isSearchMatch:v}}const et=(o="dataGrid")=>yt.defineStore(o,()=>{const e=t.ref(new Map),n=t.ref([]),s=t.ref([]),l=t.ref(new Set),r=t.ref([]),a=t.ref(100),c=t.ref(1),h=t.ref(new Map),m=t.ref([]),d=t.ref(null),v=t.ref(""),u=t.ref({pageSize:100,enableSort:!0,enableFilter:!0,enableSearch:!0,enableValidation:!0,autoValidate:!0,showRowNumber:!1,showCheckbox:!1,showValidationAlerts:!0,showDeleteButton:!1,showInsertButton:!1}),g=t.ref(null),w=t.ref(!1),f=t.ref(!1),p=t.ref(!1),b=t.ref(new Set),y=t.ref(new Set),S=t.computed(()=>n.value.map(k=>e.value.get(k)).filter(Boolean)),$=t.computed(()=>m.value.map(k=>{const H=h.value.get(k);return{columnName:k,direction:H.direction}}));function E(k){return e.value.get(k)}function T(k){return e.value.has(k)}const{filterRows:D,evaluateFilter:j}=It(),{searchResults:F,isSearchMatch:O}=Zt(S),J=t.computed(()=>n.value.length),Y=t.computed(()=>Math.ceil(J.value/a.value)),L=t.computed(()=>{let k=S.value;if(d.value){const z={checkedRows:r.value,isRowChecked:G=>r.value.includes(G)};k=D(k,d.value,z)}if(v.value&&F.value.length>0){const z=new Set(F.value.map(G=>G.rowId));k=k.filter(G=>z.has(G.rowId))}$.value.length>0&&(k=be(k,$.value));const H=(c.value-1)*a.value,N=H+a.value;return k.slice(H,N)});function q(k){var z;console.log("[dataGridStore] loadRows:",{rowCount:k.length,columnCount:s.value.length,autoValidate:u.value.autoValidate});const H=new Map,N=[];k.forEach((G,te)=>{const Z=G.__rowId||M(),se=G.__rowHeight||40,ie={rowId:Z,rowIndex:te,height:se,cells:s.value.map(pe=>({rowId:Z,columnName:pe.name,value:G[pe.name],isSelected:!1,isValidationError:!1}))};H.set(Z,ie),N.push(Z)}),e.value=H,n.value=N,console.log("[dataGridStore] loadRows complete:",{loadedRows:n.value.length,firstRowId:n.value[0],firstRowCells:(z=H.get(n.value[0]))==null?void 0:z.cells.length})}function re(k,H,N){const z=E(k);if(z){const G=z.cells.find(te=>te.columnName===H);if(G){const te=G.value;G.value=N,console.log("[dataGridStore] updateCell:",{rowId:k,columnName:H,oldValue:te,newValue:N,autoValidate:u.value.autoValidate});const Z=`${k}:${H}`;y.value.add(Z)}else console.warn("[dataGridStore] updateCell: cell not found",{rowId:k,columnName:H})}else console.warn("[dataGridStore] updateCell: row not found",{rowId:k})}function oe(k,H){const N=E(k);if(N){const z=N.height;N.height=H,console.log("[dataGridStore] updateRowHeight:",{rowId:k,oldHeight:z,newHeight:H,autoRowHeightEnabled:p.value})}else console.warn("[dataGridStore] updateRowHeight: row not found",{rowId:k})}function he(k){console.log(`[dataGridStore] setAutoRowHeightEnabled: oldValue=${p.value}, newValue=${k}`),p.value=k}function be(k,H){return H.length===0?k:[...k].sort((N,z)=>{for(const{columnName:G,direction:te}of H){const Z=N.cells.find(i=>i.columnName===G),se=z.cells.find(i=>i.columnName===G),ie=Z==null?void 0:Z.value,pe=se==null?void 0:se.value,Ie=ve(ie,pe);if(Ie!==0)return te==="asc"?Ie:-Ie}return 0})}function ve(k,H){return k==null&&H==null?0:k==null?-1:H==null?1:typeof k=="number"&&typeof H=="number"?k-H:String(k).localeCompare(String(H))}function ke(k,H,N=!1){if(!N)h.value.clear(),m.value=[k],h.value.set(k,{direction:H,order:1});else if(h.value.has(k)){const z=h.value.get(k);h.value.set(k,{direction:H,order:z.order})}else{const z=m.value.length+1;h.value.set(k,{direction:H,order:z}),m.value.push(k)}}function B(){h.value.clear(),m.value=[]}function W(k){a.value=k,c.value=1}function ne(k){k>=1&&k<=Y.value&&(c.value=k)}function M(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function A(k){if(T(k)){console.log("[dataGridStore] deleteRow:",{rowId:k,rowsBefore:n.value.length,wasChecked:r.value.includes(k)}),e.value.delete(k),n.value=n.value.filter(N=>N!==k);const H=r.value.indexOf(k);H>-1&&r.value.splice(H,1),n.value.forEach((N,z)=>{const G=e.value.get(N);G&&(G.rowIndex=z)}),console.log("[dataGridStore] deleteRow complete:",{rowsAfter:n.value.length})}else console.warn("[dataGridStore] deleteRow: row not found",{rowId:k})}function U(k){const H=n.value.indexOf(k),N=M();console.log("[dataGridStore] insertRow:",{afterRowId:k,index:H,newRowId:N,rowsBefore:n.value.length});const z={rowId:N,rowIndex:H+1,height:32,cells:s.value.filter(G=>!G.specialType).map(G=>({rowId:N,columnName:G.name,value:null,isSelected:!1,isValidationError:!1}))};e.value.set(N,z),n.value.splice(H+1,0,N),n.value.forEach((G,te)=>{const Z=e.value.get(G);Z&&(Z.rowIndex=te)}),console.log("[dataGridStore] insertRow complete:",{rowsAfter:n.value.length})}function V(k,H,N){const z=n.value.indexOf(k);if(z===-1){console.warn("[dataGridStore] insertMultipleRows: row not found",{rowId:k});return}console.log("[dataGridStore] insertMultipleRows:",{rowId:k,count:H,position:N,index:z,rowsBefore:n.value.length});const G=N==="above"?z:z+1,te=[];for(let Z=0;Z<H;Z++){const se=M(),ie={rowId:se,rowIndex:G+Z,height:32,cells:s.value.filter(pe=>!pe.specialType).map(pe=>({rowId:se,columnName:pe.name,value:null,isSelected:!1,isValidationError:!1}))};e.value.set(se,ie),te.push(se)}n.value.splice(G,0,...te),n.value.forEach((Z,se)=>{const ie=e.value.get(Z);ie&&(ie.rowIndex=se)}),console.log("[dataGridStore] insertMultipleRows complete:",{rowsAfter:n.value.length,newRowIds:te})}function Re(k,H){if(console.log("[toggleCheckbox] Called:",{rowId:k,checked:H,currentCount:r.value.length}),H)r.value.includes(k)||r.value.push(k);else{const N=r.value.indexOf(k);N>-1&&r.value.splice(N,1)}console.log("[toggleCheckbox] After:",{count:r.value.length,checkboxState:Se.value})}function ge(k){return r.value.includes(k)}function ce(){const k=r.value.length,H=S.value.length;console.log("[toggleAllCheckboxes] BEFORE:",{currentCount:k,totalCount:H,checkboxState:Se.value}),r.value.length===S.value.length?(console.log("[toggleAllCheckboxes] ACTION: Unchecking all (was all checked)"),r.value=[]):(console.log("[toggleAllCheckboxes] ACTION: Checking all (was not all checked)"),r.value=S.value.map(G=>G.rowId));const N=r.value.length,z=Se.value;console.log("[toggleAllCheckboxes] AFTER:",{newCount:N,totalCount:H,newState:z})}const Se=t.computed(()=>{const k=r.value.length;return k===0?"none":k===S.value.length?"all":"some"});function De(k){console.log("[dataGridStore] setConfig:",{newConfig:k,oldAutoValidate:u.value.autoValidate,newAutoValidate:k.autoValidate}),u.value={...u.value,...k},k.pageSize&&(a.value=k.pageSize),console.log("[dataGridStore] setConfig complete:",{autoValidate:u.value.autoValidate,enableValidation:u.value.enableValidation})}function Je(k){var G,te;const H=k||a.value;console.log("[dataGridStore] initializeEmptyRows:",{requestedCount:k,rowCount:H,currentRowsLength:S.value.length,columnsLength:s.value.length});const N=new Map,z=[];for(let Z=0;Z<H;Z++){const se=M(),ie={rowId:se,rowIndex:Z,height:32,cells:s.value.filter(pe=>!pe.specialType).map(pe=>({rowId:se,columnName:pe.name,value:null,isSelected:!1,isValidationError:!1}))};N.set(se,ie),z.push(se)}e.value=N,n.value=z,console.log("[dataGridStore] initializeEmptyRows complete:",{newRowsLength:S.value.length,firstRowCellsCount:(te=(G=S.value[0])==null?void 0:G.cells)==null?void 0:te.length})}function ct(k){console.log("[dataGridStore] setFilter:",{filter:k}),d.value=k}function dt(){console.log("[dataGridStore] clearFilter"),d.value=null}function Xe(k){v.value=k}function Ue(){v.value=""}function Ce(k,H,N){const z=`${k}:${H}`;console.log("[dataGridStore] selectCell:",{rowId:k,columnName:H,isCtrlPressed:N,wasSelected:l.value.has(z),currentSelectionCount:l.value.size}),N?(f.value=!0,g.value=null,w.value=!1,l.value.has(z)?(l.value.delete(z),console.log("[dataGridStore] selectCell: toggled OFF",{cellKey:z})):(l.value.add(z),console.log("[dataGridStore] selectCell: toggled ON",{cellKey:z}))):(f.value=!1,g.value={rowId:k,columnName:H},w.value=!1,l.value.clear(),l.value.add(z),console.log("[dataGridStore] selectCell: single select",{cellKey:z})),console.log("[dataGridStore] selectCell complete:",{newSelectionCount:l.value.size})}function He(k,H){g.value&&(w.value=!0,l.value.clear(),Fe(k,H))}function Fe(k,H){if(!g.value||!w.value)return;console.log("[dataGridStore] expandDragSelection:",{pressedCell:g.value,currentRowId:k,currentColumnName:H});const N=S.value.findIndex(i=>i.rowId===g.value.rowId),z=S.value.findIndex(i=>i.rowId===k);if(N===-1||z===-1)return;const G=s.value.filter(i=>!i.specialType||i.specialType==="ValidationAlerts").map(i=>i.name);console.log("[dataGridStore] expandDragSelection: selectableColumns",{total:G.length,columns:G});const te=G.indexOf(g.value.columnName),Z=G.indexOf(H);if(te===-1||Z===-1){console.warn("[dataGridStore] expandDragSelection: column not found in selectableColumns",{pressedColumn:g.value.columnName,currentColumn:H,pressedColIndex:te,currentColIndex:Z});return}const se=Math.min(N,z),ie=Math.max(N,z),pe=Math.min(te,Z),Ie=Math.max(te,Z);console.log("[dataGridStore] expandDragSelection: bounds",{rowRange:[se,ie],colRange:[pe,Ie],cellsToSelect:(ie-se+1)*(Ie-pe+1)}),l.value.clear();for(let i=se;i<=ie;i++){const C=S.value[i].rowId;for(let _=pe;_<=Ie;_++){const x=G[_],I=`${C}:${x}`;l.value.add(I)}}console.log("[dataGridStore] expandDragSelection complete:",{selectedCellsCount:l.value.size})}function Ye(){g.value=null,w.value=!1}function ut(k,H){const N=`${k}:${H}`;return l.value.has(N)}const Ze=["__rowNumber","__checkbox","__validationAlerts","__deleteRow","__insertRow"];function Pe(k){const H=k.filter(z=>!z.specialType).filter(z=>Ze.includes(z.name)).map(z=>z.name);if(H.length>0)throw new Error(`Column name conflict: The following column names are reserved for special columns and cannot be used: ${H.join(", ")}. Reserved names: ${Ze.join(", ")}`);const N=Ee(k);s.value=N,console.log("[dataGridStore] setColumns:",{originalCount:k.length,uniqueCount:N.length,columnNames:N.map(z=>z.name)})}function Ee(k){const H=new Map;return k.map(N=>{const z=N.name,G=H.get(z)||0;return H.set(z,G+1),G>0?{...N,name:`${z}_${G+1}`}:N}).map((N,z,G)=>{const te=N.name.replace(/_\d+$/,"");return G.filter(se=>se.name===te||se.name.startsWith(`${te}_`)).length>1&&N.name===te?{...N,name:`${te}_1`}:N})}function Me(){for(const k of S.value){if(k.cells.every(z=>z.value===null||z.value===void 0||z.value===""))continue;if(k.cells.some(z=>z.isValidationError))return!1}return!0}function Nt(k,H){const N=`${k}:${H}`;console.log("[dataGridStore] markCellValidated:",{rowId:k,columnName:H,cellKey:N,validatedCount:b.value.size}),b.value.add(N),y.value.delete(N)}function zt(){console.log("[dataGridStore] clearValidationTracking:",{clearedValidatedCount:b.value.size,clearedChangedCount:y.value.size}),b.value.clear(),y.value.clear()}function Ft(){console.log("[getCellsNeedingValidation] ðŸ” START",{totalRows:S.value.length,validatedCellsCount:b.value.size,changedCellsCount:y.value.size});const k=new Set(s.value.filter(Z=>Z.visibleForGrid!==!1).map(Z=>Z.name)),H=[];let N=0,z=0,G=0,te=0;for(const Z of S.value){if(Z.cells.every(ie=>ie.value===null||ie.value===void 0||ie.value==="")){N++;continue}for(const ie of Z.cells){if(!k.has(ie.columnName))continue;const pe=`${ie.rowId}:${ie.columnName}`,Ie=b.value.has(pe),i=y.value.has(pe);!Ie||i?(H.push({rowId:ie.rowId,columnName:ie.columnName}),Ie?i&&G++:te++):z++}}return console.log("[getCellsNeedingValidation] ðŸ“Š RESULT:",{cellsToValidate:H.length,neverValidated:te,changedSinceValidation:G,alreadyValidated:z,emptyRowsSkipped:N,sampleCells:H.slice(0,3).map(Z=>`${Z.rowId}:${Z.columnName}`)}),H}return{rows:S,columns:s,selectedCells:l,checkedRows:r,pageSize:a,currentPage:c,sortColumns:$,filterExpression:d,searchQuery:v,searchResults:F,config:u,pressedCell:g,isDragging:w,wasCtrlPressed:f,isAutoRowHeightEnabled:p,visibleRows:L,totalRows:J,totalPages:Y,checkboxState:Se,loadRows:q,updateCell:re,updateRowHeight:oe,setAutoRowHeightEnabled:he,addSort:ke,clearSort:B,setPageSize:W,goToPage:ne,deleteRow:A,insertRow:U,insertMultipleRows:V,toggleCheckbox:Re,isRowChecked:ge,toggleAllCheckboxes:ce,setConfig:De,initializeEmptyRows:Je,setFilter:ct,clearFilter:dt,setSearchQuery:Xe,clearSearch:Ue,selectCell:Ce,startDragSelection:He,expandDragSelection:Fe,endDragSelection:Ye,isCellSelected:ut,setColumns:Pe,ensureUniqueColumnNames:Ee,areNonEmptyRowsValid:Me,markCellValidated:Nt,clearValidationTracking:zt,getCellsNeedingValidation:Ft}});function Qt(o){return typeof o=="function"?o():t.unref(o)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const eo=()=>{};function rn(o,e){function n(...s){return new Promise((l,r)=>{Promise.resolve(o(()=>e.apply(this,s),{fn:e,thisArg:this,args:s})).then(l).catch(r)})}return n}function sn(o,e={}){let n,s,l=eo;const r=c=>{clearTimeout(c),l(),l=eo};return c=>{const h=Qt(o),m=Qt(e.maxWait);return n&&r(n),h<=0||m!==void 0&&m<=0?(s&&(r(s),s=null),Promise.resolve(c())):new Promise((d,v)=>{l=e.rejectOnCancel?v:d,m&&!s&&(s=setTimeout(()=>{n&&r(n),s=null,d(c())},m)),n=setTimeout(()=>{s&&r(s),s=null,d(c())},h)})}}function ln(o,e=200,n={}){return rn(sn(e,n),o)}function to(){const o=t.ref(new Map),e=t.reactive({}),n=t.ref(0),s=t.ref(0);function l(){n.value=Object.keys(e).length}function r(u){const g=o.value.get(u.columnName)||[];g.push(u),o.value.set(u.columnName,g),console.log("[useValidation] addValidationRule:",{columnName:u.columnName,ruleType:u.ruleType,severity:u.severity,totalRulesForColumn:g.length}),s.value++}function a(u,g,w){const f=o.value.get(g)||[];console.log("[useValidation] validateCell:",{rowId:u,columnName:g,value:w,ruleCount:f.length,isEmpty:w==null||w===""});const p=w==null||w==="";for(const b of f){if(b.ruleType==="Required"&&p)return console.log("[useValidation] validateCell FAILED: Required",{rowId:u,columnName:g,error:b.errorMessage,severity:b.severity}),{isValid:!1,error:b.errorMessage,severity:b.severity};if(!p){if(b.ruleType==="Regex"&&b.regexPattern&&!new RegExp(b.regexPattern).test(String(w)))return console.log("[useValidation] validateCell FAILED: Regex",{rowId:u,columnName:g,value:w,pattern:b.regexPattern,error:b.errorMessage}),{isValid:!1,error:b.errorMessage,severity:b.severity};if(b.ruleType==="Range"){const y=Number(w);if(isNaN(y))return console.log("[useValidation] validateCell FAILED: Range (not a number)",{rowId:u,columnName:g,value:w}),{isValid:!1,error:"Value must be a number",severity:b.severity};if(b.minValue!=null&&y<b.minValue)return console.log("[useValidation] validateCell FAILED: Range (below min)",{rowId:u,columnName:g,value:y,minValue:b.minValue}),{isValid:!1,error:b.errorMessage,severity:b.severity};if(b.maxValue!=null&&y>b.maxValue)return console.log("[useValidation] validateCell FAILED: Range (above max)",{rowId:u,columnName:g,value:y,maxValue:b.maxValue}),{isValid:!1,error:b.errorMessage,severity:b.severity}}if(b.ruleType==="Custom"&&b.customValidator&&!b.customValidator(w))return console.log("[useValidation] validateCell FAILED: Custom",{rowId:u,columnName:g,value:w,error:b.errorMessage}),{isValid:!1,error:b.errorMessage,severity:b.severity}}}return console.log("[useValidation] validateCell PASSED",{rowId:u,columnName:g,value:w}),{isValid:!0}}function c(u){return u.every(g=>g.value==null||g.value==="")}const h=ln((u,g,w,f)=>{if(console.log("[useValidation] validateCellThrottled:",{rowId:u,columnName:g,value:w,hasRowCells:!!f,rowCellsCount:f==null?void 0:f.length}),f&&c(f)){console.log("[useValidation] validateCellThrottled: Row is completely empty, clearing errors",{rowId:u}),delete e[u],l();return}const p=a(u,g,w),b=e[u]||[];if(p.isValid){l();const y=b.filter(S=>S.columnName!==g);y.length>0?(e[u]=y,console.log("[useValidation] validateCellThrottled: Cleared error for column, other errors remain",{rowId:u,columnName:g,remainingErrors:y.length})):(l(),delete e[u],console.log("[useValidation] validateCellThrottled: Cleared all errors for row",{rowId:u}))}else{const y=b.findIndex($=>$.columnName===g),S={rowId:u,columnName:g,message:p.error,severity:p.severity};y>=0?(b[y]=S,console.log("[useValidation] validateCellThrottled: Updated existing error",{rowId:u,columnName:g,error:S.message})):(b.push(S),console.log("[useValidation] validateCellThrottled: Added new error",{rowId:u,columnName:g,error:S.message})),e[u]=b}l()},300);async function m(u){var S,$;console.log("[useValidation] validateAll START:",{rowCount:u.length}),Object.keys(e).forEach(E=>delete e[E]);let g=0,w=0;const f=50,p=Math.ceil(u.length/f);for(let E=0;E<p;E++){const T=E*f,D=Math.min(T+f,u.length),j=u.slice(T,D);console.log(`[useValidation] Processing batch ${E+1}/${p} (rows ${T}-${D-1})`);for(const F of j){if(w<3&&console.log("[useValidation] validateAll: Examining row",{rowId:F.rowId,rowIndex:w,cellCount:((S=F.cells)==null?void 0:S.length)||0}),w++,!F.cells||!Array.isArray(F.cells)){console.log("[useValidation] validateAll: Skipping row without cells",{rowId:F.rowId,hasCells:!!F.cells,isArray:Array.isArray(F.cells)});continue}if(c(F.cells)){console.log("[useValidation] validateAll: Skipping empty row",{rowId:F.rowId,cellCount:(($=F.cells)==null?void 0:$.length)||0});continue}for(const O of F.cells){const J=a(F.rowId,O.columnName,O.value);if(!J.isValid){const Y=e[F.rowId]||[];Y.push({rowId:F.rowId,columnName:O.columnName,message:J.error,severity:J.severity}),e[F.rowId]=Y,g++}}}await t.nextTick()}console.log("[useValidation] validateAll - loop FINISHED, processed",w,"rows"),console.log("[useValidation] validateAll - totalErrors:",g);const b=Object.keys(e).length;console.log("[useValidation] validateAll - rowsWithErrors:",b),console.log("[useValidation] validateAll complete - SUCCESS"),console.log("[useValidation] validateAll - calling updateErrorCount..."),l(),console.log("[useValidation] validateAll - updateErrorCount DONE"),console.log("[useValidation] validateAll - building errors array...");const y=[];for(const E in e){const T=e[E];T&&Array.isArray(T)&&y.push(...T)}return console.log("[useValidation] validateAll - errors array built, count:",y.length),console.log("[useValidation] validateAll - returning result..."),{isValid:g===0,totalErrors:g,errors:y}}function d(u){return e[u]||[]}function v(){const u=Object.keys(e).length;console.log("[useValidation] clearValidationErrors:",{clearedCount:u}),Object.keys(e).forEach(g=>delete e[g]),l()}return{validationRules:o,validationErrors:e,errorCount:n,ruleCount:s,addValidationRule:r,validateCell:a,validateCellThrottled:h,validateAll:m,getValidationErrors:d,clearValidationErrors:v}}function oo(){const o=t.ref("");function e(d){return!d||!(d.includes("	")||d.includes(`
`)||d.includes("\r")||d.includes('"'))?d:`"${d.replace(/"/g,'""')}"`}function n(d,v,u={}){const g=[];u.includeHeaders&&g.push(v.map(e).join("	"));for(const w of d){const f=v.map(p=>{const b=w.cells.find(S=>S.columnName===p),y=b==null?void 0:b.value;return e((y==null?void 0:y.toString())??"")});g.push(f.join("	"))}return g.join(`
`)}function s(d){const v=[],u=[];let g="",w=!1,f=!0,p=[];for(let b=0;b<d.length;b++){const y=d[b],S=b+1<d.length?d[b+1]:null;if(y==='"')w&&S==='"'?(g+='"',b++):w=!w;else if(y==="	"&&!w)u.push(g),g="";else if((y===`
`||y==="\r")&&!w){if(y==="\r"&&S===`
`&&b++,g.length>0||u.length>0){if(u.push(g),g="",f){if(l(u))p=[...u];else{p=u.map((E,T)=>`Column${T+1}`);const $={};for(let E=0;E<Math.min(p.length,u.length);E++)$[p[E]]=u[E]||null;v.push($)}f=!1}else{const $={};for(let E=0;E<Math.min(p.length,u.length);E++)$[p[E]]=u[E]||null;v.push($)}u.length=0}}else g+=y}if(g.length>0||u.length>0){if(u.push(g),f&&p.length===0)if(l(u))p=[...u];else{p=u.map((y,S)=>`Column${S+1}`);const b={};for(let y=0;y<Math.min(p.length,u.length);y++)b[p[y]]=u[y]||null;v.push(b)}else if(p.length>0){const b={};for(let y=0;y<Math.min(p.length,u.length);y++)b[p[y]]=u[y]||null;v.push(b)}}return{headers:p,rows:v}}function l(d){return d.some(v=>v&&isNaN(Number(v)))}async function r(d,v,u){var g;try{if(d.size===0)return{success:!1,message:"No cells selected for copy"};console.log("[useCopyPaste] copySelectedCells:",{selectedCount:d.size,selectedCells:Array.from(d)});const w=[];if(d.forEach(E=>{const[T,D]=E.split(":"),j=v.find(J=>J.rowId===T);if(!j)return;const F=u.findIndex(J=>J.name===D);if(F===-1)return;const O=j.cells.find(J=>J.columnName===D);w.push({rowId:T,rowIndex:j.rowIndex,columnName:D,columnIndex:F,value:O==null?void 0:O.value})}),w.length===0)return{success:!1,message:"No valid cells to copy"};const f=Math.min(...w.map(E=>E.rowIndex)),p=Math.max(...w.map(E=>E.rowIndex)),b=Math.min(...w.map(E=>E.columnIndex)),y=Math.max(...w.map(E=>E.columnIndex));console.log("[useCopyPaste] copySelectedCells bounds:",{minRowIndex:f,maxRowIndex:p,minColIndex:b,maxColIndex:y,rows:p-f+1,cols:y-b+1});const S=[];for(let E=f;E<=p;E++){const T=[];for(let D=b;D<=y;D++){const j=w.find(F=>F.rowIndex===E&&F.columnIndex===D);if(j){const F=((g=j.value)==null?void 0:g.toString())??"";T.push(e(F))}else T.push("")}S.push(T.join("	"))}const $=S.join(`
`);return console.log("[useCopyPaste] copySelectedCells TSV:",{lineCount:S.length,preview:$.substring(0,200)}),await navigator.clipboard.writeText($),o.value=$,{success:!0,message:`Copied ${w.length} cells to clipboard`,processedRows:w.length}}catch(w){return console.error("[useCopyPaste] Copy failed:",w),{success:!1,message:`Copy failed: ${w}`}}}async function a(d,v,u={}){try{if(d.length===0)return{success:!1,message:"No data selected for copy"};const g=n(d,v,u);return await navigator.clipboard.writeText(g),o.value=g,{success:!0,message:`Copied ${d.length} rows to clipboard`,processedRows:d.length}}catch(g){return console.error("Copy failed:",g),{success:!1,message:`Copy failed: ${g}`}}}async function c(){try{let d="";try{d=await navigator.clipboard.readText()}catch{d=o.value}if(!d)return{success:!1,message:"No data available in clipboard"};const{headers:v,rows:u}=s(d);return{success:!0,message:`Pasted ${u.length} rows from clipboard`,processedRows:u.length,rows:u,headers:v}}catch(d){return console.error("Paste failed:",d),{success:!1,message:`Paste failed: ${d}`}}}function h(){return!!o.value}function m(){o.value=""}return{copyToClipboard:a,copySelectedCells:r,pasteFromClipboard:c,canPaste:h,clearClipboard:m}}var no=(o=>(o.Append="append",o.Replace="replace",o.Merge="merge",o))(no||{});function an(){function o(s,l,r={}){try{const{includeHiddenColumns:a=!1,includeSpecialColumns:c=!1,onlySelectedRows:h=!1,prettify:m=!0}=r;let d=s;h&&(d=s);const v=d.map(p=>{const b={};for(const y of Object.keys(p))y.startsWith("__")||l.includes(y)&&(b[y]=p[y]);return b}),u=m?JSON.stringify(v,null,2):JSON.stringify(v),g=new Blob([u],{type:"application/json"}),w=URL.createObjectURL(g),f=document.createElement("a");return f.href=w,f.download=`grid-export-${Date.now()}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(w),{success:!0,rowsExported:v.length,message:`Successfully exported ${v.length} rows to JSON`}}catch(a){return console.error("Export to JSON failed:",a),{success:!1,rowsExported:0,message:`Export failed: ${a instanceof Error?a.message:"Unknown error"}`}}}async function e(s,l,r,a={mode:"append"}){try{const c=await s.text();let h;try{h=JSON.parse(c)}catch{return{success:!1,rowsImported:0,rowsSkipped:0,errors:["Invalid JSON format"],message:"Failed to parse JSON file"}}if(!Array.isArray(h))return{success:!1,rowsImported:0,rowsSkipped:0,errors:["JSON must be an array of objects"],message:"Invalid JSON structure"};const m=[];let d=0;if(a.validateSchema&&h.length>0){const u=h[0],g=Object.keys(u),w=r.filter(f=>!g.includes(f));w.length>0&&m.push(`Missing columns in import data: ${w.join(", ")}`)}let v=[];switch(a.mode){case"replace":v=h.map((g,w)=>({...g,__rowId:g.__rowId||`imported-${Date.now()}-${w}`,__rowIndex:w}));break;case"append":v=[...l,...h.map((g,w)=>({...g,__rowId:g.__rowId||`imported-${Date.now()}-${w}`,__rowIndex:l.length+w}))];break;case"merge":const u=new Map(l.map(g=>[g.__rowId,g]));h.forEach((g,w)=>{const f=g.__rowId||`imported-${Date.now()}-${w}`;if(u.has(f)){const p=u.get(f);Object.assign(p,g,{__rowId:f})}else u.set(f,{...g,__rowId:f,__rowIndex:u.size})}),v=Array.from(u.values());break}return v.forEach((u,g)=>{u.__rowIndex=g}),{success:!0,rowsImported:h.length,rowsSkipped:d,errors:m,message:`Successfully imported ${h.length} rows using ${a.mode} mode`,rows:v}}catch(c){return console.error("Import from JSON failed:",c),{success:!1,rowsImported:0,rowsSkipped:0,errors:[c instanceof Error?c.message:"Unknown error"],message:"Import failed"}}}function n(s,l,r={mode:"append"}){return new Promise(a=>{const c=document.createElement("input");c.type="file",c.accept=".json,application/json",c.onchange=async h=>{var v;const m=(v=h.target.files)==null?void 0:v[0];if(!m){a({success:!1,rowsImported:0,rowsSkipped:0,errors:["No file selected"],message:"Import cancelled"});return}const d=await e(m,s,l,r);a(d)},c.oncancel=()=>{a({success:!1,rowsImported:0,rowsSkipped:0,errors:["User cancelled"],message:"Import cancelled"})},c.click()})}return{exportToJson:o,importFromJson:e,openImportDialog:n,ImportMode:no}}const cn={minHeight:32,maxHeight:400,fontFamily:"system-ui, -apple-system, sans-serif",fontSize:14,enableWrapping:!0,padding:16};function ro(o=cn){let e=null,n=null;function s(){if(e||(e=document.createElement("canvas"),n=e.getContext("2d")),!n)throw new Error("Failed to get canvas context");return n.font=`${o.fontSize}px ${o.fontFamily}`,n}function l(d,v){if(!d)return o.minHeight;const u=s();if(!o.enableWrapping)return o.minHeight;const g=d.toString().split(`
`);let w=o.fontSize*1.5,f=0;for(const y of g){if(!y||y.trim()===""){f++;continue}const S=y.split(" ");let $="",E=1;for(const T of S){const D=$?`${$} ${T}`:T;u.measureText(D).width>v-o.padding?($&&E++,$=T):$=D}f+=E}const b=f*w+10;return Math.max(o.minHeight,Math.min(o.maxHeight,Math.ceil(b)))}function r(d,v){try{let u=o.minHeight;for(const g of v){if(g.specialType&&g.specialType!=="ValidationAlerts")continue;let w=null;if(d.cells&&Array.isArray(d.cells)){const b=d.cells.find(y=>y.columnName===g.name);w=b==null?void 0:b.value}else w=d[g.name];if(w==null)continue;const f=String(w),p=l(f,g.width);u=Math.max(u,p)}return{rowId:d.__rowId||d.rowId,calculatedHeight:u,isSuccess:!0}}catch(u){return console.error("Row height calculation failed:",u),{rowId:d.__rowId||d.rowId,calculatedHeight:o.minHeight,isSuccess:!1}}}function a(d,v){return d.map(u=>r(u,v))}async function c(d,v){let u=0,g=0;const w=50,f=Math.ceil(d.length/w);for(let p=0;p<f;p++){const b=p*w,y=Math.min(b+w,d.length),S=d.slice(b,y);console.log(`[AutoRowHeight] Processing batch ${p+1}/${f} (rows ${b}-${y-1})`);for(const $ of S){const E=r($,v);E.isSuccess&&($.height=E.calculatedHeight,u+=E.calculatedHeight,g++)}await new Promise($=>setTimeout($,0))}return{totalRowsUpdated:g,averageHeight:g>0?u/g:o.minHeight}}function h(d,v,u){let g=0;for(const w of d)if(v.includes(w.rowId)){const f=r(w,u);f.isSuccess&&(w.height=f.calculatedHeight,g++)}return g}function m(d){o.maxHeight=d,console.log(`[useAutoRowHeight] maxHeight updated to: ${d}px`)}return{calculateRowHeight:r,calculateRowHeights:a,applyAutoRowHeight:c,recalculateRows:h,measureTextHeight:l,updateMaxHeight:m}}var so=(o=>(o.Normal="normal",o.Editing="editing",o.Selection="selection",o.Any="any",o))(so||{});function lo(o={}){const e=new Map,n=o.context||"normal";function s(f){const p=[];return f.ctrl&&p.push("Ctrl"),f.shift&&p.push("Shift"),f.alt&&p.push("Alt"),f.meta&&p.push("Meta"),p.push(f.key.toUpperCase()),p.join("+")}function l(f,p){return f.key.toUpperCase()===p.key.toUpperCase()&&!!f.ctrlKey==!!p.ctrl&&!!f.shiftKey==!!p.shift&&!!f.altKey==!!p.alt&&!!f.metaKey==!!p.meta}function r(f,p){return f==="any"||f===p||p==="any"}async function a(f){if(!o.enabled&&o.enabled!==void 0)return;const p=Array.from(e.values()).filter(y=>y.enabled!==!1&&l(f,y.key)&&r(y.context||"normal",n));if(p.length===0)return;p.sort((y,S)=>(S.priority||0)-(y.priority||0));const b=p[0];f.preventDefault(),f.stopPropagation();try{await b.handler(f)}catch(y){console.error(`Shortcut execution failed for ${b.name}:`,y)}}function c(f){const p=s(f.key);e.has(p)&&console.warn(`Shortcut ${p} is already registered. Overwriting.`),e.set(p,{...f,enabled:f.enabled!==!1,context:f.context||"normal",priority:f.priority||0})}function h(f){f.forEach(c)}function m(f){const p=s(f);return e.delete(p)}function d(f){const p=Array.from(e.entries()).find(([b,y])=>y.name===f);return p?(e.delete(p[0]),!0):!1}function v(f,p){const b=Array.from(e.entries()).find(([y,S])=>S.name===f);b&&(b[1].enabled=p)}function u(){return Array.from(e.values())}function g(f){return Array.from(e.values()).filter(p=>p.context===f||p.context==="any")}function w(){e.clear()}return t.onMounted(()=>{o.enabled!==!1&&document.addEventListener("keydown",a)}),t.onUnmounted(()=>{document.removeEventListener("keydown",a)}),{registerShortcut:c,registerShortcuts:h,unregisterShortcut:m,unregisterShortcutByName:d,setShortcutEnabled:v,getShortcuts:u,getShortcutsByContext:g,clearShortcuts:w,handleKeyDown:a}}const _e={ctrl:o=>({key:o,ctrl:!0}),shift:o=>({key:o,shift:!0}),alt:o=>({key:o,alt:!0}),ctrlShift:o=>({key:o,ctrl:!0,shift:!0}),ctrlAlt:o=>({key:o,ctrl:!0,alt:!0}),single:o=>({key:o})};function dn(o){const e=[];return o.onCopy&&e.push({name:"Copy",key:_e.ctrl("c"),handler:o.onCopy,description:"Copy selected cells",priority:100}),o.onPaste&&e.push({name:"Paste",key:_e.ctrl("v"),handler:o.onPaste,description:"Paste from clipboard",priority:100}),o.onCut&&e.push({name:"Cut",key:_e.ctrl("x"),handler:o.onCut,description:"Cut selected cells",priority:100}),o.onDelete&&e.push({name:"Delete",key:_e.single("Delete"),handler:o.onDelete,description:"Delete selected cells",priority:100}),o.onSelectAll&&e.push({name:"SelectAll",key:_e.ctrl("a"),handler:o.onSelectAll,description:"Select all cells",priority:100}),o.onFind&&e.push({name:"Find",key:_e.ctrl("f"),handler:o.onFind,description:"Open find dialog",priority:100}),o.onUndo&&e.push({name:"Undo",key:_e.ctrl("z"),handler:o.onUndo,description:"Undo last action",priority:100}),o.onRedo&&e.push({name:"Redo",key:_e.ctrlShift("z"),handler:o.onRedo,description:"Redo last undone action",priority:100}),o.onEscape&&e.push({name:"Escape",key:_e.single("Escape"),handler:o.onEscape,description:"Cancel current operation",priority:100}),o.onEnter&&e.push({name:"Enter",key:_e.single("Enter"),handler:o.onEnter,description:"Confirm edit and move to next row",context:"editing",priority:100}),o.onTab&&e.push({name:"Tab",key:_e.single("Tab"),handler:o.onTab,description:"Move to next cell",priority:100}),o.onArrowUp&&e.push({name:"ArrowUp",key:_e.single("ArrowUp"),handler:o.onArrowUp,description:"Move selection up",priority:50}),o.onArrowDown&&e.push({name:"ArrowDown",key:_e.single("ArrowDown"),handler:o.onArrowDown,description:"Move selection down",priority:50}),o.onArrowLeft&&e.push({name:"ArrowLeft",key:_e.single("ArrowLeft"),handler:o.onArrowLeft,description:"Move selection left",priority:50}),o.onArrowRight&&e.push({name:"ArrowRight",key:_e.single("ArrowRight"),handler:o.onArrowRight,description:"Move selection right",priority:50}),e}const Ge=t.ref([]),Tt=t.ref(!1),un=50,hn=100;let tt=null;function fn(){return new Date().toISOString()}function ot(o,e,n,s){const l={timestamp:fn(),level:o,category:e,message:n,data:s!==void 0?JSON.parse(JSON.stringify(s)):void 0};Ge.value.push(l),Tt.value||gn()}function gn(){tt===null&&(Tt.value=!0,tt=window.setInterval(()=>{pn()},hn))}function io(){tt!==null&&(window.clearInterval(tt),tt=null),Tt.value=!1}function pn(){if(Ge.value.length===0){io();return}const o=Ge.value.splice(0,un);for(const e of o)ao(e)}function ao(o){const n=`${`[${o.timestamp}] [${o.level}] [${o.category}]`} ${o.message}`;switch(o.level){case"DEBUG":o.data!==void 0?console.debug(n,o.data):console.debug(n);break;case"INFO":o.data!==void 0?console.log(n,o.data):console.log(n);break;case"WARN":o.data!==void 0?console.warn(n,o.data):console.warn(n);break;case"ERROR":case"FATAL":o.data!==void 0?console.error(n,o.data):console.error(n);break}}function co(o="App"){return{debug(e,n){ot("DEBUG",o,e,n)},info(e,n){ot("INFO",o,e,n)},warn(e,n){ot("WARN",o,e,n)},error(e,n){ot("ERROR",o,e,n)},fatal(e,n){ot("FATAL",o,e,n)},flush(){for(;Ge.value.length>0;){const e=Ge.value.shift();ao(e)}io()},getQueueSize(){return Ge.value.length}}}const mn="http://localhost:5000/api/grid";class wn{constructor(){this.isHostMode=!1,this.isHostMode=this.detectHostMode(),console.log(`Grid API Mode: ${this.isHostMode?"Host Objects":"HTTP"}`)}detectHostMode(){return!!window.gridApi}async callHostApi(e,...n){try{if(!window.gridApi)throw new Error("Grid API not available");const l=await window.gridApi[e](...n);return JSON.parse(l)}catch(s){return console.error("Grid API call failed:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async request(e,n){try{const s=await fetch(`${mn}${e}`,{...n,headers:{"Content-Type":"application/json",...n==null?void 0:n.headers},credentials:"include"});return s.ok?await s.json():{success:!1,error:(await s.json().catch(()=>({error:s.statusText}))).error||`HTTP ${s.status}: ${s.statusText}`}}catch(s){return console.error("API request failed:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async getData(){return this.isHostMode?this.callHostApi("GetData"):this.request("/data")}async importData(e){if(this.isHostMode){const n=JSON.stringify({data:e});return this.callHostApi("ImportData",n)}else return this.request("/import",{method:"POST",body:JSON.stringify({data:e})})}async exportData(e){if(this.isHostMode){const n=JSON.stringify({OnlyFiltered:(e==null?void 0:e.onlyFiltered)??!1,FilteredRowIds:(e==null?void 0:e.filteredRowIds)??null,ColumnNames:(e==null?void 0:e.columnNames)??null});return this.callHostApi("ExportData",n)}else{const n=new URLSearchParams;e!=null&&e.onlyFiltered&&n.append("onlyFiltered","true"),e!=null&&e.filteredRowIds&&n.append("filteredRowIds",JSON.stringify(e.filteredRowIds)),e!=null&&e.columnNames&&n.append("columnNames",JSON.stringify(e.columnNames));const s=n.toString()?`?${n.toString()}`:"";return this.request(`/export${s}`)}}async getConfig(){return this.isHostMode?this.callHostApi("GetConfig"):this.request("/config")}async setValidationRules(e){if(this.isHostMode){const n=JSON.stringify({rules:e});return this.callHostApi("SetValidationRules",n)}else return this.request("/validation-rules",{method:"POST",body:JSON.stringify({rules:e})})}async getValidationRules(){return this.isHostMode?this.callHostApi("GetValidationRules"):this.request("/validation-rules")}async getColumns(){return this.isHostMode?this.callHostApi("GetColumns"):this.request("/columns/definitions")}async getCurrentData(){return this.isHostMode?this.callHostApi("GetCurrentData"):this.getData()}async getColumnNames(){var e;if(this.isHostMode){const n=await this.callHostApi("GetColumnNames");return{success:n.success,data:(e=n.data)==null?void 0:e.columnNames,error:n.error}}else return this.request("/columns")}async healthCheck(){try{return this.isHostMode?(await this.callHostApi("HealthCheck")).success:(await fetch("http://localhost:5000/health")).ok}catch{return!1}}}const pt=new wn,Ae={cellColors:{defaultBackground:"#ffffff",defaultForeground:"#212529",hoverBackground:"#f8f9fa",hoverForeground:"#212529",focusedBackground:"#e3f2fd",focusedForeground:"#0d6efd",disabledBackground:"#e9ecef",disabledForeground:"#6c757d",readOnlyBackground:"#f8f9fa",readOnlyForeground:"#495057"},rowColors:{evenRowBackground:"#ffffff",oddRowBackground:"#f8f9fa",hoverBackground:"#e3f2fd",selectedBackground:"#0d6efd",selectedForeground:"#ffffff",selectedInactiveBackground:"#e9ecef",selectedInactiveForeground:"#495057"},headerColors:{background:"#f1f3f5",foreground:"#212529",hoverBackground:"#e9ecef",pressedBackground:"#dee2e6",sortIndicatorColor:"#0d6efd"},validationColors:{errorBackground:"#ffebee",errorForeground:"#c62828",errorBorder:"#ef5350",warningBackground:"#fff3e0",warningForeground:"#e65100",warningBorder:"#ff9800",infoBackground:"#e3f2fd",infoForeground:"#1565c0",infoBorder:"#2196f3"},selectionColors:{selectionBorder:"#0d6efd",selectionFill:"rgba(13, 110, 253, 0.1)",multiSelectionBackground:"#bbdefb",multiSelectionForeground:"#0d6efd"},borderColors:{cellBorder:"#e0e0e0",rowBorder:"#e0e0e0",columnBorder:"#dee2e6",gridBorder:"#ced4da",focusedCellBorder:"#0d6efd"},specialColumnColors:{rowNumberBackground:"#f5f5f5",rowNumberForeground:"#666666",checkboxBorder:"#ced4da",checkboxBackground:"#ffffff",checkboxForeground:"#212529",deleteRowBackground:"transparent",deleteRowForeground:"#dc3545",deleteRowHoverBackground:"#ffebee",insertRowBackground:"transparent",insertRowForeground:"#28a745",insertRowBorder:"transparent",insertRowHoverBackground:"#e8f5e9",insertRowHoverForeground:"#1b5e20",validationAlertsErrorBackground:"#ffebee",validationAlertsErrorForeground:"#c62828"},uiControlColors:{resizeGripColor:"#adb5bd",menuBackground:"#ffffff",menuForeground:"#212529",menuHoverBackground:"#f8f9fa",dialogBackground:"#ffffff",dialogForeground:"#212529",dialogBorder:"#dee2e6",placeholderColor:"#6c757d",searchPanelBackground:"#f8f9fa",searchPanelForeground:"#212529",searchPanelBorder:"#ced4da",filterRowBackground:"#f8f9fa",filterRowForeground:"#212529",filterRowBorder:"#dee2e6",paginationBackground:"#ffffff",paginationForeground:"#212529",paginationBorder:"#dee2e6",paginationButtonHoverBackground:"#e9ecef"}},qe={itemColors:{defaultBackground:"#ffffff",defaultForeground:"#212529",hoverBackground:"#f8f9fa",hoverForeground:"#212529",selectedBackground:"#e3f2fd",selectedForeground:"#0d6efd",selectedHoverBackground:"#bbdefb",selectedHoverForeground:"#0d6efd",disabledBackground:"#e9ecef",disabledForeground:"#6c757d"},containerColors:{background:"#ffffff",border:"#ced4da",focusedBorder:"#0d6efd",titleForeground:"#212529"},checkboxColors:{border:"#ced4da",background:"#ffffff",checkedBackground:"#0d6efd",checkedBorder:"#0d6efd",hoverBorder:"#adb5bd"},scrollbarColors:{trackBackground:"#f1f1f1",thumbBackground:"#c1c1c1",thumbHoverBackground:"#a8a8a8"}},bn=Symbol("theme");function Cn(){return t.inject(bn,{dataGridTheme:t.ref(Ae),listBoxTheme:t.ref(qe)})}function yn(o){return{"--dg-cell-bg":o.cellColors.defaultBackground,"--dg-cell-fg":o.cellColors.defaultForeground,"--dg-cell-hover-bg":o.cellColors.hoverBackground,"--dg-cell-hover-fg":o.cellColors.hoverForeground,"--dg-cell-focused-bg":o.cellColors.focusedBackground,"--dg-cell-focused-fg":o.cellColors.focusedForeground,"--dg-cell-disabled-bg":o.cellColors.disabledBackground,"--dg-cell-disabled-fg":o.cellColors.disabledForeground,"--dg-cell-readonly-bg":o.cellColors.readOnlyBackground,"--dg-cell-readonly-fg":o.cellColors.readOnlyForeground,"--dg-row-even-bg":o.rowColors.evenRowBackground,"--dg-row-odd-bg":o.rowColors.oddRowBackground,"--dg-row-hover-bg":o.rowColors.hoverBackground,"--dg-row-selected-bg":o.rowColors.selectedBackground,"--dg-row-selected-fg":o.rowColors.selectedForeground,"--dg-row-selected-inactive-bg":o.rowColors.selectedInactiveBackground,"--dg-row-selected-inactive-fg":o.rowColors.selectedInactiveForeground,"--dg-header-bg":o.headerColors.background,"--dg-header-fg":o.headerColors.foreground,"--dg-header-hover-bg":o.headerColors.hoverBackground,"--dg-header-pressed-bg":o.headerColors.pressedBackground,"--dg-header-sort-indicator":o.headerColors.sortIndicatorColor,"--dg-validation-error-bg":o.validationColors.errorBackground,"--dg-validation-error-fg":o.validationColors.errorForeground,"--dg-validation-error-border":o.validationColors.errorBorder,"--dg-validation-warning-bg":o.validationColors.warningBackground,"--dg-validation-warning-fg":o.validationColors.warningForeground,"--dg-validation-warning-border":o.validationColors.warningBorder,"--dg-validation-info-bg":o.validationColors.infoBackground,"--dg-validation-info-fg":o.validationColors.infoForeground,"--dg-validation-info-border":o.validationColors.infoBorder,"--dg-selection-border":o.selectionColors.selectionBorder,"--dg-selection-fill":o.selectionColors.selectionFill,"--dg-multi-selection-bg":o.selectionColors.multiSelectionBackground,"--dg-multi-selection-fg":o.selectionColors.multiSelectionForeground,"--dg-border-cell":o.borderColors.cellBorder,"--dg-border-row":o.borderColors.rowBorder,"--dg-border-column":o.borderColors.columnBorder,"--dg-border-grid":o.borderColors.gridBorder,"--dg-border-focused-cell":o.borderColors.focusedCellBorder,"--dg-special-rownumber-bg":o.specialColumnColors.rowNumberBackground,"--dg-special-rownumber-fg":o.specialColumnColors.rowNumberForeground,"--dg-special-checkbox-border":o.specialColumnColors.checkboxBorder,"--dg-special-checkbox-bg":o.specialColumnColors.checkboxBackground,"--dg-special-checkbox-fg":o.specialColumnColors.checkboxForeground,"--dg-special-delete-bg":o.specialColumnColors.deleteRowBackground,"--dg-special-delete-fg":o.specialColumnColors.deleteRowForeground,"--dg-special-delete-hover-bg":o.specialColumnColors.deleteRowHoverBackground,"--dg-special-insert-bg":o.specialColumnColors.insertRowBackground,"--dg-special-insert-fg":o.specialColumnColors.insertRowForeground,"--dg-special-insert-border":o.specialColumnColors.insertRowBorder,"--dg-special-insert-hover-bg":o.specialColumnColors.insertRowHoverBackground,"--dg-special-insert-hover-fg":o.specialColumnColors.insertRowHoverForeground,"--dg-special-validation-error-bg":o.specialColumnColors.validationAlertsErrorBackground,"--dg-special-validation-error-fg":o.specialColumnColors.validationAlertsErrorForeground,"--dg-ui-resize-grip":o.uiControlColors.resizeGripColor,"--dg-ui-menu-bg":o.uiControlColors.menuBackground,"--dg-ui-menu-fg":o.uiControlColors.menuForeground,"--dg-ui-menu-hover-bg":o.uiControlColors.menuHoverBackground,"--dg-ui-dialog-bg":o.uiControlColors.dialogBackground,"--dg-ui-dialog-fg":o.uiControlColors.dialogForeground,"--dg-ui-dialog-border":o.uiControlColors.dialogBorder,"--dg-ui-placeholder":o.uiControlColors.placeholderColor,"--dg-ui-search-bg":o.uiControlColors.searchPanelBackground,"--dg-ui-search-fg":o.uiControlColors.searchPanelForeground,"--dg-ui-search-border":o.uiControlColors.searchPanelBorder,"--dg-ui-filter-bg":o.uiControlColors.filterRowBackground,"--dg-ui-filter-fg":o.uiControlColors.filterRowForeground,"--dg-ui-filter-border":o.uiControlColors.filterRowBorder,"--dg-ui-pagination-bg":o.uiControlColors.paginationBackground,"--dg-ui-pagination-fg":o.uiControlColors.paginationForeground,"--dg-ui-pagination-border":o.uiControlColors.paginationBorder,"--dg-ui-pagination-button-hover-bg":o.uiControlColors.paginationButtonHoverBackground}}function vn(o){return{"--lb-item-bg":o.itemColors.defaultBackground,"--lb-item-fg":o.itemColors.defaultForeground,"--lb-item-hover-bg":o.itemColors.hoverBackground,"--lb-item-hover-fg":o.itemColors.hoverForeground,"--lb-item-selected-bg":o.itemColors.selectedBackground,"--lb-item-selected-fg":o.itemColors.selectedForeground,"--lb-item-selected-hover-bg":o.itemColors.selectedHoverBackground,"--lb-item-selected-hover-fg":o.itemColors.selectedHoverForeground,"--lb-item-disabled-bg":o.itemColors.disabledBackground,"--lb-item-disabled-fg":o.itemColors.disabledForeground,"--lb-container-bg":o.containerColors.background,"--lb-container-border":o.containerColors.border,"--lb-container-focused-border":o.containerColors.focusedBorder,"--lb-title-fg":o.containerColors.titleForeground,"--lb-checkbox-border":o.checkboxColors.border,"--lb-checkbox-bg":o.checkboxColors.background,"--lb-checkbox-checked-bg":o.checkboxColors.checkedBackground,"--lb-checkbox-checked-border":o.checkboxColors.checkedBorder,"--lb-checkbox-hover-border":o.checkboxColors.hoverBorder,"--lb-scrollbar-track-bg":o.scrollbarColors.trackBackground,"--lb-scrollbar-thumb-bg":o.scrollbarColors.thumbBackground,"--lb-scrollbar-thumb-hover-bg":o.scrollbarColors.thumbHoverBackground}}let Ne=null;function _n(){return Ne!==null}function Sn(o){Ne&&ho(),Ne=o}function uo(o){o===Ne&&(Ne=null)}function ho(){Ne&&(Ne.closeMenu(),Ne=null)}const Be={defaultDirection:"br",defaultMinWidth:100,defaultMaxWidth:600,defaultZindex:100,defaultZoom:1,defaultAdjustPadding:{x:0,y:10}};function nt(o,e){let n=o.offsetTop;return o.offsetParent!=null&&o.offsetParent!=e&&(n-=o.offsetParent.scrollTop,n+=nt(o.offsetParent,e)),n}function rt(o,e){let n=o.offsetLeft;return o.offsetParent!=null&&o.offsetParent!=e&&(n-=o.offsetParent.scrollLeft,n+=rt(o.offsetParent,e)),n}function kn(o,e,n,s){return{x:rt(o,s)+e,y:nt(o,s)+n}}const $t="mx-menu-default-container",xn="mx-menu-container-";let Rn=0;function fo(o){const{getContainer:e,zIndex:n}=o;if(e){const l=typeof e=="function"?e():e;if(l){let r=l.getAttribute("id");return r||(r=xn+Rn++,l.setAttribute("id",r)),{eleId:r,container:l,isNew:!1}}}let s=document.getElementById($t);return s||(s=document.createElement("div"),s.setAttribute("id",$t),s.setAttribute("class","mx-menu-ghost-host fullscreen"),document.body.appendChild(s)),s.style.zIndex=(n==null?void 0:n.toString())||Be.defaultZindex.toString(),{eleId:$t,container:s,isNew:!0}}function En(o){let e=0;for(let n=0;n<o.length;n++){const s=o.charCodeAt(n);e=(e<<5)-e+s,e|=0}return e}function go(o){return typeof o=="number"?`${o}px`:o}const Ve=t.defineComponent({props:{vnode:{type:null},data:{type:null,default:null}},setup(o){const{vnode:e,data:n}=t.toRefs(o);return()=>typeof e.value=="function"?e.value(n.value):e.value}});function In(o,e){const n={...o};return delete n[e],n}var Tn=Object.defineProperty,$n=(o,e,n)=>e in o?Tn(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,po=(o,e,n)=>$n(o,typeof e!="symbol"?e+"":e,n);class mo{constructor(e,n){po(this,"x",0),po(this,"y",0),this.x=e||0,this.y=n||0}set(e,n){this.x=e,this.y=n}substract(e){this.x-=e.x,this.y-=e.y}}function wo(o){const{onDown:e,onMove:n,onUp:s}=o,l=new mo,r=new mo;let a;function c(m){m.stopPropagation(),r.set(m.x,m.y),r.substract(l),n(l,r,m,a)}function h(m){s(m,a),l.set(0,0),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h)}return(m,d)=>e(m,d)?(a=d,l.set(m.x,m.y),document.addEventListener("mousemove",c),document.addEventListener("mouseup",h),m.stopPropagation(),!0):!1}function An(o,e){let n=0;return{start(){n>0&&clearInterval(n),n=setInterval(()=>{n=0,e()},o)},stop(){n>0&&(clearInterval(n),n=0)}}}const st=[],bo=An(100,()=>{for(const o of st)o()});function Bn(o,e,n,s){let l=0,r=0;function a(){o.value&&(e&&l!==o.value.offsetWidth&&e(o.value.offsetWidth),n&&r!==o.value.offsetHeight&&n(o.value.offsetHeight),l=o.value.offsetWidth,r=o.value.offsetHeight)}return{startResizeChecker(){bo.start(),st.push(a)},stopResizeChecker(){const c=st.indexOf(a);c>=0&&st.splice(c,1),st.length===0&&bo.stop()}}}const Co=140,Vn=70,Mn=t.defineComponent({__name:"ScrollRect",props:{scroll:{type:String,default:"both"},scrollBarAlwaysShow:{type:Boolean,default:!1},scrollBarBackgroundClickable:{type:Boolean,default:!1},height:{type:Number,default:void 0},width:{type:Number,default:void 0},maxHeight:{type:Number,default:void 0},maxWidth:{type:Number,default:void 0},containerClass:{type:String,default:""},containerStyle:{type:null}},emits:["scroll","resized"],setup(o,{expose:e,emit:n}){const s=o,l=n,r=t.ref(),a=t.ref(),c=t.ref(),h=t.ref(),m=t.ref(),d=t.ref(),v=t.ref(!1),u=t.computed(()=>s.scroll==="horizontal"||s.scroll==="both"),g=t.computed(()=>s.scroll==="vertical"||s.scroll==="both"),w=t.reactive({show:!1,size:0,sizeRaw:0,pos:0}),f=t.reactive({show:!1,size:0,sizeRaw:0,pos:0});let p=0,b=0,y=0,S=0,$=null;const E={attributes:!0,childList:!0};function T(){if(r.value){if(w.show){const A=r.value.offsetWidth/r.value.scrollWidth;w.sizeRaw=A*r.value.offsetWidth,w.size=A*100,w.pos=r.value.scrollLeft/(r.value.scrollWidth-r.value.offsetWidth)*(100-w.size),A>=1&&(w.show=!1)}if(f.show){const A=r.value.offsetHeight/r.value.scrollHeight;f.sizeRaw=A*r.value.offsetHeight,f.size=A*100,f.pos=r.value.scrollTop/(r.value.scrollHeight-r.value.offsetHeight)*(100-f.size),A>=1&&(f.show=!1)}l("scroll",r.value.scrollLeft,r.value.scrollTop)}}function D(A=!1){if(!r.value)return;let U=u.value,V=g.value;const Re=U&&(p!==r.value.scrollWidth||y!==r.value.offsetWidth),ge=g&&(b!==r.value.scrollHeight||S!==r.value.offsetHeight);if(!A&&!Re&&!ge)return;const ce=window.getComputedStyle(r.value);(ce.overflow==="hidden"||ce.overflowX==="hidden")&&(U=!1),(ce.overflow==="hidden"||ce.overflowY==="hidden")&&(V=!1),w.show=U,f.show=V,T(),y=r.value.offsetWidth,S=r.value.offsetHeight,p=r.value.scrollWidth,b=r.value.scrollHeight,l("resized",p,b)}function j(A){var U;s.scroll=="horizontal"&&(A.deltaMode==0&&((U=r.value)==null||U.scrollTo({left:r.value.scrollLeft+(A.deltaY>0?Co:-140),behavior:"smooth"})),A.preventDefault(),A.stopPropagation())}function F(A){var U;A.deltaMode==0&&((U=r.value)==null||U.scrollTo({left:r.value.scrollLeft+(A.deltaY>0?Co:-140),behavior:"smooth"}),A.preventDefault(),A.stopPropagation())}function O(A){var U;A.deltaMode==0&&((U=r.value)==null||U.scrollTo({top:r.value.scrollTop+(A.deltaY>0?Vn:-70),behavior:"smooth"}),A.preventDefault(),A.stopPropagation())}let J=0,Y=0,L=0,q=0;const re=wo({onDown(A){return!c.value||!m.value?!1:(J=A.offsetX,Y=A.x-A.offsetX-m.value.offsetLeft,A.preventDefault(),v.value=!0,!0)},onMove(A,U,V){r.value&&c.value&&(ve(V.x-J-Y),V.preventDefault(),V.stopPropagation())},onUp(){v.value=!1}}),oe=wo({onDown(A){return!h.value||!d.value?!1:(L=A.offsetY,q=A.y-A.offsetY-d.value.offsetTop,A.preventDefault(),v.value=!0,!0)},onMove(A,U,V){r.value&&h.value&&(ke(V.y-L-q),V.preventDefault(),V.stopPropagation())},onUp(){v.value=!1}});function he(A){r.value&&(r.value.scrollLeft=A/100*(r.value.scrollWidth-r.value.offsetWidth))}function be(A){r.value&&(r.value.scrollLeft=A/100*(r.value.scrollHeight-r.value.offsetHeight))}function ve(A){r.value&&(r.value.scrollLeft=A/(r.value.offsetWidth-w.sizeRaw)*(r.value.scrollWidth-r.value.offsetWidth))}function ke(A){r.value&&(r.value.scrollTop=A/(r.value.offsetHeight-f.sizeRaw)*(r.value.scrollHeight-r.value.offsetHeight))}function B(A){s.scrollBarBackgroundClickable&&ve(A.offsetX-w.sizeRaw/2)}function W(A){s.scrollBarBackgroundClickable&&ke(A.offsetY-f.sizeRaw/2)}const{startResizeChecker:ne,stopResizeChecker:M}=Bn(r,()=>D(),()=>D());return t.onMounted(()=>{t.nextTick(()=>{setTimeout(()=>D(!0),200),D(!0),ne(),$=new MutationObserver(()=>D()),$.observe(r.value,E)})}),t.onBeforeUnmount(()=>{M(),$&&($.disconnect(),$=null)}),e({refreshScrollState(){D(!0)},getScrollContainer(){return r.value},scrollTo(A,U){var V;(V=r.value)==null||V.scrollTo(A,U)},scrollToTop(){var A;(A=r.value)==null||A.scrollTo(0,0)},scrollToBottom(){var A;(A=r.value)==null||A.scrollTo(r.value.scrollWidth,r.value.scrollHeight)}}),(A,U)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"scrollrect",ref:a,class:t.normalizeClass(["vue-scroll-rect",o.scrollBarAlwaysShow?"always-show-scrollbar":"",o.scrollBarBackgroundClickable?"background-clickable":"",v.value?"dragging":""]),style:t.normalizeStyle({width:o.width?`${o.width}px`:void 0,height:o.height?`${o.height}px`:void 0}),onWheel:j},[t.createElementVNode("div",{ref_key:"container",ref:r,class:t.normalizeClass(["scroll-content",o.scroll,o.containerClass]),style:t.normalizeStyle({maxWidth:o.maxWidth?`${o.maxWidth}px`:void 0,maxHeight:o.maxHeight?`${o.maxHeight}px`:void 0,...o.containerStyle}),onScroll:T},[t.renderSlot(A.$slots,"default")],38),w.show?t.renderSlot(A.$slots,"scrollBarX",{key:0,scrollBarValue:w,onScroll:he},()=>[t.createElementVNode("div",{ref_key:"scrollBarRefX",ref:c,class:"scrollbar horizontal",onClick:B,onWheel:F},[t.createElementVNode("div",{class:"thumb",ref_key:"scrollBarThumbRefX",ref:m,style:t.normalizeStyle({left:`${w.pos}%`,width:`${w.size}%`}),onMousedown:U[0]||(U[0]=(...V)=>t.unref(re)&&t.unref(re)(...V)),onWheel:F},null,36)],544)]):t.createCommentVNode("",!0),f.show?t.renderSlot(A.$slots,"scrollBarY",{key:1,scrollBarValue:f,onScroll:be},()=>[f.show?(t.openBlock(),t.createElementBlock("div",{key:0,ref_key:"scrollBarRefY",ref:h,class:"scrollbar vertical",onClick:W,onWheel:O},[t.createElementVNode("div",{class:"thumb",ref_key:"scrollBarThumbRefY",ref:d,style:t.normalizeStyle({top:`${f.pos}%`,height:`${f.size}%`}),onMousedown:U[1]||(U[1]=(...V)=>t.unref(oe)&&t.unref(oe)(...V)),onWheel:O},null,36)],544)):t.createCommentVNode("",!0)]):t.createCommentVNode("",!0)],38))}}),At=(o,e)=>{const n=o.__vccOpts||o;for(const[s,l]of e)n[s]=l;return n},Dn={},Hn={class:"mx-checked-mark","aria-hidden":"true",viewBox:"0 0 1024 1024"},Pn=t.createElementVNode("path",{d:"M129.3,428.6L52,512l345,372.5l575-620.8l-69.5-75L400.4,718.2L129.3,428.6z"},null,-1),Nn=[Pn];function zn(o,e){return t.openBlock(),t.createElementBlock("svg",Hn,Nn)}const Fn=At(Dn,[["render",zn]]),On={},Wn={class:"mx-right-arrow","aria-hidden":"true",viewBox:"0 0 1024 1024"},Ln=t.createElementVNode("path",{d:"M307.018 49.445c11.517 0 23.032 4.394 31.819 13.18L756.404 480.18c8.439 8.438 13.181 19.885 13.181 31.82s-4.741 23.38-13.181 31.82L338.838 961.376c-17.574 17.573-46.065 17.573-63.64-0.001-17.573-17.573-17.573-46.065 0.001-63.64L660.944 512 275.198 126.265c-17.574-17.573-17.574-46.066-0.001-63.64C283.985 53.839 295.501 49.445 307.018 49.445z"},null,-1),Un=[Ln];function jn(o,e){return t.openBlock(),t.createElementBlock("svg",Wn,Un)}const Gn=At(On,[["render",jn]]),qn={class:"mx-item-row"},Kn=["xlink:href"],Jn={key:1,class:"label"},Xn={class:"mx-item-row"},Yn={class:"mx-shortcut"},Bt=t.defineComponent({__name:"ContextMenuItem",props:{disabled:{type:Boolean,default:!1},hidden:{type:Boolean,default:!1},customRender:{type:Function,default:null},customClass:{type:String,default:""},clickHandler:{type:Function,default:null},label:{type:[String,Object,Function],default:""},icon:{type:[String,Object,Function],default:""},iconFontClass:{type:String,default:"iconfont"},checked:{type:Boolean,default:!1},shortcut:{type:String,default:""},svgIcon:{type:String,default:""},svgProps:{type:Object,default:null},preserveIconWidth:{type:Boolean,default:!0},showRightArrow:{type:Boolean,default:!1},hasChildren:{type:Boolean,default:!1},clickClose:{type:Boolean,default:!0},clickableWhenHasChildren:{type:Boolean,default:!1},rawMenuItem:{type:Object,default:void 0}},emits:["click","subMenuOpen","subMenuClose"],setup(o,{expose:e,emit:n}){const s=o,l=n,{clickHandler:r,clickClose:a,clickableWhenHasChildren:c,disabled:h,hidden:m,label:d,icon:v,iconFontClass:u,showRightArrow:g,shortcut:w,hasChildren:f}=t.toRefs(s),p=t.ref(!1),b=t.ref(!1),y=t.ref(),S=t.inject("globalOptions"),$=t.inject("globalHasSlot"),E=t.inject("globalRenderSlot"),T=t.inject("globalCloseMenu"),D=t.inject("menuContext"),j=t.computed(()=>typeof d.value=="string"?d.value:typeof d.value=="function"?En(d.value.toString()):"MenuItem[unknow]");t.provide("MenuItemName",j);const F={getSubMenuInstance:()=>{},showSubMenu:()=>p.value?(D.markActiveMenuItem(F,!0),!0):f.value?(J(),!0):!1,hideSubMenu:()=>{D.closeOtherSubMenu()},isDisabledOrHidden:()=>h.value||m.value,getElement:()=>y.value,focus:()=>b.value=!0,blur:()=>b.value=!1,click:O};t.provide("menuItemInstance",F),t.onMounted(()=>{D.isMenuItemDataCollectedFlag()?t.nextTick(()=>{let q=0;const re=D.getElement();if(re){let oe=0;for(let he=0;he<re.children.length;he++){const be=re.children[he];if(be.getAttribute("data-type")==="ContextMenuItem"){if(be===y.value){q=oe;break}oe++}}}D.addChildMenuItem(F,q)}):D.addChildMenuItem(F)}),t.onBeforeUnmount(()=>{D.removeChildMenuItem(F)});function O(q){if(!h.value){if(q){const re=q.target;if(re.classList.contains("mx-context-no-clickable")||S.value.ignoreClickClassName&&re.classList.contains(S.value.ignoreClickClassName))return;if(S.value.clickCloseClassName&&re.classList.contains(S.value.clickCloseClassName)){q.stopPropagation(),T(s.rawMenuItem);return}}f.value?c.value?(typeof r.value=="function"&&r.value(q),l("click",q)):p.value||J():(typeof r.value=="function"&&r.value(q),l("click",q),a.value&&T(s.rawMenuItem))}}function J(q){b.value=!1,D.checkCloseOtherSubMenuTimeOut()||D.closeOtherSubMenu(),h.value||(D.markActiveMenuItem(F),f.value&&(q||D.markThisOpenedByKeyBoard(),D.addOpenedSubMenu(Y),p.value=!0,t.nextTick(()=>l("subMenuOpen",F))))}function Y(){b.value=!1,p.value=!1,l("subMenuClose",F)}function L(){return{disabled:h.value,label:d.value,icon:v.value,iconFontClass:u.value,showRightArrow:g.value,clickClose:a.value,clickableWhenHasChildren:c.value,shortcut:w.value,theme:S.value.theme,isOpen:p,hasChildren:f,onClick:O,onMouseEnter:J,closeMenu:T}}return e(F),(q,re)=>t.unref(m)?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"mx-context-menu-item-wrapper",ref_key:"menuItemRef",ref:y,"data-type":"ContextMenuItem"},[t.unref($)("itemRender")?(t.openBlock(),t.createBlock(t.unref(Ve),{key:0,vnode:()=>t.unref(E)("itemRender",L())},null,8,["vnode"])):o.customRender?(t.openBlock(),t.createBlock(t.unref(Ve),{key:1,vnode:o.customRender,data:L()},null,8,["vnode","data"])):(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["mx-context-menu-item",t.unref(h)?"disabled":"",b.value?"keyboard-focus":"",o.customClass?" "+o.customClass:"",p.value?"open":""]),onClick:O,onMouseenter:J},[t.renderSlot(q.$slots,"default",{},()=>[t.createElementVNode("div",qn,[t.createElementVNode("div",{class:t.normalizeClass(["mx-icon-placeholder",o.preserveIconWidth?"preserve-width":""])},[t.renderSlot(q.$slots,"icon",{},()=>[t.unref($)("itemIconRender")?(t.openBlock(),t.createBlock(t.unref(Ve),{key:0,vnode:()=>t.unref(E)("itemIconRender",L())},null,8,["vnode"])):typeof o.svgIcon=="string"&&o.svgIcon?(t.openBlock(),t.createElementBlock("svg",t.mergeProps({key:1,class:"icon svg"},o.svgProps),[t.createElementVNode("use",{"xlink:href":o.svgIcon},null,8,Kn)],16)):typeof t.unref(v)!="string"?(t.openBlock(),t.createBlock(t.unref(Ve),{key:2,vnode:t.unref(v),data:t.unref(v)},null,8,["vnode","data"])):typeof t.unref(v)=="string"&&t.unref(v)!==""?(t.openBlock(),t.createElementBlock("i",{key:3,class:t.normalizeClass(t.unref(v)+" icon "+t.unref(u)+" "+t.unref(S).iconFontClass)},null,2)):t.createCommentVNode("",!0)]),o.checked?t.renderSlot(q.$slots,"check",{key:0},()=>[t.unref($)("itemCheckRender")?(t.openBlock(),t.createBlock(t.unref(Ve),{key:0,vnode:()=>t.unref(E)("itemCheckRender",L())},null,8,["vnode"])):t.createCommentVNode("",!0),t.createVNode(Fn)]):t.createCommentVNode("",!0)],2),t.renderSlot(q.$slots,"label",{},()=>[t.unref($)("itemLabelRender")?(t.openBlock(),t.createBlock(t.unref(Ve),{key:0,vnode:()=>t.unref(E)("itemLabelRender",L())},null,8,["vnode"])):typeof t.unref(d)=="string"?(t.openBlock(),t.createElementBlock("span",Jn,t.toDisplayString(t.unref(d)),1)):(t.openBlock(),t.createBlock(t.unref(Ve),{key:2,vnode:t.unref(d),data:t.unref(d)},null,8,["vnode","data"]))])]),t.createElementVNode("div",Xn,[t.unref(w)||q.$slots.shortcut?t.renderSlot(q.$slots,"shortcut",{key:0},()=>[t.unref($)("itemShortcutRender")?(t.openBlock(),t.createBlock(t.unref(Ve),{key:0,vnode:()=>t.unref(E)("itemShortcutRender",L())},null,8,["vnode"])):t.createCommentVNode("",!0),t.createElementVNode("span",Yn,t.toDisplayString(t.unref(w)),1)]):t.createCommentVNode("",!0),t.unref(g)?t.renderSlot(q.$slots,"rightArrow",{key:1},()=>[t.unref($)("itemRightArrowRender")?(t.openBlock(),t.createBlock(t.unref(Ve),{key:0,vnode:()=>t.unref(E)("itemRightArrowRender",L())},null,8,["vnode"])):t.createCommentVNode("",!0),t.createVNode(Gn)]):t.createCommentVNode("",!0)])])],34)),t.renderSlot(q.$slots,"submenu",{context:F,show:p.value})],512))}}),Zn=t.defineComponent({name:"ContextMenuSperator",components:{VNodeRender:Ve},setup(){const o=t.inject("globalHasSlot"),e=t.inject("globalRenderSlot");return{globalHasSlot:o,globalRenderSlot:e}}}),Qn={key:1,class:"mx-context-menu-item-sperator mx-context-no-clickable"};function er(o,e,n,s,l,r){const a=t.resolveComponent("VNodeRender");return o.globalHasSlot("separatorRender")?(t.openBlock(),t.createBlock(a,{key:0,vnode:()=>o.globalRenderSlot("separatorRender",{})},null,8,["vnode"])):(t.openBlock(),t.createElementBlock("div",Qn))}const lt=At(Zn,[["render",er]]),Vt=t.defineComponent({__name:"ContextSubMenu",props:{items:{type:Object,default:null},show:{type:Boolean,default:!1},maxHeight:{type:Number,default:0},maxWidth:{type:[String,Number],default:0},minWidth:{type:[String,Number],default:0},adjustPosition:{type:Boolean,default:!0},direction:{type:String,default:"br"},parentMenuItemContext:{type:Object,default:null}},emits:["closeAnimFinished"],setup(o,{expose:e,emit:n}){const s=o,l=n,r=t.ref(!1),a=t.inject("globalGetMenuHostId",""),c=t.inject("menuContext"),h=t.inject("globalOptions");t.inject("globalHasSlot"),t.inject("globalRenderSlot");const m=t.ref("UnknowOrRoot"),d=t.inject("MenuItemName",m),{zIndex:v,getParentWidth:u,getParentHeight:g,getZoom:w}=c,{adjustPosition:f}=t.toRefs(s),p=t.ref(),b=t.ref(),y=t.ref(),S=[],$=t.inject("globalSetCurrentSubMenu"),E=[];let T=null,D=0;function j(){T&&T.blur()}function F(M,A){if(M){for(let U=A!==void 0?A:0;U<E.length;U++)if(!E[U].isDisabledOrHidden()){O(U);break}}else for(let U=A!==void 0?A:E.length-1;U>=0;U--)if(!E[U].isDisabledOrHidden()){O(U);break}}function O(M){if(T&&j(),M!==void 0&&(T=E[Math.max(0,Math.min(M,E.length-1))]),!T)return;T.focus();const A=T.getElement();A&&A.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"})}function J(){$(Y)}const Y={el:y,name:d,isTopLevel:()=>c.getParentContext()===null,closeSelfAndActiveParent:()=>{const M=re.getParentContext();if(M){M.closeOtherSubMenu();const A=M.getSubMenuInstanceContext();if(A)return A.focusCurrentItem(),!0}return!1},closeCurrentSubMenu:()=>{var M;return(M=re.getParentContext())==null?void 0:M.closeOtherSubMenu()},moveCurrentItemFirst:()=>F(!0),moveCurrentItemLast:()=>F(!1),moveCurrentItemDown:()=>F(!0,T?E.indexOf(T)+1:0),moveCurrentItemUp:()=>F(!1,T?E.indexOf(T)-1:0),focusCurrentItem:()=>O(),openCurrentItemSubMenu:()=>T?T==null?void 0:T.showSubMenu():!1,triggerCurrentItemClick:M=>T==null?void 0:T.click(M)};let L=!1,q=!1;const re={zIndex:v+1,container:c.container,adjustPadding:h.value.adjustPadding||Be.defaultAdjustPadding,getParentWidth:()=>{var M;return((M=y.value)==null?void 0:M.offsetWidth)||0},getParentHeight:()=>{var M;return((M=y.value)==null?void 0:M.offsetHeight)||0},getPositon:()=>[B.value.x,B.value.y],getZoom:()=>h.value.zoom||Be.defaultZoom,addOpenedSubMenu(M){S.push(M)},closeOtherSubMenu(){S.forEach(M=>M()),S.splice(0,S.length),$(Y)},checkCloseOtherSubMenuTimeOut(){return D?(clearTimeout(D),D=0,!0):!1},closeOtherSubMenuWithTimeOut(){D=setTimeout(()=>{D=0,this.closeOtherSubMenu()},200)},addChildMenuItem:(M,A)=>{A===void 0?E.push(M):E.splice(A,0,M)},removeChildMenuItem:M=>{E.splice(E.indexOf(M),1),M.getSubMenuInstance=()=>{}},markActiveMenuItem:(M,A=!1)=>{j(),T=M,A&&O()},markThisOpenedByKeyBoard:()=>{L=!0},isOpenedByKeyBoardFlag:()=>L?(L=!1,!0):!1,isMenuItemDataCollectedFlag:()=>q,getElement:()=>y.value||null,getParentContext:()=>c,getSubMenuInstanceContext:()=>Y};t.provide("menuContext",re);const oe={getChildItem:M=>E[M],getMenuDimensions:()=>b.value?{width:b.value.offsetWidth,height:b.value.offsetHeight}:{width:0,height:0},getSubmenuRoot:()=>b.value,getMenu:()=>y.value,getScrollValue:()=>{var M,A;return((A=(M=p.value)==null?void 0:M.getScrollContainer())==null?void 0:A.scrollTop)||0},setScrollValue:M=>{var A;return(A=p.value)==null?void 0:A.scrollTo(0,M)},getScrollHeight:()=>be.value,adjustPosition:()=>{W()},getMaxHeight:()=>ve.value,getPosition:()=>B.value,setPosition:(M,A)=>{B.value.x=M,B.value.y=A}},he=t.inject("menuItemInstance",void 0);he&&(he.getSubMenuInstance=()=>oe);const be=t.ref(0),ve=t.ref(0),ke=t.ref(!1),B=t.ref({x:0,y:0});function W(){t.nextTick(()=>{const M=y.value,A=b.value;if(M&&A&&p.value){const{container:U}=c,V=(u==null?void 0:u())??0,Re=(g==null?void 0:g())??0,ge=getComputedStyle(A),ce=parseFloat(ge.paddingLeft),Se=parseFloat(ge.paddingTop),De=Re>0?Se:0,Je=document.documentElement.scrollHeight/w(),ct=document.documentElement.scrollWidth/w(),dt=Math.min(ct,U.offsetWidth),Xe=Math.min(Je,U.offsetHeight);let Ue=rt(M,U),Ce=nt(M,U);s.direction.includes("l")?B.value.x-=M.offsetWidth+ce:s.direction.includes("r")?B.value.x+=V+ce:(B.value.x+=V/2,B.value.x-=(M.offsetWidth+ce)/2),s.direction.includes("t")?B.value.y-=(M.offsetHeight+Se*2)/w():s.direction.includes("b")?B.value.y-=Se/w():B.value.y-=(M.offsetHeight+Se)/2/w(),t.nextTick(()=>{var He,Fe;Ue=rt(M,U),Ce=nt(M,U);const Ye=((Fe=(He=p.value)==null?void 0:He.getScrollContainer())==null?void 0:Fe.scrollHeight)||0,ut=s.maxHeight;be.value=s.maxHeight?Math.min(Ye,s.maxHeight):Ye;const Ze=Ue+M.offsetWidth-dt,Pe=Ce+be.value+De*2-Xe;if(ke.value=Pe>0,f.value&&Ze>0){const Ee=V+M.offsetWidth-ce,Me=Ue;Ee>Me?B.value.x-=Me:B.value.x-=Ee}if(ke.value){if(f.value){const Ee=Pe,Me=Ce;Ee>Me?B.value.y-=Me-De:B.value.y-=Ee-De}ve.value=Xe-(B.value.y+Se)}else ve.value=ut||0})}})}function ne(){var M;const A=(M=s.parentMenuItemContext)==null?void 0:M.getElement();if(A){const U=rt(A,c.container),V=nt(A,c.container);B.value.x=U,B.value.y=V}else{const[U,V]=c.getPositon();B.value.x=U,B.value.y=V}t.nextTick(()=>{var U;$(Y),(U=y.value)==null||U.focus({preventScroll:!0}),c.isOpenedByKeyBoardFlag()&&t.nextTick(()=>F(!0)),q=!0}),W()}return t.watch(()=>s.show,M=>{M&&ne()}),t.onMounted(()=>{r.value=!0,s.show?ne():W()}),t.onBeforeUnmount(()=>{r.value=!1,he&&(he.getSubMenuInstance=()=>{})}),e(oe),(M,A)=>{const U=t.resolveComponent("ContextSubMenu",!0);return r.value?(t.openBlock(),t.createBlock(t.Teleport,{key:0,to:`#${t.unref(a)}`},[t.createVNode(t.Transition,t.mergeProps({appear:""},t.unref(h).menuTransitionProps||{duration:10},{onAfterLeave:A[0]||(A[0]=V=>l("closeAnimFinished"))}),{default:t.withCtx(()=>[o.show?(t.openBlock(),t.createElementBlock("div",t.mergeProps({key:0,ref_key:"submenuRoot",ref:b},M.$attrs,{class:["mx-context-menu",t.unref(h).customClass?t.unref(h).customClass:"",t.unref(h).theme??""],style:{maxWidth:o.maxWidth?t.unref(go)(o.maxWidth):`${t.unref(Be).defaultMaxWidth}px`,minWidth:o.minWidth?t.unref(go)(o.minWidth):`${t.unref(Be).defaultMinWidth}px`,zIndex:t.unref(v),left:`${B.value.x}px`,top:`${B.value.y}px`},"data-type":"ContextSubMenu",onClick:J}),[t.createVNode(t.unref(Mn),{ref_key:"scrollRectRef",ref:p,scroll:"vertical",maxHeight:ve.value,containerClass:"mx-context-menu-scroll"},{default:t.withCtx(()=>[t.createElementVNode("div",{class:t.normalizeClass(["mx-context-menu-items"]),ref_key:"menu",ref:y},[t.renderSlot(M.$slots,"default",{},()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(o.items,(V,Re)=>(t.openBlock(),t.createElementBlock(t.Fragment,{key:Re},[V.hidden!==!0&&V.divided==="up"?(t.openBlock(),t.createBlock(lt,{key:0})):t.createCommentVNode("",!0),V.hidden!==!0&&V.divided==="self"?(t.openBlock(),t.createBlock(lt,{key:1})):(t.openBlock(),t.createBlock(Bt,{key:2,clickHandler:V.onClick?ge=>V.onClick(ge):void 0,disabled:typeof V.disabled=="object"?V.disabled.value:V.disabled,hidden:typeof V.hidden=="object"?V.hidden.value:V.hidden,icon:V.icon,iconFontClass:V.iconFontClass,svgIcon:V.svgIcon,svgProps:V.svgProps,label:V.label,customRender:V.customRender,customClass:V.customClass,checked:typeof V.checked=="object"?V.checked.value:V.checked,shortcut:V.shortcut,clickClose:V.clickClose,clickableWhenHasChildren:V.clickableWhenHasChildren,preserveIconWidth:V.preserveIconWidth!==void 0?V.preserveIconWidth:t.unref(h).preserveIconWidth,showRightArrow:V.children&&V.children.length>0,hasChildren:V.children&&V.children.length>0,rawMenuItem:V,onSubMenuOpen:ge=>{var ce;return(ce=V.onSubMenuOpen)==null?void 0:ce.call(V,ge)},onSubMenuClose:ge=>{var ce;return(ce=V.onSubMenuClose)==null?void 0:ce.call(V,ge)}},t.createSlots({_:2},[V.children&&V.children.length>0?{name:"submenu",fn:t.withCtx(({context:ge,show:ce})=>[t.createVNode(U,{show:ce,parentMenuItemContext:ge,items:V.children,maxWidth:V.maxWidth,minWidth:V.minWidth,maxHeight:V.maxHeight,adjustPosition:V.adjustSubMenuPosition!==void 0?V.adjustSubMenuPosition:t.unref(h).adjustPosition,direction:V.direction!==void 0?V.direction:t.unref(h).direction},null,8,["show","parentMenuItemContext","items","maxWidth","minWidth","maxHeight","adjustPosition","direction"])]),key:"0"}:void 0]),1032,["clickHandler","disabled","hidden","icon","iconFontClass","svgIcon","svgProps","label","customRender","customClass","checked","shortcut","clickClose","clickableWhenHasChildren","preserveIconWidth","showRightArrow","hasChildren","rawMenuItem","onSubMenuOpen","onSubMenuClose"])),V.hidden!==!0&&(V.divided==="down"||V.divided===!0)?(t.openBlock(),t.createBlock(lt,{key:3})):t.createCommentVNode("",!0)],64))),128))])],512)]),_:3},8,["maxHeight"])],16)):t.createCommentVNode("",!0)]),_:3},16)],8,["to"])):t.createCommentVNode("",!0)}}}),yo=t.defineComponent({__name:"ContextSubMenuWrapper",props:{options:{type:Object,default:null},show:{type:null,default:null},container:{type:Object,default:null},isFullScreenContainer:{type:Boolean,default:!0}},emits:["close","closeAnimFinished"],setup(o,{expose:e,emit:n}){const s=o,l=n,r=t.useSlots(),a=t.ref(),{options:c,show:h,container:m}=t.toRefs(s);t.onMounted(()=>{h.value&&u()}),t.onBeforeUnmount(()=>{p()}),t.watch(h,T=>{T?u():(uo(d),p())});const d={closeMenu:g,isClosed:w,getMenuRef:()=>a.value,getMenuDimensions:()=>{var T;return((T=a.value)==null?void 0:T.getMenuDimensions())??{width:0,height:0}}};let v=!1;function u(){f(),Sn(d)}function g(T){v=!0,l("close",T),c.value.menuTransitionProps||l("closeAnimFinished"),uo(d)}function w(){return v}function f(){setTimeout(()=>{document.addEventListener("click",$,!0),document.addEventListener("contextmenu",$,!0),document.addEventListener("scroll",S,!0),!s.isFullScreenContainer&&m.value&&m.value.addEventListener("scroll",S,!0),c.value.keyboardControl!==!1&&document.addEventListener("keydown",y,!0)},50)}function p(){document.removeEventListener("contextmenu",$,!0),document.removeEventListener("click",$,!0),document.removeEventListener("scroll",S,!0),!s.isFullScreenContainer&&m.value&&m.value.removeEventListener("scroll",S,!0),c.value.keyboardControl!==!1&&document.removeEventListener("keydown",y,!0)}const b=t.ref();t.provide("globalSetCurrentSubMenu",T=>b.value=T),t.provide("globalGetMenuHostId",m.value.id);function y(T){var D,j,F,O,J,Y,L,q,re,oe,he,be,ve;let ke=!0;switch(T.key){case"Escape":{((D=b.value)==null?void 0:D.isTopLevel())===!1?(j=b.value)==null||j.closeCurrentSubMenu():g();break}case"ArrowDown":(F=b.value)==null||F.moveCurrentItemDown();break;case"ArrowUp":(O=b.value)==null||O.moveCurrentItemUp();break;case"Home":(J=b.value)==null||J.moveCurrentItemFirst();break;case"End":(Y=b.value)==null||Y.moveCurrentItemLast();break;case"ArrowLeft":{(L=b.value)!=null&&L.closeSelfAndActiveParent()||(re=(q=c.value).onKeyFocusMoveLeft)==null||re.call(q);break}case"ArrowRight":(oe=b.value)!=null&&oe.openCurrentItemSubMenu()||(be=(he=c.value).onKeyFocusMoveRight)==null||be.call(he);break;case"Enter":(ve=b.value)==null||ve.triggerCurrentItemClick(T);break;default:ke=!1;break}ke&&b.value&&(T.stopPropagation(),T.preventDefault())}function S(T){c.value.closeWhenScroll!==!1&&E(T.target,null)}function $(T){E(T.target,T)}function E(T,D){for(var j,F;T;){if(T.classList&&T.classList.contains("mx-context-menu"))return;T=T.parentNode}D?c.value.clickCloseOnOutside!==!1?(p(),g()):(F=(j=c.value).onClickOnOutside)==null||F.call(j,D):(p(),g())}return t.provide("globalOptions",c),t.provide("globalCloseMenu",g),t.provide("globalIsFullScreenContainer",s.isFullScreenContainer),t.provide("globalHasSlot",T=>r[T]!==void 0),t.provide("globalRenderSlot",(T,D)=>t.renderSlot(r,T,{...D},()=>[t.h("span","Render slot failed")],!1)),t.provide("menuContext",{zIndex:c.value.zIndex||Be.defaultZindex,container:m.value,adjustPadding:{x:0,y:0},getZoom:()=>c.value.zoom||Be.defaultZoom,getParentWidth:()=>0,getParentHeight:()=>0,getPositon:()=>[c.value.x,c.value.y],closeOtherSubMenuWithTimeOut:()=>{},checkCloseOtherSubMenuTimeOut:()=>!1,addOpenedSubMenu:()=>{},closeOtherSubMenu:()=>{},getParentContext:()=>null,getSubMenuInstanceContext:()=>null,getElement:()=>null,addChildMenuItem:()=>{},removeChildMenuItem:()=>{},markActiveMenuItem:()=>{},markThisOpenedByKeyBoard:()=>{},isOpenedByKeyBoardFlag:()=>!1,isMenuItemDataCollectedFlag:()=>!1}),e(d),(T,D)=>(t.openBlock(),t.createBlock(Vt,{ref_key:"submenuInstance",ref:a,show:t.unref(h),items:t.unref(c).items,adjustPosition:t.unref(c).adjustPosition,maxWidth:t.unref(c).maxWidth||t.unref(Be).defaultMaxWidth,minWidth:t.unref(c).minWidth||t.unref(Be).defaultMinWidth,maxHeight:t.unref(c).maxHeight,direction:t.unref(c).direction||t.unref(Be).defaultDirection,onCloseAnimFinished:D[0]||(D[0]=j=>l("closeAnimFinished"))},{default:t.withCtx(()=>[t.renderSlot(T.$slots,"default")]),_:3},8,["show","items","adjustPosition","maxWidth","minWidth","maxHeight","direction"]))}}),tr=t.defineComponent({__name:"ContextMenu",props:{options:{type:Object,default:null},show:{type:Boolean,default:!1}},emits:["update:show","close"],setup(o,{expose:e,emit:n}){const s=n,l=o,{options:r,show:a}=t.toRefs(l),{isNew:c,container:h,eleId:m}=fo(r.value),d=t.ref(null),v=t.useSlots();function u(g){var w,f;s("update:show",!1),s("close"),(f=(w=r.value).onClose)==null||f.call(w,g)}return e({closeMenu:()=>s("update:show",!1),isClosed:()=>!a.value,getMenuRef:()=>{var g;return(g=d.value)==null?void 0:g.getMenuRef()},getMenuDimensions:()=>{var g;return((g=d.value)==null?void 0:g.getMenuDimensions())??{width:0,height:0}}}),(g,w)=>(t.openBlock(),t.createBlock(t.Teleport,{to:`#${t.unref(m)}`},[t.createVNode(yo,{ref_key:"menuRef",ref:d,options:t.unref(r),show:t.unref(a),container:t.unref(h),isFullScreenContainer:!t.unref(c),onClose:u},t.createSlots({_:2},[t.renderList(t.unref(v),(f,p)=>({name:p,fn:t.withCtx(b=>[t.renderSlot(g.$slots,p,t.normalizeProps(t.guardReactiveProps(b)))])}))]),1032,["options","show","container","isFullScreenContainer"])],8,["to"]))}}),or=t.defineComponent({name:"ContextMenuGroup",props:{disabled:{type:Boolean,default:!1},hidden:{type:Boolean,default:!1},clickHandler:{type:Function,default:null},label:{type:String,default:""},icon:{type:String,default:""},iconFontClass:{type:String,default:"iconfont"},checked:{type:Boolean,default:!1},shortcut:{type:String,default:""},svgIcon:{type:String,default:""},svgProps:{type:Object,default:null},preserveIconWidth:{type:Boolean,default:!0},showRightArrow:{type:Boolean,default:!1},clickClose:{type:Boolean,default:!0},adjustSubMenuPosition:{type:Boolean,default:void 0},maxHeight:{type:[String,Number],default:0},maxWidth:{type:[String,Number],default:0},minWidth:{type:[String,Number],default:0}},setup(o,e){const n=t.inject("globalOptions"),{adjustSubMenuPosition:s,maxWidth:l,minWidth:r,maxHeight:a}=t.toRefs(o),c=typeof s.value<"u"?s.value:n.value.adjustPosition,h=t.ref(),m=t.ref();return e.expose({getSubMenuRef:()=>h.value,getMenuItemRef:()=>m.value}),()=>t.h(Bt,{...o,ref:m,showRightArrow:!0,maxWidth:void 0,minWidth:void 0,maxHeight:void 0,adjustSubMenuPosition:void 0,hasChildren:typeof e.slots.default!==void 0},e.slots.default?{submenu:d=>t.h(Vt,{ref:h,show:d.show,maxWidth:l.value,minWidth:r.value,maxHeight:a.value,adjustPosition:c,parentMenuItemContext:d.context},{default:e.slots.default}),...In(e.slots,"default")}:e.slots)}});function nr(o,e,n,s){const l=t.ref(!0),r=t.h(yo,{options:o,show:l,container:e,isFullScreenContainer:!n,onCloseAnimFinished:()=>{t.render(null,e)},onClose:a=>{var c;(c=o.onClose)==null||c.call(o,a),l.value=!1}},s);return t.render(r,e),r.component}function vo(o,e){const n=fo(o);return nr(o,n.container,n.isNew,e).exposed}const _o={install(o){o.config.globalProperties.$contextmenu=vo,o.component("ContextMenu",tr),o.component("ContextMenuItem",Bt),o.component("ContextMenuGroup",or),o.component("ContextMenuSperator",lt),o.component("ContextMenuSeparator",lt),o.component("ContextSubMenu",Vt)},showContextMenu(o,e){return vo(o,e)},isAnyContextMenuOpen(){return _n()},closeContextMenu:ho,transformMenuPosition:kn},rr=["onClick","onContextmenu"],sr={key:0,class:"checkbox-icon"},lr={key:1,class:"checkbox-icon"},ir={key:1,class:"header-text"},ar={key:0,class:"sort-order"},cr=["onMousedown"],dr=t.defineComponent({__name:"DataGridHeader",props:{columns:{},gridTemplateColumns:{},gridId:{},isGridReady:{type:Boolean},isProcessing:{type:Boolean}},emits:["sort","resize","hideColumn","autoFitColumn","showFilter"],setup(o,{emit:e}){const n=o,s=e,l=et(n.gridId),r=t.ref(null),a=t.ref(0),c=t.ref(0),h=t.computed(()=>{const b=new Map;return l.sortColumns.forEach((y,S)=>{b.set(y.columnName,{direction:y.direction,order:S+1,isPrimary:S===0})}),b});function m(b){return h.value.get(b)??null}function d(b,y){if(y.specialType!=="Checkbox"){if(y.isSortable&&b.shiftKey){u(y,!0);return}p(b,y)}}function v(){l.toggleAllCheckboxes()}function u(b,y=!1){if(!b.isSortable)return;const S=m(b.name);if(S){const E=S.direction==="asc"?"desc":"asc";l.addSort(b.name,E,y)}else l.addSort(b.name,"asc",y);const $=m(b.name);$&&s("sort",b.name,$.direction)}function g(b,y){r.value=b,a.value=y.clientX,c.value=b.width,window.addEventListener("mousemove",w),window.addEventListener("mouseup",f)}function w(b){if(!r.value)return;const y=b.clientX-a.value,S=Math.max(r.value.minWidth,Math.min(r.value.maxWidth,c.value+y));s("resize",r.value.name,S)}function f(){r.value=null,window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",f)}function p(b,y){if(n.isGridReady===!1){console.error("[showHeaderContextMenu] Grid not ready yet");return}if(!l){console.error("[showHeaderContextMenu] Store not initialized yet");return}if(n.isProcessing){console.error("[showHeaderContextMenu] Grid is currently processing data");return}const S=[...l.sortColumns],$=l.filterExpression,E=[];if(y.isSortable){const T=m(y.name),D=S.length>0;E.push({label:"Sort Ascending",icon:"â–²",onClick:()=>{l.addSort(y.name,"asc",!1),s("sort",y.name,"asc")}},{label:"Sort Descending",icon:"â–¼",onClick:()=>{l.addSort(y.name,"desc",!1),s("sort",y.name,"desc")}}),D&&E.push({divided:!0},{label:"Add to Sort (Asc)",icon:"â–²+",onClick:()=>{l.addSort(y.name,"asc",!0)}},{label:"Add to Sort (Desc)",icon:"â–¼+",onClick:()=>{l.addSort(y.name,"desc",!0)}}),T&&E.push({divided:!0},{label:`Remove from Sort (Order ${T.order})`,icon:"âœ–",onClick:()=>{const j=S.filter(F=>F.columnName!==y.name);l.sortColumns=j}}),D&&E.push({label:"Clear All Sorts",icon:"ðŸ—‘",onClick:()=>{l.clearSort()}}),E.push({divided:!0})}y.isFilterable&&(E.push({label:"Filter...",icon:"ðŸ”",onClick:()=>s("showFilter",y.name)}),$!==null&&E.push({label:"Clear All Filters",icon:"ðŸ—‘",onClick:()=>{l.clearFilter()}}),E.push({divided:!0})),y.specialType||E.push({label:"Auto-fit Column",icon:"â†”ï¸",onClick:()=>s("autoFitColumn",y.name)},{label:"Hide Column",icon:"ðŸ‘ï¸",onClick:()=>s("hideColumn",y.name)}),_o.showContextMenu({x:b.x,y:b.y,items:E})}return(b,y)=>(t.openBlock(),t.createElementBlock("div",{class:"grid-header",style:t.normalizeStyle({gridTemplateColumns:o.gridTemplateColumns})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(o.columns,S=>{var $,E,T,D;return t.openBlock(),t.createElementBlock("div",{key:S.name,class:t.normalizeClass(["header-cell",{"header-cell--auto-width":S.autoWidth}]),onClick:j=>d(j,S),onContextmenu:t.withModifiers(j=>p(j,S),["prevent"])},[S.specialType==="Checkbox"?(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass(["custom-checkbox",{"checkbox-none":t.unref(l).checkboxState==="none","checkbox-some":t.unref(l).checkboxState==="some","checkbox-all":t.unref(l).checkboxState==="all"}]),onClick:t.withModifiers(v,["stop"]),title:"Toggle all checkboxes"},[t.unref(l).checkboxState==="all"?(t.openBlock(),t.createElementBlock("span",sr,"âœ“")):t.unref(l).checkboxState==="some"?(t.openBlock(),t.createElementBlock("span",lr,"âˆ’")):t.createCommentVNode("",!0)],2)):(t.openBlock(),t.createElementBlock("span",ir,t.toDisplayString(S.header),1)),S.isSortable&&m(S.name)?(t.openBlock(),t.createElementBlock("span",{key:2,class:t.normalizeClass(["sort-icon",($=m(S.name))!=null&&$.isPrimary?"sort-icon--primary":"sort-icon--secondary"])},[t.createTextVNode(t.toDisplayString(((E=m(S.name))==null?void 0:E.direction)==="asc"?"â–²":"â–¼")+" ",1),(T=m(S.name))!=null&&T.order&&m(S.name).order>1?(t.openBlock(),t.createElementBlock("span",ar,t.toDisplayString((D=m(S.name))==null?void 0:D.order),1)):t.createCommentVNode("",!0)],2)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"resize-grip",onMousedown:t.withModifiers(j=>g(S,j),["stop"])},null,40,cr)],42,rr)}),128))],4))}}),ze=(o,e)=>{const n=o.__vccOpts||o;for(const[s,l]of e)n[s]=l;return n},ur=ze(dr,[["__scopeId","data-v-baf5d093"]]),hr=["innerHTML"],fr=ze(t.defineComponent({__name:"DataGridCell",props:{cell:{},column:{},isSelected:{type:Boolean},gridId:{}},emits:["editComplete","cellInput","copy","cut","paste","delete","insertAbove","insertBelow"],setup(o,{emit:e}){const n=o,s=e,l=et(n.gridId),{isAutoRowHeightEnabled:r}=yt.storeToRefs(l),a=t.inject("validation",null),c=(a==null?void 0:a.validateCellThrottled)||(()=>{}),h=(a==null?void 0:a.validationErrors)||{},m=t.ref(),d=t.ref(),v=t.ref(!1),u=t.ref(n.cell.value),g=t.ref(null),w=t.ref(!1),f=t.ref(null),p=t.ref(!1),b=t.computed(()=>n.cell.value==null?"":String(n.cell.value)),y=t.computed(()=>b.value.includes(`
`)),S=t.computed(()=>{const B=b.value,W=l.searchQuery;if(!W||!B)return $(B);try{const ne=W.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),M=new RegExp(`(${ne})`,"gi");return $(B).replace(M,'<mark class="search-highlight">$1</mark>')}catch{return $(B)}});function $(B){const W=document.createElement("div");return W.textContent=B,W.innerHTML}const E=t.computed(()=>(h[n.cell.rowId]||[]).find(W=>W.columnName===n.cell.columnName)),T=t.computed(()=>{var B,W,ne,M;return{"cell--selected":n.isSelected,"cell--editing":v.value,"cell--validation-error":((B=E.value)==null?void 0:B.severity)==="Error"||((W=E.value)==null?void 0:W.severity)==="Critical","cell--validation-warning":((ne=E.value)==null?void 0:ne.severity)==="Warning"||((M=E.value)==null?void 0:M.severity)==="Info","cell--readonly":n.column.isReadOnly,"cell--auto-height":r.value,"cell--has-newlines":y.value&&!r.value}}),D=t.computed(()=>({}));function j(B){if(B.button!==0)return;const W=B.ctrlKey;console.log("[DataGridCell] MouseDown:",{rowId:n.cell.rowId,columnName:n.cell.columnName,isEditing:v.value}),l.selectCell(n.cell.rowId,n.cell.columnName,W)}function F(B){if(w.value=!0,m.value){const ne=m.value.getBoundingClientRect();f.value={left:ne.left,top:ne.top-4}}if(B.ctrlKey||l.wasCtrlPressed)return;const W=B.buttons===1;if(l.pressedCell&&!l.isDragging&&W){if(n.cell.rowId===l.pressedCell.rowId&&n.cell.columnName===l.pressedCell.columnName)return;l.startDragSelection(n.cell.rowId,n.cell.columnName)}else l.isDragging&&W&&l.expandDragSelection(n.cell.rowId,n.cell.columnName)}function O(){w.value=!1,f.value=null}function J(B){!v.value&&n.isSelected&&B.key==="Enter"&&!n.column.isReadOnly&&(B.preventDefault(),Y())}async function Y(){var B,W;n.column.isReadOnly||(console.log("[DataGridCell] enterEditMode:",{rowId:n.cell.rowId,columnName:n.cell.columnName,currentCellValue:n.cell.value,storingAsOriginal:n.cell.value}),g.value=n.cell.value,v.value=!0,u.value=n.cell.value,await t.nextTick(),(B=d.value)==null||B.focus(),(W=d.value)==null||W.select())}async function L(){console.log("[DataGridCell] handleDoubleClick:",{rowId:n.cell.rowId,columnName:n.cell.columnName,currentValue:n.cell.value}),Y()}function q(){const B=l.rows.find(W=>W.rowId===n.cell.rowId);if(B)return B.cells.map(W=>({columnName:W.columnName,value:W.value}))}function re(){if(console.log("[DataGridCell] handleInput:",{rowId:n.cell.rowId,columnName:n.cell.columnName,newValue:u.value,autoValidate:l.config.autoValidate}),l.config.autoValidate&&l.config.enableValidation){const B=q();c(n.cell.rowId,n.cell.columnName,u.value,B)}s("cellInput",n.cell.rowId,n.cell.columnName,u.value)}function oe(){if(console.log("[DataGridCell] confirmEdit:",{rowId:n.cell.rowId,columnName:n.cell.columnName,confirmedValue:u.value,originalWas:g.value}),p.value=!0,l.config.autoValidate&&l.config.enableValidation){const B=q();c(n.cell.rowId,n.cell.columnName,u.value,B)}s("editComplete",n.cell.rowId,n.cell.columnName,u.value),v.value=!1,g.value=null,t.nextTick(()=>{try{console.log(`[DataGridCell] confirmEdit - Attempting to restore focus to cell: rowId=${n.cell.rowId}, column=${n.cell.columnName}`),m.value?(m.value.focus(),console.log("[DataGridCell] confirmEdit - Focus restored successfully")):console.log("[DataGridCell] confirmEdit - WARNING: cellRef.value is null/undefined")}catch(B){console.log(`[DataGridCell] confirmEdit - ERROR restoring focus: ${B}`)}}),setTimeout(()=>{p.value=!1},100)}function he(B){if(console.log("[DataGridCell] handleKeyDown:",{rowId:n.cell.rowId,columnName:n.cell.columnName,key:B.key,shift:B.shiftKey,ctrl:B.ctrlKey}),B.key==="Escape"){B.preventDefault(),B.stopPropagation(),be();return}if(B.key==="Enter"&&!B.shiftKey){B.preventDefault(),B.stopPropagation(),oe();return}if(B.key==="Tab"){B.preventDefault();const W=B.target,ne=W.selectionStart,M=W.selectionEnd;u.value=u.value.substring(0,ne)+"	"+u.value.substring(M),t.nextTick(()=>{W.selectionStart=W.selectionEnd=ne+1})}}function be(){if(console.log("[DataGridCell] cancelEdit:",{rowId:n.cell.rowId,columnName:n.cell.columnName,originalValue:g.value,currentEditValue:u.value}),u.value=g.value,v.value=!1,s("editComplete",n.cell.rowId,n.cell.columnName,g.value),l.config.autoValidate&&l.config.enableValidation){const B=q();c(n.cell.rowId,n.cell.columnName,g.value,B)}g.value=null,t.nextTick(()=>{try{console.log(`[DataGridCell] cancelEdit - Attempting to restore focus to cell: rowId=${n.cell.rowId}, column=${n.cell.columnName}`),m.value?(m.value.focus(),console.log("[DataGridCell] cancelEdit - Focus restored successfully")):console.log("[DataGridCell] cancelEdit - WARNING: cellRef.value is null/undefined")}catch(B){console.log(`[DataGridCell] cancelEdit - ERROR restoring focus: ${B}`)}})}function ve(){console.log("[DataGridCell] handleBlur:",{rowId:n.cell.rowId,columnName:n.cell.columnName,isEditing:v.value,isConfirming:p.value}),v.value&&!p.value&&be()}function ke(B){if(!B.ctrlKey)return;B.preventDefault();const W=new Map;l.selectedCells.forEach(ge=>{const[ce]=ge.split(":"),Se=l.rows.find(De=>De.rowId===ce);Se&&W.set(ce,Se.rowIndex)});const ne=W.size,M=Array.from(W.values()),A=M.length>0?Math.min(...M):0,U=M.length>0?Math.max(...M):0,V=l.rows.find(ge=>ge.rowIndex===A),Re=l.rows.find(ge=>ge.rowIndex===U);_o.showContextMenu({x:B.x,y:B.y,items:[{label:"Copy",icon:"ðŸ“‹",onClick:()=>s("copy"),disabled:!n.isSelected},{label:"Cut",icon:"âœ‚ï¸",onClick:()=>s("cut"),disabled:!n.isSelected||n.column.isReadOnly},{label:"Paste",icon:"ðŸ“„",onClick:()=>s("paste"),disabled:n.column.isReadOnly},{divided:!0},{label:"Delete",icon:"ðŸ—‘ï¸",onClick:()=>s("delete"),disabled:!n.isSelected||n.column.isReadOnly},{divided:!0},{label:`Insert ${ne} row(s) above`,icon:"â¬†ï¸",onClick:()=>s("insertAbove",(V==null?void 0:V.rowId)||n.cell.rowId,ne||1),disabled:n.column.isReadOnly},{label:`Insert ${ne} row(s) below`,icon:"â¬‡ï¸",onClick:()=>s("insertBelow",(Re==null?void 0:Re.rowId)||n.cell.rowId,ne||1),disabled:n.column.isReadOnly}]})}return(B,W)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"cellRef",ref:m,class:t.normalizeClass(["grid-cell",T.value]),style:t.normalizeStyle(D.value),onMousedown:j,onMouseenter:F,onMouseleave:O,onDblclick:L,onKeydown:J,onContextmenu:ke,tabindex:"0"},[v.value?t.withDirectives((t.openBlock(),t.createElementBlock("textarea",{key:1,ref_key:"inputRef",ref:d,"onUpdate:modelValue":W[0]||(W[0]=ne=>u.value=ne),class:"cell-input",onInput:re,onBlur:ve,onKeydown:he},null,544)),[[t.vModelText,u.value]]):(t.openBlock(),t.createElementBlock("div",{key:0,class:"cell-text",innerHTML:S.value},null,8,hr)),(t.openBlock(),t.createBlock(t.Teleport,{to:"body"},[E.value&&(w.value||o.isSelected)&&f.value?(t.openBlock(),t.createElementBlock("div",{key:0,class:t.normalizeClass(["validation-tooltip",{"validation-tooltip--error":E.value.severity==="Error"||E.value.severity==="Critical","validation-tooltip--warning":E.value.severity==="Warning"||E.value.severity==="Info"}]),style:t.normalizeStyle({position:"fixed",left:f.value.left+"px",top:f.value.top+"px"})},t.toDisplayString(E.value.message),7)):t.createCommentVNode("",!0)]))],38))}}),[["__scopeId","data-v-ee25e5d3"]]),gr={key:0,class:"row-number"},pr=["checked"],mr=["title"],wr={class:"validation-message"},br=["disabled"],Cr=300,yr=ze(t.defineComponent({__name:"SpecialColumnCell",props:{specialType:{},rowId:{},rowIndex:{},column:{},isChecked:{type:Boolean}},emits:["checkboxChange","deleteRow","insertRow"],setup(o,{emit:e}){const n=o,s=e;t.watch(()=>n.isChecked,(y,S)=>{n.specialType==="Checkbox"&&console.log("[SpecialColumnCell] isChecked prop changed:",{rowId:n.rowId,newVal:y,oldVal:S})},{immediate:!0});const l=t.inject("validation",null),r=(l==null?void 0:l.validationErrors)||{},a=t.ref(!1),c=t.ref(0),h=t.computed(()=>n.rowIndex+1),m=t.computed(()=>r[n.rowId]||[]),d=t.computed(()=>m.value.some(y=>y.severity==="Error"||y.severity==="Critical")),v=t.computed(()=>m.value.some(y=>y.severity==="Warning")),u=t.computed(()=>{const y=m.value;return y.length===0?"":y.map(S=>`${S.columnName}: ${S.message}`).join("; ")}),g=t.computed(()=>({"special-cell--row-number":n.specialType==="RowNumber","special-cell--checkbox":n.specialType==="Checkbox","special-cell--validation":n.specialType==="ValidationAlerts","special-cell--delete":n.specialType==="DeleteRow","special-cell--insert":n.specialType==="InsertRow"})),w=t.computed(()=>({}));function f(y){const S=y.target;console.log("[SpecialColumnCell] Checkbox change:",{rowId:n.rowId,checked:S.checked,currentProp:n.isChecked}),s("checkboxChange",n.rowId,S.checked)}function p(){const y=Date.now();y-c.value<Cr||(c.value=y,confirm("Are you sure you want to delete this row?")&&(a.value=!0,s("deleteRow",n.rowId),setTimeout(()=>{a.value=!1},1e3)))}function b(){s("insertRow",n.rowId)}return(y,S)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["special-cell",g.value]),style:t.normalizeStyle(w.value),onMousedown:S[0]||(S[0]=t.withModifiers(()=>{},["stop"])),onMouseenter:S[1]||(S[1]=t.withModifiers(()=>{},["stop"]))},[o.specialType==="RowNumber"?(t.openBlock(),t.createElementBlock("span",gr,t.toDisplayString(h.value),1)):o.specialType==="Checkbox"?(t.openBlock(),t.createElementBlock("input",{key:1,type:"checkbox",class:"checkbox-input",checked:o.isChecked,onChange:f},null,40,pr)):o.specialType==="ValidationAlerts"?(t.openBlock(),t.createElementBlock("div",{key:2,class:t.normalizeClass(["validation-alerts",{"has-errors":d.value||v.value}]),title:u.value},[t.createElementVNode("span",wr,t.toDisplayString(u.value),1)],10,mr)):o.specialType==="DeleteRow"?(t.openBlock(),t.createElementBlock("button",{key:3,class:"delete-button",disabled:a.value,onClick:p,title:"Delete row"}," ðŸ—‘ï¸ ",8,br)):o.specialType==="InsertRow"?(t.openBlock(),t.createElementBlock("button",{key:4,class:"insert-button",onClick:b,title:"Insert new row"}," âž• ")):t.createCommentVNode("",!0)],38))}}),[["__scopeId","data-v-05f3e471"]]),vr=ze(t.defineComponent({__name:"DataGridRow",props:{row:{},columns:{},gridTemplateColumns:{},gridId:{}},emits:["cellEditComplete","cellInput","checkboxChange","deleteRow","insertRow","insertAbove","insertBelow"],setup(o,{emit:e}){const n=o,s=e,l=et(n.gridId),r=t.computed(()=>{const w=l.isRowChecked(n.row.rowId);return console.log("[DataGridRow] Row checked state:",{rowId:n.row.rowId,checked:w}),w});function a(w){const f=n.row.cells.find(p=>p.columnName===w);return f||{rowId:n.row.rowId,columnName:w,value:null,isSelected:!1,isValidationError:!1}}function c(w,f,p){s("cellEditComplete",w,f,p)}function h(w,f,p){s("cellInput",w,f,p)}function m(w,f){s("checkboxChange",w,f)}function d(w){s("deleteRow",w)}function v(w){s("insertRow",w)}function u(w,f){s("insertAbove",w,f)}function g(w,f){s("insertBelow",w,f)}return(w,f)=>(t.openBlock(),t.createElementBlock("div",{class:"grid-row",style:t.normalizeStyle({height:o.row.height+"px",gridTemplateColumns:o.gridTemplateColumns})},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(o.columns,p=>(t.openBlock(),t.createElementBlock(t.Fragment,{key:`${o.row.rowId}:${p.name}`},[p.specialType?(t.openBlock(),t.createBlock(yr,{key:0,"special-type":p.specialType,"row-id":o.row.rowId,"row-index":o.row.rowIndex,column:p,"is-checked":p.specialType==="Checkbox"?r.value:void 0,onCheckboxChange:m,onDeleteRow:d,onInsertRow:v},null,8,["special-type","row-id","row-index","column","is-checked"])):(t.openBlock(),t.createBlock(fr,{key:1,cell:a(p.name),column:p,"is-selected":t.unref(l).isCellSelected(o.row.rowId,p.name),"grid-id":o.gridId,onEditComplete:c,onCellInput:h,onInsertAbove:u,onInsertBelow:g},null,8,["cell","column","is-selected","grid-id"]))],64))),128))],4))}}),[["__scopeId","data-v-82316d34"]]),_r={class:"pagination"},Sr=["disabled"],kr=["disabled"],xr={class:"page-numbers"},Rr=["onClick"],Er=["disabled"],Ir=["disabled"],Tr={class:"page-info"},$r=["value"],Ar=["value"],Br=ze(t.defineComponent({__name:"PaginationControl",props:{currentPage:{},pageSize:{},totalRows:{},pageSizeOptions:{default:()=>[50,100,200,500]}},emits:["pageChange","pageSizeChange"],setup(o,{emit:e}){const n=o,s=e,l=t.computed(()=>{const h=[...n.pageSizeOptions];return h.includes(n.pageSize)||h.push(n.pageSize),h.sort((m,d)=>m-d)}),r=t.computed(()=>Math.ceil(n.totalRows/n.pageSize)),a=t.computed(()=>{const h=r.value,m=n.currentPage,d=20;if(h<=d){const g=[];for(let w=1;w<=h;w++)g.push(w);return g}const v=Math.ceil(h/d),u=new Set;u.add(1),u.add(h),u.add(m),m>1&&u.add(m-1),m<h&&u.add(m+1);for(let g=1;g<=h;g+=v)u.add(g);return Array.from(u).sort((g,w)=>g-w)});function c(h){const m=h.target;s("pageSizeChange",Number(m.value))}return(h,m)=>(t.openBlock(),t.createElementBlock("div",_r,[t.createElementVNode("button",{onClick:m[0]||(m[0]=d=>s("pageChange",1)),disabled:o.currentPage===1}," First ",8,Sr),t.createElementVNode("button",{onClick:m[1]||(m[1]=d=>s("pageChange",o.currentPage-1)),disabled:o.currentPage===1}," Previous ",8,kr),t.createElementVNode("div",xr,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(a.value,d=>(t.openBlock(),t.createElementBlock("button",{key:d,class:t.normalizeClass({"page-number":!0,active:d===o.currentPage}),onClick:v=>s("pageChange",d)},t.toDisplayString(d),11,Rr))),128))]),t.createElementVNode("button",{onClick:m[2]||(m[2]=d=>s("pageChange",o.currentPage+1)),disabled:o.currentPage===r.value}," Next ",8,Er),t.createElementVNode("button",{onClick:m[3]||(m[3]=d=>s("pageChange",r.value)),disabled:o.currentPage===r.value}," Last ",8,Ir),t.createElementVNode("span",Tr," ("+t.toDisplayString(o.totalRows)+" rows) ",1),t.createElementVNode("select",{value:o.pageSize,onChange:c},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(l.value,d=>(t.openBlock(),t.createElementBlock("option",{key:d,value:d},t.toDisplayString(d),9,Ar))),128))],40,$r)]))}}),[["__scopeId","data-v-d81ea122"]]),Vr={class:"filter-header"},Mr={class:"filter-title"},Dr={class:"filter-mode"},Hr={key:0,class:"filter-content"},Pr={class:"filter-values"},Nr=["onUpdate:modelValue"],zr={class:"value-text"},Fr={key:0,class:"no-values"},Or={key:1,class:"filter-content"},Wr={class:"regex-label"},Lr=ze(t.defineComponent({__name:"FilterFlyout",props:{visible:{type:Boolean},columnName:{},position:{},uniqueValues:{},currentMode:{},currentPattern:{}},emits:["close","applyCheckbox","applyRegex","clearFilter"],setup(o,{emit:e}){const n=o,s=e,l=t.ref(n.currentMode||"checkbox"),r=t.ref(""),a=t.ref(n.currentPattern||""),c=t.ref([]);t.watch(()=>n.uniqueValues,f=>{c.value=f.map(p=>({...p}))},{immediate:!0,deep:!0}),t.watch(()=>n.currentPattern,f=>{f&&(a.value=f)},{immediate:!0});const h=t.computed(()=>{if(!r.value)return c.value;const f=r.value.toLowerCase();return c.value.filter(p=>p.value.toLowerCase().includes(f))}),m=f=>f.count>0?`${f.value} (${f.count})`:f.value;function d(){h.value.forEach(f=>{f.isSelected=!0})}function v(){h.value.forEach(f=>{f.isSelected=!1})}function u(){if(l.value==="checkbox"){const f=c.value.filter(p=>p.isSelected).map(p=>p.value);s("applyCheckbox",f)}else s("applyRegex",a.value);w()}function g(){s("clearFilter"),w()}function w(){s("close")}return(f,p)=>(t.openBlock(),t.createBlock(t.Teleport,{to:"body"},[o.visible?(t.openBlock(),t.createElementBlock("div",{key:0,class:"filter-flyout-overlay",onClick:t.withModifiers(w,["self"])},[t.createElementVNode("div",{class:"filter-flyout",style:t.normalizeStyle({top:o.position.y+"px",left:o.position.x+"px"})},[t.createElementVNode("div",Vr,[t.createElementVNode("h3",Mr,"Filter: "+t.toDisplayString(o.columnName),1),t.createElementVNode("button",{class:"close-button",onClick:w},"âœ•")]),t.createElementVNode("div",Dr,[t.createElementVNode("label",null,[t.withDirectives(t.createElementVNode("input",{type:"radio",value:"checkbox","onUpdate:modelValue":p[0]||(p[0]=b=>l.value=b),name:"filterMode"},null,512),[[t.vModelRadio,l.value]]),p[4]||(p[4]=t.createElementVNode("span",null,"Checkbox",-1))]),t.createElementVNode("label",null,[t.withDirectives(t.createElementVNode("input",{type:"radio",value:"regex","onUpdate:modelValue":p[1]||(p[1]=b=>l.value=b),name:"filterMode"},null,512),[[t.vModelRadio,l.value]]),p[5]||(p[5]=t.createElementVNode("span",null,"Regex",-1))])]),l.value==="checkbox"?(t.openBlock(),t.createElementBlock("div",Hr,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":p[2]||(p[2]=b=>r.value=b),type:"text",class:"filter-search",placeholder:"Search values..."},null,512),[[t.vModelText,r.value]]),t.createElementVNode("div",{class:"filter-actions"},[t.createElementVNode("button",{class:"action-button",onClick:d},"Select All"),t.createElementVNode("button",{class:"action-button",onClick:v},"Deselect All")]),t.createElementVNode("div",Pr,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(h.value,b=>(t.openBlock(),t.createElementBlock("label",{key:b.value,class:t.normalizeClass(["value-item",{"value-item--selected":b.isSelected}])},[t.withDirectives(t.createElementVNode("input",{type:"checkbox","onUpdate:modelValue":y=>b.isSelected=y,class:"value-checkbox"},null,8,Nr),[[t.vModelCheckbox,b.isSelected]]),t.createElementVNode("span",zr,t.toDisplayString(b.displayText||m(b)),1)],2))),128)),h.value.length===0?(t.openBlock(),t.createElementBlock("div",Fr," No values found ")):t.createCommentVNode("",!0)])])):(t.openBlock(),t.createElementBlock("div",Or,[t.createElementVNode("label",Wr,[p[6]||(p[6]=t.createElementVNode("span",null,"Regex Pattern:",-1)),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":p[3]||(p[3]=b=>a.value=b),type:"text",class:"regex-input",placeholder:"^test.*|.*example$"},null,512),[[t.vModelText,a.value]])]),p[7]||(p[7]=t.createElementVNode("div",{class:"regex-help"},[t.createElementVNode("details",null,[t.createElementVNode("summary",null,"Regex Examples"),t.createElementVNode("ul",null,[t.createElementVNode("li",null,[t.createElementVNode("code",null,"^test"),t.createTextVNode(' - Starts with "test"')]),t.createElementVNode("li",null,[t.createElementVNode("code",null,"example$"),t.createTextVNode(' - Ends with "example"')]),t.createElementVNode("li",null,[t.createElementVNode("code",null,"^test.*example$"),t.createTextVNode(' - Starts with "test" and ends with "example"')]),t.createElementVNode("li",null,[t.createElementVNode("code",null,"test|example"),t.createTextVNode(' - Contains "test" OR "example"')]),t.createElementVNode("li",null,[t.createElementVNode("code",null,"\\d{3}"),t.createTextVNode(" - Contains exactly 3 digits")])])])],-1))])),t.createElementVNode("div",{class:"filter-footer"},[t.createElementVNode("button",{class:"footer-button footer-button--apply",onClick:u}," Apply Filter "),t.createElementVNode("button",{class:"footer-button footer-button--clear",onClick:g}," Clear Filter "),t.createElementVNode("button",{class:"footer-button footer-button--cancel",onClick:w}," Cancel ")])],4)])):t.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-459a16a1"]]),Ur={key:0,class:"processing-overlay"},jr={class:"processing-content"},Gr={class:"processing-text"},qr={key:1,class:"hidden-columns-panel"},Kr=["onClick","title"],Jr={class:"grid-container"},mt=ze(t.defineComponent({__name:"DataGrid",props:{config:{},columns:{},gridId:{},theme:{},minTableWidth:{},width:{},height:{},autoRowHeightEnabled:{type:Boolean}},setup(o,{expose:e}){var Ie;const n=o,s=n.gridId||`grid-${Math.random().toString(36).substr(2,9)}`,l=co(`DataGrid[${s}]`);l.info("âš™ï¸ Component initializing",{gridId:s,hasConfig:!!n.config,hasColumns:!!n.columns,columnCount:((Ie=n.columns)==null?void 0:Ie.length)||0});const r=et(s);l.debug("ðŸ“¦ Store created",{instanceId:s}),n.autoRowHeightEnabled!==void 0&&(r.setAutoRowHeightEnabled(n.autoRowHeightEnabled),l.info(`ðŸ”§ AutoRowHeight initialized to: ${n.autoRowHeightEnabled}`));const a=to();t.provide("validation",a);const c=oo(),{filterRows:h,evaluateFilter:m}=It(),d=t.ref(!1),v=t.ref(!1),u=t.ref(800),g=t.computed(()=>{const i=Math.max(32,Math.floor(u.value*.7));return console.log(`[AutoRowHeight] Computed maxHeight: ${i}px (container: ${u.value}px)`),i}),w=ro({minHeight:32,maxHeight:g.value,fontFamily:"system-ui, -apple-system, sans-serif",fontSize:14,enableWrapping:!0,padding:16});t.watch(g,async i=>{console.log(`[AutoRowHeight] maxHeight changed to: ${i}px`),w.updateMaxHeight(i),r.isAutoRowHeightEnabled&&r.rows.length>0&&(console.log("[AutoRowHeight] maxHeight changed - recalculating all row heights..."),await k())});const f=()=>{if(!S.value){console.log("[AutoRowHeight] Cannot measure: scrollerRef is null");return}if(!S.value.$el){console.log("[AutoRowHeight] Cannot measure: scrollerRef.$el is undefined");return}const i=S.value.$el.clientHeight;i>0?(u.value=i,console.log(`[AutoRowHeight] Container height measured: ${i}px`)):console.log("[AutoRowHeight] Container height is 0, keeping default")};t.onMounted(async()=>{if(l.info("========== âœ… Component mounted - START initialization ==========",{gridId:n.gridId,autoRowHeight:r.isAutoRowHeightEnabled,rowCount:r.rows.length,columnCount:r.columns.length}),document.addEventListener("mouseup",be),document.addEventListener("keydown",q),l.debug("ðŸŽ¯ Event listeners registered (mouseup, keydown)"),n.columns&&n.columns.length>0&&r.rows.length===0){l.info("ðŸ”§ Auto-initializing empty rows from provided columns",{columnCount:n.columns.length});try{r.setColumns(n.columns),r.initializeEmptyRows(),l.info(`âœ… Auto-initialized ${r.rows.length} empty rows`)}catch(i){l.error("âŒ Failed to set columns:",i),alert(`Column configuration error: ${i instanceof Error?i.message:"Unknown error"}`)}}if(G(),await t.nextTick(),l.debug("â° DOM ready after nextTick"),f(),r.isAutoRowHeightEnabled&&r.rows.length>0){l.info("ðŸ“ AutoRowHeight enabled - applying heights..."),await t.nextTick();try{await k(),l.info("âœ… AutoRowHeight applied successfully on mount")}catch(i){l.error("âŒ AutoRowHeight ERROR on mount:",i)}}else l.debug(`â­ï¸ Skipping AutoRowHeight: enabled=${r.isAutoRowHeightEnabled}, rowCount=${r.rows.length}`);window.addEventListener("resize",f),l.debug("ðŸŽ¯ Resize listener registered"),await t.nextTick(),d.value=!0,l.info("========== âœ… Grid marked as READY for user interaction ==========")}),t.onBeforeUnmount(()=>{window.removeEventListener("resize",f),document.removeEventListener("mouseup",be),document.removeEventListener("keydown",q),l.info("ðŸ§¹ Cleanup: All event listeners removed")});const p=t.ref(!1),b=t.ref(!1),y=t.ref(!1),S=t.ref(),$=()=>{const i=Array.from(r.selectedCells);if(i.length===0)return[];const C=new Set(i.map(_=>_.split(":")[0]));return r.rows.filter(_=>C.has(_.rowId))},E=()=>L.value.filter(i=>!i.specialType).map(i=>i.name),T=async()=>{const i=$();if(i.length===0){console.warn("No rows selected for copy");return}const C=E(),_=await c.copyToClipboard(i,C,{includeHeaders:!0});_.success?console.log(_.message):console.error(_.message)},D=async()=>{const i=await c.pasteFromClipboard();if(i.success&&i.rows&&i.rows.length>0){const C=Array.from(r.selectedCells);let _=r.rows.length;if(C.length>0){const I=C[0].split(":")[0],P=r.rows.findIndex(ee=>ee.rowId===I);P>=0&&(_=P)}i.rows.forEach((x,I)=>{var P;if(_+I<r.rows.length){const ee=r.rows[_+I];Object.keys(x).forEach(X=>{L.value.some(Q=>Q.name===X)&&r.updateCell(ee.rowId,X,x[X])})}else{const ee=(P=r.rows[r.rows.length-1])==null?void 0:P.rowId;if(ee){r.insertRow(ee);const X=r.rows[r.rows.length-1];Object.keys(x).forEach(Q=>{L.value.some(de=>de.name===Q)&&r.updateCell(X.rowId,Q,x[Q])})}}}),console.log(i.message)}else console.error(i.message)},j=async()=>{await T(),Array.from(r.selectedCells).forEach(C=>{var I;const[_,x]=C.split(":");(I=L.value.find(P=>P.name===x))!=null&&I.isReadOnly||r.updateCell(_,x,null)})},F=()=>{Array.from(r.selectedCells).forEach(C=>{var I;const[_,x]=C.split(":");(I=L.value.find(P=>P.name===x))!=null&&I.isReadOnly||r.updateCell(_,x,null)})},O=()=>{r.rows.forEach(i=>{L.value.forEach(C=>{C.specialType||r.selectCell(i.rowId,C.name,!0)})})},J=lo({enabled:!0,context:so.Normal});J.registerShortcuts(dn({onCopy:T,onPaste:D,onCut:j,onDelete:F,onSelectAll:O,onFind:()=>console.log("Find not implemented yet")}));const Y=t.computed(()=>r.visibleRows),L=t.computed(()=>n.columns||r.columns);function q(i){!i.ctrlKey&&!i.metaKey||((i.key==="c"||i.key==="C")&&(i.preventDefault(),console.log("[DataGrid] Ctrl+C pressed - copying selected cells"),re()),(i.key==="v"||i.key==="V")&&(i.preventDefault(),console.log("[DataGrid] Ctrl+V pressed - pasting from clipboard"),oe()))}async function re(){if(r.selectedCells.size===0){console.warn("[DataGrid] No cells selected for copy");return}console.log("[DataGrid] Copying selected cells:",{selectedCount:r.selectedCells.size,selectedCells:Array.from(r.selectedCells)});const i=await c.copySelectedCells(r.selectedCells,r.rows,W.value);i.success?console.log("[DataGrid] Copy successful:",i.message):console.error("[DataGrid] Copy failed:",i.message)}async function oe(){const i=await c.pasteFromClipboard();if(i.success&&i.rows&&i.rows.length>0){console.log("[DataGrid] Paste successful:",{rowCount:i.rows.length,headers:i.headers});let C=0,_=0;if(r.selectedCells.size>0){const x=Array.from(r.selectedCells)[0],[I,P]=x.split(":"),ee=r.rows.find(Q=>Q.rowId===I),X=W.value.findIndex(Q=>Q.name===P);ee&&X!==-1&&(C=ee.rowIndex,_=X)}console.log("[DataGrid] Pasting at position:",{targetRowIndex:C,targetColIndex:_}),i.rows.forEach((x,I)=>{const P=C+I;if(P>=r.rows.length){console.warn("[DataGrid] Paste row out of bounds:",{pasteRowIndex:P,maxRows:r.rows.length});return}const ee=r.rows[P];Object.keys(x).forEach((X,Q)=>{const de=_+Q;if(de>=W.value.length){console.warn("[DataGrid] Paste column out of bounds:",{pasteColIndex:de,maxCols:W.value.length});return}const Te=W.value[de],we=x[X];r.updateCell(ee.rowId,Te.name,we),console.log("[DataGrid] Pasted cell:",{row:P,col:de,columnName:Te.name,value:we})})}),console.log("[DataGrid] Paste complete")}else console.error("[DataGrid] Paste failed:",i.message)}t.onBeforeMount(()=>{l.info("ðŸ”„ Component before mount")}),t.onBeforeUnmount(()=>{l.info("ðŸ”„ Component before unmount")}),t.onUnmounted(()=>{l.info("ðŸ—‘ï¸ Component unmounted - final cleanup"),l.info("ðŸ‘‹ Component cleanup complete")});async function he(){if(console.log("[validateAllCellsInBatches] ðŸ” START",{enableValidation:r.config.enableValidation,hasValidation:!!a,totalRows:r.rows.length,totalColumns:r.columns.length}),!r.config.enableValidation||!a){console.log("[validateAllCellsInBatches] âš ï¸ SKIPPED - validation not enabled or not available");return}const i=r.getCellsNeedingValidation();if(console.log("[validateAllCellsInBatches] ðŸ“‹ Cells needing validation:",{count:i.length,sample:i.slice(0,5).map(x=>`${x.rowId}:${x.columnName}`)}),i.length===0){console.log("[validateAllCellsInBatches] âœ… NO CELLS NEED VALIDATION - all cells already validated");return}const C=20;let _=0;console.log("[validateAllCellsInBatches] Starting batch validation...",{totalCells:i.length,batchSize:C,estimatedBatches:Math.ceil(i.length/C)});for(let x=0;x<i.length;x+=C){const I=i.slice(x,x+C),P=Math.floor(x/C)+1;console.log(`[validateAllCellsInBatches] ðŸ“¦ Processing batch ${P}:`,{batchSize:I.length,from:x,to:x+I.length});for(const{rowId:ee,columnName:X}of I){const Q=r.rows.find(we=>we.rowId===ee);if(!Q){console.warn("[validateAllCellsInBatches] âš ï¸ Row not found:",ee);continue}const de=Q.cells.find(we=>we.columnName===X);if(!de){console.warn("[validateAllCellsInBatches] âš ï¸ Cell not found:",{rowId:ee,columnName:X});continue}const Te=Q.cells.map(we=>({columnName:we.columnName,value:we.value}));await a.validateCellThrottled(ee,X,de.value,Te),r.markCellValidated(ee,X),_++}await t.nextTick(),console.log(`[validateAllCellsInBatches] âœ“ Batch ${P} complete:`,{validated:_,total:i.length,progress:`${Math.round(_/i.length*100)}%`})}console.log("[validateAllCellsInBatches] ðŸŽ‰ COMPLETE:",{totalValidated:_,totalRequested:i.length,success:_===i.length})}t.watch(()=>r.config.autoValidate,async(i,C)=>{console.log("[DataGrid] autoValidate changed:",{wasEnabled:C,enabled:i}),i&&!C&&r.config.enableValidation&&(console.log("[DataGrid] Auto-validation enabled - validating all unvalidated cells"),await he())});function be(){(r.isDragging||r.pressedCell)&&r.endDragSelection()}const ve=t.computed(()=>{const i=[],C=r.config;return C.showRowNumber&&i.push({name:"__rowNumber",header:"#",width:50,minWidth:40,maxWidth:80,isVisible:!0,isReadOnly:!0,isSortable:!1,isFilterable:!1,specialType:"RowNumber"}),C.showCheckbox&&i.push({name:"__checkbox",header:"â˜‘",width:40,minWidth:40,maxWidth:40,isVisible:!0,isReadOnly:!0,isSortable:!1,isFilterable:!0,specialType:"Checkbox"}),i}),ke=t.computed(()=>{const i=[];return r.config.showValidationAlerts&&i.push({name:"__validationAlerts",header:"âš  Validation",width:200,minWidth:150,maxWidth:9999,autoWidth:!0,isVisible:!0,isReadOnly:!0,isSortable:!1,isFilterable:!1,specialType:"ValidationAlerts"}),i}),B=t.computed(()=>{const i=[],C=r.config;return C.showInsertButton&&i.push({name:"__insertRow",header:"Insert",width:60,minWidth:50,maxWidth:80,isVisible:!0,isReadOnly:!0,isSortable:!1,isFilterable:!1,specialType:"InsertRow"}),C.showDeleteButton&&i.push({name:"__deleteRow",header:"Delete",width:60,minWidth:50,maxWidth:80,isVisible:!0,isReadOnly:!0,isSortable:!1,isFilterable:!1,specialType:"DeleteRow"}),i}),W=t.computed(()=>[...ve.value,...L.value.filter(i=>!i.specialType&&i.isVisible&&i.visibleForGrid!==!1),...ke.value,...B.value]),ne=t.computed(()=>{const i=W.value.map(C=>C.autoWidth?"1fr":`${C.width}px`).join(" ");return console.log("[GridTemplate] All Columns:",W.value.map(C=>({name:C.name,header:C.header,width:C.width,autoWidth:C.autoWidth,specialType:C.specialType}))),console.log("[GridTemplate] Generated Template:",i),i});t.watch(()=>n.config,i=>{i&&r.setConfig(i)},{immediate:!0,deep:!0}),t.watch(()=>n.columns,i=>{if(console.log("[DataGrid] Columns watch triggered:",{hasColumns:i==null?void 0:i.length,rowsLength:r.rows.length,willInitialize:i&&i.length>0&&r.rows.length===0}),i&&i.length>0)try{r.setColumns(i),console.log("[DataGrid] After setColumns, rowsLength:",r.rows.length),r.rows.length===0?(console.log("[DataGrid] Calling initializeEmptyRows..."),r.initializeEmptyRows(),console.log("[DataGrid] After initializeEmptyRows, rowsLength:",r.rows.length)):console.log("[DataGrid] SKIPPED initializeEmptyRows - rows already exist!")}catch(C){console.error("[DataGrid] Failed to set columns:",C),alert(`Column configuration error: ${C instanceof Error?C.message:"Unknown error"}`)}},{immediate:!0,deep:!0}),t.watch(()=>{var i;return((i=a==null?void 0:a.ruleCount)==null?void 0:i.value)??0},async(i,C)=>{var x,I;const _=((I=(x=a==null?void 0:a.validationRules)==null?void 0:x.value)==null?void 0:I.size)||0;if(console.log("[WATCHER] Validation rules changed!",{ruleCount:i,oldCount:C,hasRules:_>0,hasData:r.rows.length>0,autoValidateEnabled:r.config.autoValidate}),_===0||r.rows.length===0||!r.config.autoValidate){console.log("[WATCHER] Skipping auto-validation:",{noRules:_===0,noData:r.rows.length===0,autoValidateDisabled:!r.config.autoValidate});return}console.log("[WATCHER] Triggering auto-validation for all rows...");try{await t.nextTick(),console.log("[WATCHER] First nextTick done"),await t.nextTick(),console.log("[WATCHER] Second nextTick done"),await a.validateAll(r.rows),console.log("[WATCHER] âœ… Auto-validation completed after adding rules")}catch(P){console.error("[WATCHER] âŒ Error during auto-validation:",P)}}),t.watch(()=>r.rows.length,async(i,C)=>{var x,I,P;console.log("[WATCHER] Rows length changed!",{newLength:i,oldLength:C,hasRules:((I=(x=a==null?void 0:a.validationRules)==null?void 0:x.value)==null?void 0:I.size)||0,autoValidateEnabled:r.config.autoValidate});const _=((P=a==null?void 0:a.validationRules)==null?void 0:P.value)&&a.validationRules.value.size>0;if(i<=C||!_||!r.config.autoValidate){console.log("[WATCHER] Skipping auto-validation:",{rowsNotAdded:i<=C,noRules:!_,autoValidateDisabled:!r.config.autoValidate});return}console.log("[WATCHER] Triggering auto-validation for newly loaded rows..."),v.value=!0;try{await t.nextTick(),console.log("[WATCHER] First nextTick done - rows mounted"),await t.nextTick(),console.log("[WATCHER] Second nextTick done - scroller ready"),await new Promise(ee=>setTimeout(ee,50)),console.log("[WATCHER] Delay done - starting validation"),await a.validateAll(r.rows),console.log("[WATCHER] âœ… Auto-validation completed after loading data")}finally{v.value=!1}},{immediate:!1}),t.watch(()=>{var i;return((i=a==null?void 0:a.errorCount)==null?void 0:i.value)??0},async(i,C)=>{const _=a==null?void 0:a.validationErrors;if(console.log("[WATCHER] Validation errors changed!",{errorCount:i,oldErrorCount:C,hasErrors:i>0,isAutoRowHeightEnabled:r.isAutoRowHeightEnabled,validationErrorsKeys:_?Object.keys(_):[]}),console.log("[WATCHER] Updating validationErrorCount for all rows..."),r.rows.forEach(x=>{const I=_&&_[x.rowId]?_[x.rowId].length:0;x.validationErrorCount=I,(I>0||x.validationErrorCount!==I)&&console.log("[WATCHER] Updated validationErrorCount:",{rowId:x.rowId,count:I})}),!_||i===0){console.log("[WATCHER] No validation errors, heights updated, done.");return}await t.nextTick(),r.isAutoRowHeightEnabled?(console.log("[WATCHER] AutoRowHeight is ON, calling applyAutoRowHeightToAll..."),await k(),console.log("[WATCHER] applyAutoRowHeightToAll completed")):(console.log("[WATCHER] AutoRowHeight is OFF, calling resetAllRowHeights..."),await H(),console.log("[WATCHER] resetAllRowHeights completed"))});function M(i,C){const _=r.columns.find(x=>x.name===i);if(!_){console.error(`[handleSort] Column not found: ${i}`);return}if(!_.isSortable){console.warn(`[handleSort] Column '${i}' is not sortable`);return}if(_.visibleForGrid===!1){console.warn(`[handleSort] Column '${i}' has visibleForGrid=false, sorting not allowed`);return}r.addSort(i,C,!1)}function A(i,C){const _=r.columns.find(x=>x.name===i);_&&(_.width=C)}async function U(i,C,_){if(console.log(`[DataGrid] handleCellEditComplete: rowId=${i}, columnName=${C}, newValue=${_}, autoValidate=${r.config.autoValidate}, autoRowHeight=${r.isAutoRowHeightEnabled}`),r.updateCell(i,C,_),r.config.autoValidate&&r.config.enableValidation&&a){const x=r.rows.find(P=>P.rowId===i),I=x==null?void 0:x.cells.map(P=>({columnName:P.columnName,value:P.value}));await a.validateCellThrottled(i,C,_,I),console.log("[DataGrid] Cell validated after edit:",{rowId:i,columnName:C,hasErrors:a.validationErrors.value.has(i)})}r.isAutoRowHeightEnabled?(console.log("[DataGrid] Recalculating row height:",{rowId:i}),await N(i),await t.nextTick()):(console.log("[DataGrid] Recalculating height for newlines (AutoRowHeight OFF):",{rowId:i}),await z(i))}async function V(i,C,_){console.log("[handleCellInput] Called:",{rowId:i,columnName:C,value:_,autoRowHeightEnabled:r.isAutoRowHeightEnabled}),r.updateCell(i,C,_),r.isAutoRowHeightEnabled?(await N(i),await t.nextTick()):_!=null&&String(_).includes(`
`)&&await z(i)}function Re(i,C){r.toggleCheckbox(i,C)}function ge(i){r.deleteRow(i)}function ce(i){r.insertRow(i)}function Se(i,C){r.insertMultipleRows(i,C,"above")}function De(i,C){r.insertMultipleRows(i,C,"below")}const Je=t.computed(()=>L.value.filter(i=>!i.isVisible&&!i.specialType&&i.visibleForGrid!==!1));function ct(i){const C=L.value.find(_=>_.name===i);C&&!C.specialType&&(C.isVisible=!1,console.log(`Hidden column: ${i}`))}function dt(i){const C=L.value.find(_=>_.name===i);C&&(C.isVisible=!0,console.log(`Shown column: ${i}`))}function Xe(){L.value.forEach(i=>{i.specialType||(i.isVisible=!0)}),console.log("Shown all columns")}function Ue(i){const C=L.value.find(X=>X.name===i);if(!C)return;const x=document.createElement("canvas").getContext("2d");if(!x)return;x.font="14px system-ui, -apple-system, sans-serif";let I=0;const P=x.measureText(C.header).width;I=Math.max(I,P+40),r.rows.forEach(X=>{const Q=X.cells.find(we=>we.columnName===i),de=Q==null?void 0:Q.value,Te=(de==null?void 0:de.toString())??"";if(Te){const we=x.measureText(Te).width;I=Math.max(I,we+24)}});const ee=Math.max(C.minWidth,Math.min(C.maxWidth,Math.ceil(I)));C.width=ee,console.log(`Auto-fit column ${i}: ${ee}px (measured: ${Math.ceil(I)}px)`)}const Ce=t.ref({visible:!1,columnName:"",position:{x:0,y:0},uniqueValues:[],mode:"checkbox",pattern:""});function He(i,C){if(i==null)return null;if(i.type==="simple")return i.columnName===C?null:i;const _=i;if(!_.left||!_.right)return console.error("[extractFiltersExceptColumn] Invalid composite filter - missing children:",_),null;const x=He(_.left,C),I=He(_.right,C);return!x&&!I?null:x?I?{type:"composite",left:x,right:I,operator:_.operator}:x:I}function Fe(i,C){const _=new Set;if(i==null)return _;function x(I){if(I.type==="simple"){const P=I;P.columnName===C&&P.operator==="Equals"&&_.add(String(P.value))}else{const P=I;x(P.left),x(P.right)}}return x(i),_}function Ye(i){try{if(console.log(`[getUniqueValues] Starting for column: ${i}`),!r||!r.rows)return console.warn("[getUniqueValues] Store or rows not initialized yet, returning empty array"),[];if(i==="__checkbox"){const X=He(r.filterExpression,i);console.log(`[getUniqueValues] Checkbox - Has filters to apply: ${!!X}`);const Q=r.rows;console.log(`[getUniqueValues] Checkbox - Total rows before filtering: ${Q.length}`);const de=X?h(Q,X,r):Q;console.log(`[getUniqueValues] Checkbox - Total rows after filtering: ${de.length}`);const Te=Math.min(3,de.length);for(let Qe=0;Qe<Te;Qe++){const je=de[Qe].cells.find(Ws=>Ws.columnName==="__checkbox");console.log(`[getUniqueValues] Checkbox - Row ${Qe}: cell=${!!je}, value=${je==null?void 0:je.value}, type=${typeof(je==null?void 0:je.value)}`)}const we=de.filter(Qe=>r.isRowChecked(Qe.rowId)).length,Ot=de.length-we,Wt=Fe(r.filterExpression,i);return console.log(`[getUniqueValues] Checkbox column: true=${we}, false=${Ot}, selected=${Array.from(Wt)}`),[{value:"true",isSelected:Wt.has("true"),count:we,displayText:`â˜‘ Checked (${we})`},{value:"false",isSelected:Wt.has("false"),count:Ot,displayText:`â˜ Unchecked (${Ot})`}]}const C=new Map,_=He(r.filterExpression,i);console.log(`[getUniqueValues] Has filters to apply for '${i}': ${!!_}`);const x=r.rows,I=_?h(x,_,r):x;console.log(`[getUniqueValues] Column=${i}, AllRows=${x.length}, FilteredRows=${I.length}`),I.forEach(X=>{var Te;const Q=X.cells.find(we=>we.columnName===i),de=((Te=Q==null?void 0:Q.value)==null?void 0:Te.toString())??"";C.set(de,(C.get(de)||0)+1)});const P=Fe(r.filterExpression,i);console.log(`[getUniqueValues] Column=${i}, UniqueValues=${C.size}, SelectedValues=${P.size}`);const ee=Array.from(C.entries()).map(([X,Q])=>{const de=X===""?"(Empty)":X;return{value:X,isSelected:P.has(X),count:Q,displayText:`${de} (${Q})`}}).sort((X,Q)=>X.value===""&&Q.value!==""?1:X.value!==""&&Q.value===""?-1:X.value.localeCompare(Q.value));return console.log(`[getUniqueValues] Returning ${ee.length} unique values`),ee}catch(C){return console.error(`[getUniqueValues] ERROR for column '${i}':`,C),console.error("[getUniqueValues] Filter expression at time of error:",r.filterExpression),console.error("[getUniqueValues] Stack trace:",C instanceof Error?C.stack:"No stack trace"),[]}}function ut(i){try{if(console.log(`[handleShowFilter] START for column: ${i}`),!d.value){console.error("[handleShowFilter] Grid not ready yet"),alert("Please wait for the grid to finish loading before opening filters.");return}if(v.value){console.error("[handleShowFilter] Grid is currently processing data"),alert("Please wait while data is being processed...");return}const C=L.value.find(I=>I.name===i);if(!C){console.error(`[handleShowFilter] Column not found: ${i}`);return}if(!C.isFilterable){console.warn(`[handleShowFilter] Column '${i}' is not filterable`);return}if(C.visibleForGrid===!1){console.warn(`[handleShowFilter] Column '${i}' has visibleForGrid=false, filtering not allowed`);return}if(!r||!r.rows||r.rows.length===0){console.error("[handleShowFilter] Store not initialized or no data"),alert("Please load data before opening filters.");return}const _=Ye(i);console.log(`[handleShowFilter] Got ${_.length} unique values`);const x={x:window.innerWidth/2-200,y:window.innerHeight/2-300};Ce.value={visible:!0,columnName:i,position:x,uniqueValues:_,mode:"checkbox",pattern:""},console.log("[handleShowFilter] Filter flyout opened successfully")}catch(C){console.error(`[handleShowFilter] CRITICAL ERROR for column '${i}':`,C),console.error("[handleShowFilter] Stack trace:",C instanceof Error?C.stack:"No stack trace"),alert(`Error opening filter for column '${i}': ${C instanceof Error?C.message:String(C)}`)}}function Ze(){Ce.value.visible=!1}function Pe(i){const C=new Map;function _(x,I){if(x.type==="simple"){const P=x;return I&&C.set(P.columnName,x),P.columnName}else{const P=x;if(P.operator==="AND")return _(P.left,!0),_(P.right,!0),null;{const ee=_(P.left,!1),X=_(P.right,!1),Q=ee||X;return Q&&I&&C.set(Q,x),Q}}}return i&&_(i,!0),C}function Ee(i){const C=i.filter(x=>x!=null);if(C.length===0)return null;if(C.length===1)return C[0];let _=C[0];for(let x=1;x<C.length;x++)_={type:"composite",left:_,right:C[x],operator:"AND"};return _}function Me(i,C){const _=r.filterExpression,x=Pe(_);x.set(C,i);const I=Array.from(x.values());return Ee(I)||i}function Nt(i){const C=Ce.value.columnName;if(i.length===0){const _=Pe(r.filterExpression);if(_.delete(C),_.size===0)r.clearFilter();else{const x=Array.from(_.values()),I=Ee(x);r.setFilter(I)}}else{const _=C==="__checkbox"?i.map(P=>P==="true"):i;let x;if(_.length===1)x={type:"simple",columnName:C,operator:"Equals",value:_[0]};else{x={type:"simple",columnName:C,operator:"Equals",value:_[0]};for(let P=1;P<_.length;P++)x={type:"composite",left:x,right:{type:"simple",columnName:C,operator:"Equals",value:_[P]},operator:"OR"}}const I=Me(x,C);r.setFilter(I)}console.log(`Applied checkbox filter to ${C}:`,i,"Final filter:",r.filterExpression)}function zt(i){const C=Ce.value.columnName;if(!i){const I=Pe(r.filterExpression);if(I.delete(C),I.size===0)r.clearFilter();else{const P=Array.from(I.values()),ee=Ee(P);r.setFilter(ee)}return}const x=Me({type:"simple",columnName:C,operator:"Contains",value:i},C);r.setFilter(x),console.log(`Applied text contains filter to ${C}:`,i,"Final filter:",r.filterExpression)}function Ft(){const i=Ce.value.columnName,C=Pe(r.filterExpression);if(C.delete(i),C.size===0)r.clearFilter();else{const _=Array.from(C.values()),x=Ee(_);r.setFilter(x)}console.log(`Cleared filter for ${i}`,"Final filter:",r.filterExpression)}async function k(){const i=W.value.filter(I=>!I.specialType||I.specialType!=="ValidationAlerts").map(I=>({name:I.name,width:I.width,specialType:I.specialType}));console.log("[applyAutoRowHeightToAll] ========== START =========="),console.log("[applyAutoRowHeightToAll] AutoRowHeight is ON");const C=r.rows.map(I=>({rowId:I.rowId,heightBefore:I.height}));console.log("[applyAutoRowHeightToAll] BEFORE - All row heights:",C.slice(0,10)),console.log("[applyAutoRowHeightToAll] Measuring columns:",i.map(I=>`${I.name} (${I.width}px, special: ${I.specialType||"none"})`).join(", "));const _=await w.applyAutoRowHeight(r.rows,i),x=r.rows.map((I,P)=>({rowId:I.rowId,heightBefore:C[P].heightBefore,heightAfter:I.height,changed:C[P].heightBefore!==I.height}));console.log("[applyAutoRowHeightToAll] AFTER - All row heights (first 10):",x.slice(0,10)),console.log("[applyAutoRowHeightToAll] Changed rows:",x.filter(I=>I.changed).length),console.log(`[applyAutoRowHeightToAll] Summary: ${_.totalRowsUpdated} rows updated, average height: ${_.averageHeight.toFixed(1)}px`),console.log("[applyAutoRowHeightToAll] Forcing Vue reactivity by reassigning rows array..."),r.rows=[...r.rows],await t.nextTick(),console.log("[applyAutoRowHeightToAll] First nextTick complete"),await t.nextTick(),console.log("[applyAutoRowHeightToAll] Second nextTick complete"),await t.nextTick(),console.log("[applyAutoRowHeightToAll] Third nextTick complete"),await new Promise(I=>setTimeout(I,50)),console.log("[applyAutoRowHeightToAll] Delay complete, calling forceUpdate..."),S.value?(S.value.forceUpdate(),console.log("[applyAutoRowHeightToAll] DynamicScroller forceUpdate() called")):console.log("[applyAutoRowHeightToAll] ERROR: scrollerRef is null, cannot forceUpdate"),console.log("[applyAutoRowHeightToAll] ========== COMPLETE ==========")}async function H(){console.log("[resetAllRowHeights] START - AutoRowHeight is OFF, resetting to default height");let i=0;const C=32;r.rows.forEach(_=>{_.height=C,i++}),console.log("[resetAllRowHeights] Summary:",{totalRows:i,resetToHeight:C}),console.log("[resetAllRowHeights] All row heights reset to default"),console.log("[resetAllRowHeights] Forcing Vue reactivity by reassigning rows array..."),r.rows=[...r.rows],await t.nextTick(),console.log("[resetAllRowHeights] First nextTick complete"),await t.nextTick(),console.log("[resetAllRowHeights] Second nextTick complete"),await t.nextTick(),console.log("[resetAllRowHeights] Third nextTick complete"),await new Promise(_=>setTimeout(_,50)),console.log("[resetAllRowHeights] Delay complete, calling forceUpdate..."),S.value?(S.value.forceUpdate(),console.log("[resetAllRowHeights] DynamicScroller forceUpdate() called")):console.log("[resetAllRowHeights] ERROR: scrollerRef is null, cannot forceUpdate"),console.log("[resetAllRowHeights] COMPLETE")}async function N(i){if(!r.isAutoRowHeightEnabled)return;const C=W.value.filter(I=>!I.specialType||I.specialType!=="ValidationAlerts").map(I=>({name:I.name,width:I.width,specialType:I.specialType})),_=r.rows.find(I=>I.rowId===i);if(!_)return;w.recalculateRows(r.rows,[i],C)>0&&_&&(r.updateRowHeight(i,_.height),r.rows=[...r.rows],await t.nextTick())}async function z(i){const C=r.rows.find(ee=>ee.rowId===i);if(!C)return;let _=1;for(const ee of C.cells){if(ee.value==null)continue;const X=String(ee.value);if(X.includes(`
`)){const Q=X.split(`
`).length;_=Math.max(_,Q)}}const P=_*21+10;r.updateRowHeight(i,P),r.rows=[...r.rows],await t.nextTick()}async function G(){l.debug("ðŸ”Œ Checking backend connection...");try{p.value=await pt.healthCheck(),p.value?l.info("âœ… Backend connected"):l.warn("âš ï¸ Backend disconnected")}catch(i){l.error("âŒ Backend connection check failed",{error:(i==null?void 0:i.message)||(i==null?void 0:i.toString())||"Unknown error",stack:i==null?void 0:i.stack}),p.value=!1}}async function te(){b.value=!0;try{const i=await pt.getData();if(i.success&&i.data){const C=i.data.map((_,x)=>({..._,__rowId:_.__rowId||`row-${Date.now()}-${x}`,__rowIndex:x}));r.loadRows(C),console.log(`Loaded ${C.length} rows from backend`),r.config.autoValidate&&r.config.enableValidation&&(console.log("[DataGrid] Auto-validation enabled - validating loaded data"),await he())}else console.error("Failed to load data from backend:",i.error),alert(`Failed to load data: ${i.error}`)}catch(i){console.error("Error loading data from backend:",i),alert(`Error loading data: ${i instanceof Error?i.message:"Unknown error"}`)}finally{b.value=!1}}async function Z(){y.value=!0;try{const i=r.rows.map(_=>{const x={};return L.value.forEach(I=>{if(!I.specialType){const P=_.cells.find(ee=>ee.columnName===I.name);P&&(x[I.name]=P.value)}}),x}),C=await pt.importData(i);C.success?console.log(`Saved ${i.length} rows to backend`):(console.error("Failed to save data to backend:",C.error),alert(`Failed to save data: ${C.error}`))}catch(i){console.error("Error saving data to backend:",i),alert(`Error saving data: ${i instanceof Error?i.message:"Unknown error"}`)}finally{y.value=!1}}const se=t.computed(()=>{var i,C,_,x,I,P,ee,X;return{...Ae,cellColors:{...Ae.cellColors,...((i=n.theme)==null?void 0:i.cellColors)||{}},rowColors:{...Ae.rowColors,...((C=n.theme)==null?void 0:C.rowColors)||{}},headerColors:{...Ae.headerColors,...((_=n.theme)==null?void 0:_.headerColors)||{}},validationColors:{...Ae.validationColors,...((x=n.theme)==null?void 0:x.validationColors)||{}},selectionColors:{...Ae.selectionColors,...((I=n.theme)==null?void 0:I.selectionColors)||{}},borderColors:{...Ae.borderColors,...((P=n.theme)==null?void 0:P.borderColors)||{}},specialColumnColors:{...Ae.specialColumnColors,...((ee=n.theme)==null?void 0:ee.specialColumnColors)||{}},uiControlColors:{...Ae.uiControlColors,...((X=n.theme)==null?void 0:X.uiControlColors)||{}}}}),ie=t.computed(()=>({...yn(se.value),"--dg-min-table-width":n.minTableWidth?`${n.minTableWidth}px`:"fit-content",width:n.width||"100%",height:n.height||"600px"})),pe={...a,async validateRequired(){if(!r.config.enableValidation)return!0;const i=r.getCellsNeedingValidation();if(i.length===0)return r.areNonEmptyRowsValid();for(const{rowId:C,columnName:_}of i){const x=r.rows.find(P=>P.rowId===C);if(!x)continue;const I=x.cells.find(P=>P.columnName===_);I&&(await a.validateCell(C,_,I.value),r.markCellValidated(C,_))}return r.areNonEmptyRowsValid()},isAllValid(){return r.areNonEmptyRowsValid()},async validateAll(i){if(!r.config.enableValidation)return{isValid:!0,totalErrors:0};const C=await a.validateAll(i||r.rows);r.clearValidationTracking();for(const _ of r.rows)for(const x of _.cells)r.markCellValidated(x.rowId,x.columnName);return C}};return e({validation:pe,copyPaste:c,shortcuts:J,handleCopy:T,handlePaste:D,handleCut:j,loadDataFromBackend:te,saveDataToBackend:Z,checkBackendConnection:G}),(i,C)=>(t.openBlock(),t.createElementBlock("div",{class:"data-grid",style:t.normalizeStyle(ie.value)},[v.value?(t.openBlock(),t.createElementBlock("div",Ur,[t.createElementVNode("div",jr,[C[0]||(C[0]=t.createElementVNode("div",{class:"processing-spinner"},null,-1)),t.createElementVNode("div",Gr,"Processing "+t.toDisplayString(t.unref(r).rows.length)+" rows...",1)])])):t.createCommentVNode("",!0),Je.value.length>0?(t.openBlock(),t.createElementBlock("div",qr,[C[1]||(C[1]=t.createElementVNode("span",{class:"hidden-columns-label"},"Hidden columns:",-1)),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(Je.value,_=>(t.openBlock(),t.createElementBlock("button",{key:_.name,class:"show-column-button",onClick:x=>dt(_.name),title:`Show column: ${_.header}`},t.toDisplayString(_.header),9,Kr))),128)),t.createElementVNode("button",{class:"show-all-button",onClick:Xe,title:"Show all columns"}," Show All ")])):t.createCommentVNode("",!0),t.createElementVNode("div",Jr,[t.createVNode(ur,{columns:W.value,"grid-template-columns":ne.value,"grid-id":t.unref(s),"is-grid-ready":d.value,"is-processing":v.value,onSort:M,onResize:A,onHideColumn:ct,onAutoFitColumn:Ue,onShowFilter:ut},null,8,["columns","grid-template-columns","grid-id","is-grid-ready","is-processing"]),t.createVNode(t.unref(Et),{ref_key:"scrollerRef",ref:S,items:Y.value,"min-item-size":40,buffer:200,"key-field":"rowId",class:"scroller"},{default:t.withCtx(({item:_,index:x,active:I})=>[t.createVNode(t.unref(Yt),{item:_,active:I,"size-dependencies":[_.height,_.cells.length,_.validationErrorCount],"data-index":x},{default:t.withCtx(()=>[t.createVNode(vr,{row:_,columns:W.value,"grid-template-columns":ne.value,"grid-id":t.unref(s),onCellEditComplete:U,onCellInput:V,onCheckboxChange:Re,onDeleteRow:ge,onInsertRow:ce,onInsertAbove:Se,onInsertBelow:De},null,8,["row","columns","grid-template-columns","grid-id"])]),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"])]),t.createVNode(Br,{"page-size":t.unref(r).pageSize,"page-size-options":t.unref(r).config.pageSizeOptions,"total-rows":t.unref(r).totalRows,"current-page":t.unref(r).currentPage,onPageChange:t.unref(r).goToPage,onPageSizeChange:t.unref(r).setPageSize},null,8,["page-size","page-size-options","total-rows","current-page","onPageChange","onPageSizeChange"]),t.createVNode(Lr,{visible:Ce.value.visible,"column-name":Ce.value.columnName,position:Ce.value.position,"unique-values":Ce.value.uniqueValues,"current-mode":Ce.value.mode,"current-pattern":Ce.value.pattern,onClose:Ze,onApplyCheckbox:Nt,onApplyRegex:zt,onClearFilter:Ft},null,8,["visible","column-name","position","unique-values","current-mode","current-pattern"])],4))}}),[["__scopeId","data-v-b8f0b0e7"]]),Xr={class:"listbox-container"},Yr={key:0,class:"listbox-title"},Zr=["onClick","onMouseenter"],Qr=["checked","onClick"],es={class:"listbox-item-text"},So=ze(t.defineComponent({__name:"ListBox",props:{items:{},title:{default:""},multiSelect:{type:Boolean,default:!1},preSelected:{default:()=>[]},height:{default:200},width:{default:250},theme:{}},emits:["selectionChange"],setup(o,{expose:e,emit:n}){const s=o,l=n,r=t.ref(new Set),a=t.ref(null);t.watch(()=>s.preSelected,u=>{r.value=new Set(u)},{immediate:!0});const c=t.computed(()=>{var u,g,w,f;return{...qe,itemColors:{...qe.itemColors,...((u=s.theme)==null?void 0:u.itemColors)||{}},containerColors:{...qe.containerColors,...((g=s.theme)==null?void 0:g.containerColors)||{}},checkboxColors:{...qe.checkboxColors,...((w=s.theme)==null?void 0:w.checkboxColors)||{}},scrollbarColors:{...qe.scrollbarColors,...((f=s.theme)==null?void 0:f.scrollbarColors)||{}}}}),h=t.computed(()=>vn(c.value)),m=t.computed(()=>({height:`${s.height}px`,width:`${s.width}px`,...h.value}));function d(u){return r.value.has(u)}function v(u){s.multiSelect?r.value.has(u.value)?r.value.delete(u.value):r.value.add(u.value):(r.value.clear(),r.value.add(u.value)),l("selectionChange",Array.from(r.value))}return e({getSelectedValues:()=>Array.from(r.value),clearSelection:()=>{r.value.clear(),l("selectionChange",[])},selectValue:u=>{s.multiSelect||r.value.clear(),r.value.add(u),l("selectionChange",Array.from(r.value))}}),(u,g)=>(t.openBlock(),t.createElementBlock("div",Xr,[o.title?(t.openBlock(),t.createElementBlock("div",Yr,t.toDisplayString(o.title),1)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:t.normalizeClass(["listbox",{"listbox--multi":o.multiSelect}]),style:t.normalizeStyle(m.value)},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(o.items,w=>(t.openBlock(),t.createElementBlock("div",{key:w.value,class:t.normalizeClass(["listbox-item",{"listbox-item--selected":d(w.value),"listbox-item--hover":a.value===w.value}]),onClick:f=>v(w),onMouseenter:f=>a.value=w.value,onMouseleave:g[0]||(g[0]=f=>a.value=null)},[o.multiSelect?(t.openBlock(),t.createElementBlock("input",{key:0,type:"checkbox",checked:d(w.value),class:"listbox-checkbox",onClick:t.withModifiers(f=>v(w),["stop"])},null,8,Qr)):t.createCommentVNode("",!0),t.createElementVNode("span",es,t.toDisplayString(w.name),1)],42,Zr))),128))],6)]))}}),[["__scopeId","data-v-3ab94bcd"]]);function ts(){const o=t.ref([]);function e(a,c){return c.length===0?a:a.slice().sort((h,m)=>{for(const{columnName:d,direction:v}of c){const u=h.cells.find(b=>b.columnName===d),g=m.cells.find(b=>b.columnName===d),w=u==null?void 0:u.value,f=g==null?void 0:g.value,p=n(w,f);if(p!==0)return v==="asc"?p:-p}return 0})}function n(a,c){if(a==null&&c==null)return 0;if(a==null)return-1;if(c==null)return 1;if(typeof a=="number"&&typeof c=="number")return a-c;const h=new Date(a),m=new Date(c);if(!isNaN(h.getTime())&&!isNaN(m.getTime()))return h.getTime()-m.getTime();const d=String(a).toLowerCase(),v=String(c).toLowerCase();return d.localeCompare(v)}function s(a,c,h=!1){if(!h)o.value=[{columnName:a,direction:c}];else{const m=o.value.findIndex(d=>d.columnName===a);m>=0?o.value[m].direction=c:o.value.push({columnName:a,direction:c})}}function l(a){o.value=o.value.filter(c=>c.columnName!==a)}function r(){o.value=[]}return{sortColumns:o,sortRows:e,addSort:s,removeSort:l,clearSort:r}}function os(){const o=t.ref(new Set),e=t.ref(null);function n(d,v,u="replace"){const g=`${d}:${v}`;u==="replace"?(o.value.clear(),o.value.add(g),e.value={rowId:d,columnName:v}):u==="add"?o.value.add(g):u==="toggle"&&(o.value.has(g)?o.value.delete(g):o.value.add(g))}function s(d,v,u,g){o.value.clear();const w=u.findIndex(T=>T.rowId===d.rowId),f=u.findIndex(T=>T.rowId===v.rowId),p=g.findIndex(T=>T.name===d.columnName),b=g.findIndex(T=>T.name===v.columnName);if(w===-1||f===-1||p===-1||b===-1)return;const y=Math.min(w,f),S=Math.max(w,f),$=Math.min(p,b),E=Math.max(p,b);for(let T=y;T<=S;T++){const D=u[T];for(let j=$;j<=E;j++){const F=g[j];D&&F&&o.value.add(`${D.rowId}:${F.name}`)}}}function l(d,v){for(const u of v)o.value.add(`${d}:${u.name}`)}function r(d,v){for(const u of v)o.value.add(`${u.rowId}:${d}`)}function a(d,v){o.value.clear();for(const u of d)for(const g of v)o.value.add(`${u.rowId}:${g.name}`)}function c(){o.value.clear(),e.value=null}function h(){return Array.from(o.value).map(d=>{const[v,u]=d.split(":");return{rowId:v,columnName:u}})}function m(d,v){return o.value.has(`${d}:${v}`)}return{selectedCells:o,anchorCell:e,selectCell:n,selectRange:s,selectRow:l,selectColumn:r,selectAll:a,clearSelection:c,getSelectedCells:h,isCellSelected:m}}class Oe extends Error{constructor(e,n){const s=new.target.prototype;super(`${e}: Status code '${n}'`),this.statusCode=n,this.__proto__=s}}class Mt extends Error{constructor(e="A timeout occurred."){const n=new.target.prototype;super(e),this.__proto__=n}}class $e extends Error{constructor(e="An abort occurred."){const n=new.target.prototype;super(e),this.__proto__=n}}class ns extends Error{constructor(e,n){const s=new.target.prototype;super(e),this.transport=n,this.errorType="UnsupportedTransportError",this.__proto__=s}}class rs extends Error{constructor(e,n){const s=new.target.prototype;super(e),this.transport=n,this.errorType="DisabledTransportError",this.__proto__=s}}class ss extends Error{constructor(e,n){const s=new.target.prototype;super(e),this.transport=n,this.errorType="FailedToStartTransportError",this.__proto__=s}}class ko extends Error{constructor(e){const n=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=n}}class ls extends Error{constructor(e,n){const s=new.target.prototype;super(e),this.innerErrors=n,this.__proto__=s}}class xo{constructor(e,n,s){this.statusCode=e,this.statusText=n,this.content=s}}class wt{get(e,n){return this.send({...n,method:"GET",url:e})}post(e,n){return this.send({...n,method:"POST",url:e})}delete(e,n){return this.send({...n,method:"DELETE",url:e})}getCookieString(e){return""}}var R;(function(o){o[o.Trace=0]="Trace",o[o.Debug=1]="Debug",o[o.Information=2]="Information",o[o.Warning=3]="Warning",o[o.Error=4]="Error",o[o.Critical=5]="Critical",o[o.None=6]="None"})(R||(R={}));class it{constructor(){}log(e,n){}}it.instance=new it;const is="8.0.17";class me{static isRequired(e,n){if(e==null)throw new Error(`The '${n}' argument is required.`)}static isNotEmpty(e,n){if(!e||e.match(/^\s*$/))throw new Error(`The '${n}' argument should not be empty.`)}static isIn(e,n,s){if(!(e in n))throw new Error(`Unknown ${s} value: ${e}.`)}}class ue{static get isBrowser(){return!ue.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!ue.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!ue.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function at(o,e){let n="";return We(o)?(n=`Binary data of length ${o.byteLength}`,e&&(n+=`. Content: '${as(o)}'`)):typeof o=="string"&&(n=`String data of length ${o.length}`,e&&(n+=`. Content: '${o}'`)),n}function as(o){const e=new Uint8Array(o);let n="";return e.forEach(s=>{const l=s<16?"0":"";n+=`0x${l}${s.toString(16)} `}),n.substr(0,n.length-1)}function We(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}async function Ro(o,e,n,s,l,r){const a={},[c,h]=Ke();a[c]=h,o.log(R.Trace,`(${e} transport) sending data. ${at(l,r.logMessageContent)}.`);const m=We(l)?"arraybuffer":"text",d=await n.post(s,{content:l,headers:{...a,...r.headers},responseType:m,timeout:r.timeout,withCredentials:r.withCredentials});o.log(R.Trace,`(${e} transport) request complete. Response status: ${d.statusCode}.`)}function cs(o){return o===void 0?new bt(R.Information):o===null?it.instance:o.log!==void 0?o:new bt(o)}class ds{constructor(e,n){this._subject=e,this._observer=n}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(n=>{})}}class bt{constructor(e){this._minLevel=e,this.out=console}log(e,n){if(e>=this._minLevel){const s=`[${new Date().toISOString()}] ${R[e]}: ${n}`;switch(e){case R.Critical:case R.Error:this.out.error(s);break;case R.Warning:this.out.warn(s);break;case R.Information:this.out.info(s);break;default:this.out.log(s);break}}}}function Ke(){let o="X-SignalR-User-Agent";return ue.isNode&&(o="User-Agent"),[o,us(is,hs(),gs(),fs())]}function us(o,e,n,s){let l="Microsoft SignalR/";const r=o.split(".");return l+=`${r[0]}.${r[1]}`,l+=` (${o}; `,e&&e!==""?l+=`${e}; `:l+="Unknown OS; ",l+=`${n}`,s?l+=`; ${s}`:l+="; Unknown Runtime Version",l+=")",l}function hs(){if(ue.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function fs(){if(ue.isNode)return process.versions.node}function gs(){return ue.isNode?"NodeJS":"Browser"}function Dt(o){return o.stack?o.stack:o.message?o.message:`${o}`}function ps(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}class ms extends wt{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||ue.isNode){const n=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(n("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=n("node-fetch"):this._fetchType=fetch,this._fetchType=n("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(ps());if(typeof AbortController>"u"){const n=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=n("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new $e;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const n=new this._abortControllerType;let s;e.abortSignal&&(e.abortSignal.onabort=()=>{n.abort(),s=new $e});let l=null;if(e.timeout){const h=e.timeout;l=setTimeout(()=>{n.abort(),this._logger.log(R.Warning,"Timeout from HTTP request."),s=new Mt},h)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},We(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let r;try{r=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:n.signal})}catch(h){throw s||(this._logger.log(R.Warning,`Error from HTTP request. ${h}.`),h)}finally{l&&clearTimeout(l),e.abortSignal&&(e.abortSignal.onabort=null)}if(!r.ok){const h=await Eo(r,"text");throw new Oe(h||r.statusText,r.status)}const c=await Eo(r,e.responseType);return new xo(r.status,r.statusText,c)}getCookieString(e){let n="";return ue.isNode&&this._jar&&this._jar.getCookies(e,(s,l)=>n=l.join("; ")),n}}function Eo(o,e){let n;switch(e){case"arraybuffer":n=o.arrayBuffer();break;case"text":n=o.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:n=o.text();break}return n}class ws extends wt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new $e):e.method?e.url?new Promise((n,s)=>{const l=new XMLHttpRequest;l.open(e.method,e.url,!0),l.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,l.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(We(e.content)?l.setRequestHeader("Content-Type","application/octet-stream"):l.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const r=e.headers;r&&Object.keys(r).forEach(a=>{l.setRequestHeader(a,r[a])}),e.responseType&&(l.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{l.abort(),s(new $e)}),e.timeout&&(l.timeout=e.timeout),l.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),l.status>=200&&l.status<300?n(new xo(l.status,l.statusText,l.response||l.responseText)):s(new Oe(l.response||l.responseText||l.statusText,l.status))},l.onerror=()=>{this._logger.log(R.Warning,`Error from HTTP request. ${l.status}: ${l.statusText}.`),s(new Oe(l.statusText,l.status))},l.ontimeout=()=>{this._logger.log(R.Warning,"Timeout from HTTP request."),s(new Mt)},l.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class bs extends wt{constructor(e){if(super(),typeof fetch<"u"||ue.isNode)this._httpClient=new ms(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new ws(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new $e):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class xe{static write(e){return`${e}${xe.RecordSeparator}`}static parse(e){if(e[e.length-1]!==xe.RecordSeparator)throw new Error("Message is incomplete.");const n=e.split(xe.RecordSeparator);return n.pop(),n}}xe.RecordSeparatorCode=30,xe.RecordSeparator=String.fromCharCode(xe.RecordSeparatorCode);class Cs{writeHandshakeRequest(e){return xe.write(JSON.stringify(e))}parseHandshakeResponse(e){let n,s;if(We(e)){const c=new Uint8Array(e),h=c.indexOf(xe.RecordSeparatorCode);if(h===-1)throw new Error("Message is incomplete.");const m=h+1;n=String.fromCharCode.apply(null,Array.prototype.slice.call(c.slice(0,m))),s=c.byteLength>m?c.slice(m).buffer:null}else{const c=e,h=c.indexOf(xe.RecordSeparator);if(h===-1)throw new Error("Message is incomplete.");const m=h+1;n=c.substring(0,m),s=c.length>m?c.substring(m):null}const l=xe.parse(n),r=JSON.parse(l[0]);if(r.type)throw new Error("Expected a handshake response from the server.");return[s,r]}}var K;(function(o){o[o.Invocation=1]="Invocation",o[o.StreamItem=2]="StreamItem",o[o.Completion=3]="Completion",o[o.StreamInvocation=4]="StreamInvocation",o[o.CancelInvocation=5]="CancelInvocation",o[o.Ping=6]="Ping",o[o.Close=7]="Close",o[o.Ack=8]="Ack",o[o.Sequence=9]="Sequence"})(K||(K={}));class ys{constructor(){this.observers=[]}next(e){for(const n of this.observers)n.next(e)}error(e){for(const n of this.observers)n.error&&n.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new ds(this,e)}}class vs{constructor(e,n,s){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=n,this._bufferSize=s}async _send(e){const n=this._protocol.writeMessage(e);let s=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let l=()=>{},r=()=>{};We(n)?this._bufferedByteCount+=n.byteLength:this._bufferedByteCount+=n.length,this._bufferedByteCount>=this._bufferSize&&(s=new Promise((a,c)=>{l=a,r=c})),this._messages.push(new _s(n,this._totalMessageCount,l,r))}try{this._reconnectInProgress||await this._connection.send(n)}catch{this._disconnected()}await s}_ack(e){let n=-1;for(let s=0;s<this._messages.length;s++){const l=this._messages[s];if(l._id<=e.sequenceId)n=s,We(l._message)?this._bufferedByteCount-=l._message.byteLength:this._bufferedByteCount-=l._message.length,l._resolver();else if(this._bufferedByteCount<this._bufferSize)l._resolver();else break}n!==-1&&(this._messages=this._messages.slice(n+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==K.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const n=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,n<=this._latestReceivedSequenceId?(n===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=n,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:K.Sequence,sequenceId:e}));const n=this._messages;for(const s of n)await this._connection.send(s._message);this._reconnectInProgress=!1}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(const n of this._messages)n._rejector(e)}_isInvocationMessage(e){switch(e.type){case K.Invocation:case K.StreamItem:case K.Completion:case K.StreamInvocation:case K.CancelInvocation:return!0;case K.Close:case K.Sequence:case K.Ping:case K.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:K.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class _s{constructor(e,n,s,l){this._message=e,this._id=n,this._resolver=s,this._rejector=l}}const Ss=30*1e3,ks=15*1e3,xs=1e5;var ae;(function(o){o.Disconnected="Disconnected",o.Connecting="Connecting",o.Connected="Connected",o.Disconnecting="Disconnecting",o.Reconnecting="Reconnecting"})(ae||(ae={}));class Ht{static create(e,n,s,l,r,a,c){return new Ht(e,n,s,l,r,a,c)}constructor(e,n,s,l,r,a,c){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(R.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},me.isRequired(e,"connection"),me.isRequired(n,"logger"),me.isRequired(s,"protocol"),this.serverTimeoutInMilliseconds=r??Ss,this.keepAliveIntervalInMilliseconds=a??ks,this._statefulReconnectBufferSize=c??xs,this._logger=n,this._protocol=s,this.connection=e,this._reconnectPolicy=l,this._handshakeProtocol=new Cs,this.connection.onreceive=h=>this._processIncomingData(h),this.connection.onclose=h=>this._connectionClosed(h),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=ae.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:K.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==ae.Disconnected&&this._connectionState!==ae.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==ae.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=ae.Connecting,this._logger.log(R.Debug,"Starting HubConnection.");try{await this._startInternal(),ue.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=ae.Connected,this._connectionStarted=!0,this._logger.log(R.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=ae.Disconnected,this._logger.log(R.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((n,s)=>{this._handshakeResolver=n,this._handshakeRejecter=s});await this.connection.start(this._protocol.transferFormat);try{let n=this._protocol.version;this.connection.features.reconnect||(n=1);const s={protocol:this._protocol.name,version:n};if(this._logger.log(R.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(s)),this._logger.log(R.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new vs(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(n){throw this._logger.log(R.Debug,`Hub handshake failed with error '${n}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(n),n}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===ae.Disconnected)return this._logger.log(R.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===ae.Disconnecting)return this._logger.log(R.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const n=this._connectionState;return this._connectionState=ae.Disconnecting,this._logger.log(R.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(R.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(n===ae.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new $e("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...n){const[s,l]=this._replaceStreamingParams(n),r=this._createStreamInvocation(e,n,l);let a;const c=new ys;return c.cancelCallback=()=>{const h=this._createCancelInvocation(r.invocationId);return delete this._callbacks[r.invocationId],a.then(()=>this._sendWithProtocol(h))},this._callbacks[r.invocationId]=(h,m)=>{if(m){c.error(m);return}else h&&(h.type===K.Completion?h.error?c.error(new Error(h.error)):c.complete():c.next(h.item))},a=this._sendWithProtocol(r).catch(h=>{c.error(h),delete this._callbacks[r.invocationId]}),this._launchStreams(s,a),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...n){const[s,l]=this._replaceStreamingParams(n),r=this._sendWithProtocol(this._createInvocation(e,n,!0,l));return this._launchStreams(s,r),r}invoke(e,...n){const[s,l]=this._replaceStreamingParams(n),r=this._createInvocation(e,n,!1,l);return new Promise((c,h)=>{this._callbacks[r.invocationId]=(d,v)=>{if(v){h(v);return}else d&&(d.type===K.Completion?d.error?h(new Error(d.error)):c(d.result):h(new Error(`Unexpected message type: ${d.type}`)))};const m=this._sendWithProtocol(r).catch(d=>{h(d),delete this._callbacks[r.invocationId]});this._launchStreams(s,m)})}on(e,n){!e||!n||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(n)===-1&&this._methods[e].push(n))}off(e,n){if(!e)return;e=e.toLowerCase();const s=this._methods[e];if(s)if(n){const l=s.indexOf(n);l!==-1&&(s.splice(l,1),s.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const n=this._protocol.parseMessages(e,this._logger);for(const s of n)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(s)))switch(s.type){case K.Invocation:this._invokeClientMethod(s).catch(l=>{this._logger.log(R.Error,`Invoke client method threw error: ${Dt(l)}`)});break;case K.StreamItem:case K.Completion:{const l=this._callbacks[s.invocationId];if(l){s.type===K.Completion&&delete this._callbacks[s.invocationId];try{l(s)}catch(r){this._logger.log(R.Error,`Stream callback threw error: ${Dt(r)}`)}}break}case K.Ping:break;case K.Close:{this._logger.log(R.Information,"Close message received from server.");const l=s.error?new Error("Server returned an error on close: "+s.error):void 0;s.allowReconnect===!0?this.connection.stop(l):this._stopPromise=this._stopInternal(l);break}case K.Ack:this._messageBuffer&&this._messageBuffer._ack(s);break;case K.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(s);break;default:this._logger.log(R.Warning,`Invalid message type: ${s.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let n,s;try{[s,n]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(l){const r="Error parsing handshake response: "+l;this._logger.log(R.Error,r);const a=new Error(r);throw this._handshakeRejecter(a),a}if(n.error){const l="Server returned handshake error: "+n.error;this._logger.log(R.Error,l);const r=new Error(l);throw this._handshakeRejecter(r),r}else this._logger.log(R.Debug,"Server handshake complete.");return this._handshakeResolver(),s}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===ae.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const n=e.target.toLowerCase(),s=this._methods[n];if(!s){this._logger.log(R.Warning,`No client method with the name '${n}' found.`),e.invocationId&&(this._logger.log(R.Warning,`No result given for '${n}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const l=s.slice(),r=!!e.invocationId;let a,c,h;for(const m of l)try{const d=a;a=await m.apply(this,e.arguments),r&&a&&d&&(this._logger.log(R.Error,`Multiple results provided for '${n}'. Sending error to server.`),h=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),c=void 0}catch(d){c=d,this._logger.log(R.Error,`A callback for the method '${n}' threw error '${d}'.`)}h?await this._sendWithProtocol(h):r?(c?h=this._createCompletionMessage(e.invocationId,`${c}`,null):a!==void 0?h=this._createCompletionMessage(e.invocationId,null,a):(this._logger.log(R.Warning,`No result given for '${n}' method and invocation ID '${e.invocationId}'.`),h=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(h)):a&&this._logger.log(R.Error,`Result given for '${n}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(R.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new $e("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===ae.Disconnecting?this._completeClose(e):this._connectionState===ae.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===ae.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=ae.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),ue.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(n=>n.apply(this,[e]))}catch(n){this._logger.log(R.Error,`An onclose callback called with error '${e}' threw error '${n}'.`)}}}async _reconnect(e){const n=Date.now();let s=0,l=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),r=this._getNextRetryDelay(s++,0,l);if(r===null){this._logger.log(R.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=ae.Reconnecting,e?this._logger.log(R.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(R.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(a=>a.apply(this,[e]))}catch(a){this._logger.log(R.Error,`An onreconnecting callback called with error '${e}' threw error '${a}'.`)}if(this._connectionState!==ae.Reconnecting){this._logger.log(R.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;r!==null;){if(this._logger.log(R.Information,`Reconnect attempt number ${s} will start in ${r} ms.`),await new Promise(a=>{this._reconnectDelayHandle=setTimeout(a,r)}),this._reconnectDelayHandle=void 0,this._connectionState!==ae.Reconnecting){this._logger.log(R.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=ae.Connected,this._logger.log(R.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(a=>a.apply(this,[this.connection.connectionId]))}catch(a){this._logger.log(R.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${a}'.`)}return}catch(a){if(this._logger.log(R.Information,`Reconnect attempt failed because of error '${a}'.`),this._connectionState!==ae.Reconnecting){this._logger.log(R.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===ae.Disconnecting&&this._completeClose();return}l=a instanceof Error?a:new Error(a.toString()),r=this._getNextRetryDelay(s++,Date.now()-n,l)}}this._logger.log(R.Information,`Reconnect retries have been exhausted after ${Date.now()-n} ms and ${s} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,n,s){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:n,previousRetryCount:e,retryReason:s})}catch(l){return this._logger.log(R.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${n}) threw error '${l}'.`),null}}_cancelCallbacksWithError(e){const n=this._callbacks;this._callbacks={},Object.keys(n).forEach(s=>{const l=n[s];try{l(null,e)}catch(r){this._logger.log(R.Error,`Stream 'error' callback called with '${e}' threw error: ${Dt(r)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,n,s,l){if(s)return l.length!==0?{arguments:n,streamIds:l,target:e,type:K.Invocation}:{arguments:n,target:e,type:K.Invocation};{const r=this._invocationId;return this._invocationId++,l.length!==0?{arguments:n,invocationId:r.toString(),streamIds:l,target:e,type:K.Invocation}:{arguments:n,invocationId:r.toString(),target:e,type:K.Invocation}}}_launchStreams(e,n){if(e.length!==0){n||(n=Promise.resolve());for(const s in e)e[s].subscribe({complete:()=>{n=n.then(()=>this._sendWithProtocol(this._createCompletionMessage(s)))},error:l=>{let r;l instanceof Error?r=l.message:l&&l.toString?r=l.toString():r="Unknown error",n=n.then(()=>this._sendWithProtocol(this._createCompletionMessage(s,r)))},next:l=>{n=n.then(()=>this._sendWithProtocol(this._createStreamItemMessage(s,l)))}})}}_replaceStreamingParams(e){const n=[],s=[];for(let l=0;l<e.length;l++){const r=e[l];if(this._isObservable(r)){const a=this._invocationId;this._invocationId++,n[a]=r,s.push(a.toString()),e.splice(l,1)}}return[n,s]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,n,s){const l=this._invocationId;return this._invocationId++,s.length!==0?{arguments:n,invocationId:l.toString(),streamIds:s,target:e,type:K.StreamInvocation}:{arguments:n,invocationId:l.toString(),target:e,type:K.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:K.CancelInvocation}}_createStreamItemMessage(e,n){return{invocationId:e,item:n,type:K.StreamItem}}_createCompletionMessage(e,n,s){return n?{error:n,invocationId:e,type:K.Completion}:{invocationId:e,result:s,type:K.Completion}}_createCloseMessage(){return{type:K.Close}}}const Rs=[0,2e3,1e4,3e4,null];class Io{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Rs}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Le{}Le.Authorization="Authorization",Le.Cookie="Cookie";class Es extends wt{constructor(e,n){super(),this._innerClient=e,this._accessTokenFactory=n}async send(e){let n=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(n=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const s=await this._innerClient.send(e);return n&&s.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):s}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Le.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Le.Authorization]&&delete e.headers[Le.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var fe;(function(o){o[o.None=0]="None",o[o.WebSockets=1]="WebSockets",o[o.ServerSentEvents=2]="ServerSentEvents",o[o.LongPolling=4]="LongPolling"})(fe||(fe={}));var ye;(function(o){o[o.Text=1]="Text",o[o.Binary=2]="Binary"})(ye||(ye={}));let Is=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class To{get pollAborted(){return this._pollAbort.aborted}constructor(e,n,s){this._httpClient=e,this._logger=n,this._pollAbort=new Is,this._options=s,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,n){if(me.isRequired(e,"url"),me.isRequired(n,"transferFormat"),me.isIn(n,ye,"transferFormat"),this._url=e,this._logger.log(R.Trace,"(LongPolling transport) Connecting."),n===ye.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[s,l]=Ke(),r={[s]:l,...this._options.headers},a={abortSignal:this._pollAbort.signal,headers:r,timeout:1e5,withCredentials:this._options.withCredentials};n===ye.Binary&&(a.responseType="arraybuffer");const c=`${e}&_=${Date.now()}`;this._logger.log(R.Trace,`(LongPolling transport) polling: ${c}.`);const h=await this._httpClient.get(c,a);h.statusCode!==200?(this._logger.log(R.Error,`(LongPolling transport) Unexpected response code: ${h.statusCode}.`),this._closeError=new Oe(h.statusText||"",h.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,a)}async _poll(e,n){try{for(;this._running;)try{const s=`${e}&_=${Date.now()}`;this._logger.log(R.Trace,`(LongPolling transport) polling: ${s}.`);const l=await this._httpClient.get(s,n);l.statusCode===204?(this._logger.log(R.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):l.statusCode!==200?(this._logger.log(R.Error,`(LongPolling transport) Unexpected response code: ${l.statusCode}.`),this._closeError=new Oe(l.statusText||"",l.statusCode),this._running=!1):l.content?(this._logger.log(R.Trace,`(LongPolling transport) data received. ${at(l.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(l.content)):this._logger.log(R.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(s){this._running?s instanceof Mt?this._logger.log(R.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=s,this._running=!1):this._logger.log(R.Trace,`(LongPolling transport) Poll errored after shutdown: ${s.message}`)}}finally{this._logger.log(R.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Ro(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(R.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(R.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[n,s]=Ke();e[n]=s;const l={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let r;try{await this._httpClient.delete(this._url,l)}catch(a){r=a}r?r instanceof Oe&&(r.statusCode===404?this._logger.log(R.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(R.Trace,`(LongPolling transport) Error sending a DELETE request: ${r}`)):this._logger.log(R.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(R.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(R.Trace,e),this.onclose(this._closeError)}}}class Ts{constructor(e,n,s,l){this._httpClient=e,this._accessToken=n,this._logger=s,this._options=l,this.onreceive=null,this.onclose=null}async connect(e,n){return me.isRequired(e,"url"),me.isRequired(n,"transferFormat"),me.isIn(n,ye,"transferFormat"),this._logger.log(R.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((s,l)=>{let r=!1;if(n!==ye.Text){l(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let a;if(ue.isBrowser||ue.isWebWorker)a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),h={};h.Cookie=c;const[m,d]=Ke();h[m]=d,a=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...h,...this._options.headers}})}try{a.onmessage=c=>{if(this.onreceive)try{this._logger.log(R.Trace,`(SSE transport) data received. ${at(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(h){this._close(h);return}},a.onerror=c=>{r?this._close():l(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},a.onopen=()=>{this._logger.log(R.Information,`SSE connected to ${this._url}`),this._eventSource=a,r=!0,s()}}catch(c){l(c);return}})}async send(e){return this._eventSource?Ro(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class $s{constructor(e,n,s,l,r,a){this._logger=s,this._accessTokenFactory=n,this._logMessageContent=l,this._webSocketConstructor=r,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=a}async connect(e,n){me.isRequired(e,"url"),me.isRequired(n,"transferFormat"),me.isIn(n,ye,"transferFormat"),this._logger.log(R.Trace,"(WebSockets transport) Connecting.");let s;return this._accessTokenFactory&&(s=await this._accessTokenFactory()),new Promise((l,r)=>{e=e.replace(/^http/,"ws");let a;const c=this._httpClient.getCookieString(e);let h=!1;if(ue.isNode||ue.isReactNative){const m={},[d,v]=Ke();m[d]=v,s&&(m[Le.Authorization]=`Bearer ${s}`),c&&(m[Le.Cookie]=c),a=new this._webSocketConstructor(e,void 0,{headers:{...m,...this._headers}})}else s&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(s)}`);a||(a=new this._webSocketConstructor(e)),n===ye.Binary&&(a.binaryType="arraybuffer"),a.onopen=m=>{this._logger.log(R.Information,`WebSocket connected to ${e}.`),this._webSocket=a,h=!0,l()},a.onerror=m=>{let d=null;typeof ErrorEvent<"u"&&m instanceof ErrorEvent?d=m.error:d="There was an error with the transport",this._logger.log(R.Information,`(WebSockets transport) ${d}.`)},a.onmessage=m=>{if(this._logger.log(R.Trace,`(WebSockets transport) data received. ${at(m.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(m.data)}catch(d){this._close(d);return}},a.onclose=m=>{if(h)this._close(m);else{let d=null;typeof ErrorEvent<"u"&&m instanceof ErrorEvent?d=m.error:d="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(d))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(R.Trace,`(WebSockets transport) sending data. ${at(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(R.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const $o=100;class As{constructor(e,n={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,me.isRequired(e,"url"),this._logger=cs(n.logger),this.baseUrl=this._resolveUrl(e),n=n||{},n.logMessageContent=n.logMessageContent===void 0?!1:n.logMessageContent,typeof n.withCredentials=="boolean"||n.withCredentials===void 0)n.withCredentials=n.withCredentials===void 0?!0:n.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");n.timeout=n.timeout===void 0?100*1e3:n.timeout;let s=null,l=null;if(ue.isNode&&typeof require<"u"){const r=typeof __webpack_require__=="function"?__non_webpack_require__:require;s=r("ws"),l=r("eventsource")}!ue.isNode&&typeof WebSocket<"u"&&!n.WebSocket?n.WebSocket=WebSocket:ue.isNode&&!n.WebSocket&&s&&(n.WebSocket=s),!ue.isNode&&typeof EventSource<"u"&&!n.EventSource?n.EventSource=EventSource:ue.isNode&&!n.EventSource&&typeof l<"u"&&(n.EventSource=l),this._httpClient=new Es(n.httpClient||new bs(this._logger),n.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=n,this.onreceive=null,this.onclose=null}async start(e){if(e=e||ye.Binary,me.isIn(e,ye,"transferFormat"),this._logger.log(R.Debug,`Starting connection with transfer format '${ye[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const n="Failed to start the HttpConnection before stop() was called.";return this._logger.log(R.Error,n),await this._stopPromise,Promise.reject(new $e(n))}else if(this._connectionState!=="Connected"){const n="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(R.Error,n),Promise.reject(new $e(n))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Pt(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(R.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(R.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(n=>{this._stopPromiseResolver=n}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(n){this._logger.log(R.Error,`HttpConnection.transport.stop() threw error '${n}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(R.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let n=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===fe.WebSockets)this.transport=this._constructTransport(fe.WebSockets),await this._startTransport(n,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let s=null,l=0;do{if(s=await this._getNegotiationResponse(n),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new $e("The connection was stopped during negotiation.");if(s.error)throw new Error(s.error);if(s.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(s.url&&(n=s.url),s.accessToken){const r=s.accessToken;this._accessTokenFactory=()=>r,this._httpClient._accessToken=r,this._httpClient._accessTokenFactory=void 0}l++}while(s.url&&l<$o);if(l===$o&&s.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(n,this._options.transport,s,e)}this.transport instanceof To&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(R.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(s){return this._logger.log(R.Error,"Failed to start the connection: "+s),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(s)}}async _getNegotiationResponse(e){const n={},[s,l]=Ke();n[s]=l;const r=this._resolveNegotiateUrl(e);this._logger.log(R.Debug,`Sending negotiation request: ${r}.`);try{const a=await this._httpClient.post(r,{content:"",headers:{...n,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(a.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${a.statusCode}'`));const c=JSON.parse(a.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new ko("Client didn't negotiate Stateful Reconnect but the server did.")):c}catch(a){let c="Failed to complete negotiation with the server: "+a;return a instanceof Oe&&a.statusCode===404&&(c=c+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(R.Error,c),Promise.reject(new ko(c))}}_createConnectUrl(e,n){return n?e+(e.indexOf("?")===-1?"?":"&")+`id=${n}`:e}async _createTransport(e,n,s,l){let r=this._createConnectUrl(e,s.connectionToken);if(this._isITransport(n)){this._logger.log(R.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=n,await this._startTransport(r,l),this.connectionId=s.connectionId;return}const a=[],c=s.availableTransports||[];let h=s;for(const m of c){const d=this._resolveTransportOrError(m,n,l,(h==null?void 0:h.useStatefulReconnect)===!0);if(d instanceof Error)a.push(`${m.transport} failed:`),a.push(d);else if(this._isITransport(d)){if(this.transport=d,!h){try{h=await this._getNegotiationResponse(e)}catch(v){return Promise.reject(v)}r=this._createConnectUrl(e,h.connectionToken)}try{await this._startTransport(r,l),this.connectionId=h.connectionId;return}catch(v){if(this._logger.log(R.Error,`Failed to start the transport '${m.transport}': ${v}`),h=void 0,a.push(new ss(`${m.transport} failed: ${v}`,fe[m.transport])),this._connectionState!=="Connecting"){const u="Failed to select transport before stop() was called.";return this._logger.log(R.Debug,u),Promise.reject(new $e(u))}}}}return a.length>0?Promise.reject(new ls(`Unable to connect to the server with any of the available transports. ${a.join(" ")}`,a)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case fe.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new $s(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case fe.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Ts(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case fe.LongPolling:return new To(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,n){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async s=>{let l=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(e,n),await this.features.resend()}catch{l=!0}else{this._stopConnection(s);return}l&&this._stopConnection(s)}:this.transport.onclose=s=>this._stopConnection(s),this.transport.connect(e,n)}_resolveTransportOrError(e,n,s,l){const r=fe[e.transport];if(r==null)return this._logger.log(R.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(Bs(n,r))if(e.transferFormats.map(c=>ye[c]).indexOf(s)>=0){if(r===fe.WebSockets&&!this._options.WebSocket||r===fe.ServerSentEvents&&!this._options.EventSource)return this._logger.log(R.Debug,`Skipping transport '${fe[r]}' because it is not supported in your environment.'`),new ns(`'${fe[r]}' is not supported in your environment.`,r);this._logger.log(R.Debug,`Selecting transport '${fe[r]}'.`);try{return this.features.reconnect=r===fe.WebSockets?l:void 0,this._constructTransport(r)}catch(c){return c}}else return this._logger.log(R.Debug,`Skipping transport '${fe[r]}' because it does not support the requested transfer format '${ye[s]}'.`),new Error(`'${fe[r]}' does not support ${ye[s]}.`);else return this._logger.log(R.Debug,`Skipping transport '${fe[r]}' because it was disabled by the client.`),new rs(`'${fe[r]}' is disabled by the client.`,r)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(R.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(R.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(R.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(R.Error,`Connection disconnected with error '${e}'.`):this._logger.log(R.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(n=>{this._logger.log(R.Error,`TransportSendQueue.stop() threw error '${n}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(n){this._logger.log(R.Error,`HttpConnection.onclose(${e}) threw error '${n}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!ue.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const n=window.document.createElement("a");return n.href=e,this._logger.log(R.Information,`Normalizing '${e}' to '${n.href}'.`),n.href}_resolveNegotiateUrl(e){const n=new URL(e);n.pathname.endsWith("/")?n.pathname+="negotiate":n.pathname+="/negotiate";const s=new URLSearchParams(n.searchParams);return s.has("negotiateVersion")||s.append("negotiateVersion",this._negotiateVersion.toString()),s.has("useStatefulReconnect")?s.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&s.append("useStatefulReconnect","true"),n.search=s.toString(),n.toString()}}function Bs(o,e){return!o||(e&o)!==0}class Pt{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new Ct,this._transportResult=new Ct,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new Ct),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new Ct;const e=this._transportResult;this._transportResult=void 0;const n=typeof this._buffer[0]=="string"?this._buffer.join(""):Pt._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(n),e.resolve()}catch(s){e.reject(s)}}}static _concatBuffers(e){const n=e.map(r=>r.byteLength).reduce((r,a)=>r+a),s=new Uint8Array(n);let l=0;for(const r of e)s.set(new Uint8Array(r),l),l+=r.byteLength;return s.buffer}}class Ct{constructor(){this.promise=new Promise((e,n)=>[this._resolver,this._rejecter]=[e,n])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const Vs="json";class Ms{constructor(){this.name=Vs,this.version=2,this.transferFormat=ye.Text}parseMessages(e,n){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];n===null&&(n=it.instance);const s=xe.parse(e),l=[];for(const r of s){const a=JSON.parse(r);if(typeof a.type!="number")throw new Error("Invalid payload.");switch(a.type){case K.Invocation:this._isInvocationMessage(a);break;case K.StreamItem:this._isStreamItemMessage(a);break;case K.Completion:this._isCompletionMessage(a);break;case K.Ping:break;case K.Close:break;case K.Ack:this._isAckMessage(a);break;case K.Sequence:this._isSequenceMessage(a);break;default:n.log(R.Information,"Unknown message type '"+a.type+"' ignored.");continue}l.push(a)}return l}writeMessage(e){return xe.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,n){if(typeof e!="string"||e==="")throw new Error(n)}}const Ds={trace:R.Trace,debug:R.Debug,info:R.Information,information:R.Information,warn:R.Warning,warning:R.Warning,error:R.Error,critical:R.Critical,none:R.None};function Hs(o){const e=Ds[o.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${o}`)}class Ps{configureLogging(e){if(me.isRequired(e,"logging"),Ns(e))this.logger=e;else if(typeof e=="string"){const n=Hs(e);this.logger=new bt(n)}else this.logger=new bt(e);return this}withUrl(e,n){return me.isRequired(e,"url"),me.isNotEmpty(e,"url"),this.url=e,typeof n=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...n}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:n},this}withHubProtocol(e){return me.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Io(e):this.reconnectPolicy=e:this.reconnectPolicy=new Io,this}withServerTimeout(e){return me.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return me.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e==null?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const n=new As(this.url,e);return Ht.create(n,this.logger||it.instance,this.protocol||new Ms,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Ns(o){return o.log!==void 0}function zs(o={}){const e=o.hubUrl||"/gridhub",n=o.autoReconnect!==!1,s=t.ref(null),l=t.ref(!1),r=t.ref(!1),a=t.ref(null);async function c(){if(s.value||r.value){console.log("SignalR: Already connected or connecting");return}r.value=!0,a.value=null;try{const u=new Ps().withUrl(e,{skipNegotiation:!1,transport:fe.WebSockets|fe.ServerSentEvents|fe.LongPolling});n&&u.withAutomaticReconnect({nextRetryDelayInMilliseconds:g=>g.previousRetryCount===0?0:g.previousRetryCount===1?2e3:g.previousRetryCount===2?1e4:3e4}),s.value=u.build(),s.value.onclose(g=>{l.value=!1,g?(console.error("SignalR connection closed with error:",g),a.value=g):console.log("SignalR connection closed")}),s.value.onreconnecting(g=>{l.value=!1,console.warn("SignalR reconnecting...",g)}),s.value.onreconnected(g=>{l.value=!0,a.value=null,console.log("SignalR reconnected:",g)}),await s.value.start(),l.value=!0,console.log("SignalR connected successfully")}catch(u){console.error("SignalR connection failed:",u),a.value=u,s.value=null}finally{r.value=!1}}async function h(){if(s.value)try{await s.value.stop(),console.log("SignalR connection stopped")}catch(u){console.error("Error stopping SignalR connection:",u)}finally{s.value=null,l.value=!1}}function m(u,g){if(!s.value){console.warn(`Cannot register handler for '${u}': connection not initialized`);return}s.value.on(u,g)}function d(u,g){s.value&&(g?s.value.off(u,g):s.value.off(u))}async function v(u,...g){if(!s.value||!l.value){console.error(`Cannot invoke '${u}': not connected`);return}try{return await s.value.invoke(u,...g)}catch(w){throw console.error(`Error invoking '${u}':`,w),w}}return t.onUnmounted(()=>{h()}),{connection:s,isConnected:l,isConnecting:r,connectionError:a,start:c,stop:h,on:m,off:d,invoke:v}}const Fs={install(o){o.use(yt.createPinia()),o.component("AdvancedTable",mt),o.component("DataGrid",mt),o.component("ListBox",So)}},Os="1.0.0";le.AdvancedTable=mt,le.DataGrid=mt,le.ListBox=So,le.RpaWebUIPlugin=Fs,le.gridApi=pt,le.useAutoRowHeight=ro,le.useCopyPaste=oo,le.useDataGridStore=et,le.useFiltering=It,le.useImportExport=an,le.useLogger=co,le.useSearch=Zt,le.useSelection=os,le.useShortcuts=lo,le.useSignalR=zs,le.useSorting=ts,le.useTheme=Cn,le.useValidation=to,le.version=Os,Object.defineProperty(le,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=rpa-web-ui.umd.js.map
